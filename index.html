<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NOTECRAFT ‚Äî Music Incremental</title>
  <style>
    :root{
      --bg0:#07080d;
      --bg1:#0b0f1c;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.085);
      --stroke:rgba(255,255,255,.12);
      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --muted2:rgba(255,255,255,.46);
      --good:#7CFFB2;
      --warn:#FFD37C;
      --bad:#FF7C9A;
      --acc:#B47CFF;
      --acc2:#7CE1FF;
      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --r:18px;
      --navH: 76px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--txt);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(180,124,255,.22), transparent 70%),
        radial-gradient(700px 500px at 80% 20%, rgba(124,225,255,.18), transparent 70%),
        radial-gradient(700px 600px at 60% 90%, rgba(124,255,178,.12), transparent 70%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
      overflow-x:hidden;
      padding-bottom: calc(var(--navH) + 18px);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 0;
    }

    /* Header */
    .header{
      display:flex;
      gap:12px;
      align-items:stretch;
      flex-wrap:wrap;
      margin-bottom:12px;
    }
    .brand{
      flex: 1 1 330px;
      border:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(180,124,255,.14), rgba(124,225,255,.08));
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .brand:before{
      content:"";
      position:absolute; inset:-120px -120px auto auto;
      width:260px; height:260px;
      background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 60%);
      filter: blur(2px);
      transform: rotate(18deg);
    }
    .brand h1{
      margin:0 0 6px;
      font-size:18px;
      font-weight:900;
      letter-spacing:.6px;
    }
    .brand p{
      margin:0;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }

    .stats{
      flex: 1 1 420px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    .stat{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      border-radius:16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.30);
      padding:12px;
    }
    .stat .k{font-size:11px;color:var(--muted2);letter-spacing:.35px}
    .stat .v{font-size:16px;font-weight:900;margin-top:4px}
    .stat .s{font-size:11px;color:var(--muted);margin-top:6px;line-height:1.2}

    /* Screens */
    .screen{
      display:none;
      animation: fadeIn .18s ease-out;
    }
    .screen.active{ display:block; }
    @keyframes fadeIn { from{opacity:.0; transform: translateY(6px)} to{opacity:1; transform: translateY(0)} }

    .card{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      overflow:hidden;
      position:relative;
    }
    .card h2{
      margin:0 0 10px;
      font-size:13px;
      letter-spacing:.4px;
      color:rgba(255,255,255,.88);
      font-weight:900;
    }
    .sub{
      margin:10px 0 0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .btn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.05);
      color:var(--txt);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.3px;
      font-size:12px;
      transition: transform .08s ease, border-color .2s ease, background .2s ease;
      user-select:none;
      display:inline-flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      min-height:44px;
    }
    .btn:hover{ border-color: rgba(255,255,255,.24); background:rgba(255,255,255,.07); }
    .btn:active{ transform: scale(.985); }
    .btn.good{ border-color: rgba(124,255,178,.28); background: rgba(124,255,178,.08); }
    .btn.acc{ border-color: rgba(180,124,255,.28); background: rgba(180,124,255,.08); }
    .btn.warn{ border-color: rgba(255,211,124,.30); background: rgba(255,211,124,.08); }
    .btn.danger{ border-color: rgba(255,124,154,.28); background: rgba(255,124,154,.07); }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter: grayscale(.2);
    }

    /* Studio big button */
    .studioGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .bigBtn{
      border-radius:20px;
      border:1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(500px 300px at 30% 20%, rgba(124,225,255,.20), transparent 70%),
        radial-gradient(500px 320px at 70% 80%, rgba(180,124,255,.22), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      cursor:pointer;
      position:relative;
      overflow:hidden;
      transition: transform .08s ease, filter .2s ease, border-color .2s ease;
      user-select:none;
      padding:18px;
      min-height: 240px;
    }
    .bigBtn:active{ transform: scale(.985); }
    .bigBtn:hover{ border-color: rgba(255,255,255,.22); filter: brightness(1.03); }
    .note{
      font-size:54px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.45));
      animation: floaty 3.2s ease-in-out infinite;
    }
    @keyframes floaty{
      0%,100%{ transform: translateY(0) }
      50%{ transform: translateY(-7px) }
    }
    .bigTitle{
      font-size:16px;
      font-weight:1000;
      letter-spacing:.7px;
      margin-top:10px;
    }
    .hint{
      color:var(--muted);
      font-size:12px;
      margin-top:8px;
      line-height:1.35;
      max-width: 680px;
    }
    .quickRow{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }

    /* Lists */
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height: 62vh;
      overflow:auto;
      padding-right:6px;
    }
    .list::-webkit-scrollbar{ width:8px; }
    .list::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,.10);
      border-radius:999px;
    }
    .item{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      border-radius:16px;
      padding:12px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
    }
    .item .name{
      font-weight:1000;
      letter-spacing:.25px;
      font-size:12px;
    }
    .item .desc{
      margin-top:6px;
      font-size:11px;
      color:var(--muted);
      line-height:1.35;
    }
    .meta{
      margin-top:8px;
      font-size:11px;
      color:rgba(255,255,255,.78);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .tag{
      font-size:10px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      color:rgba(255,255,255,.78);
      background:rgba(255,255,255,.03);
      letter-spacing:.3px;
      white-space:nowrap;
    }
    .tag.lock{ border-color: rgba(255,124,154,.22); background: rgba(255,124,154,.08); }
    .tag.reb{ border-color: rgba(180,124,255,.28); background: rgba(180,124,255,.08); }
    .tag.vip{ border-color: rgba(124,225,255,.26); background: rgba(124,225,255,.08); }

    /* Bottom Nav */
    .nav{
      position:fixed;
      left:0; right:0; bottom:0;
      height: var(--navH);
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      border-top:1px solid rgba(255,255,255,.12);
      z-index: 60;
    }
    .navRow{
      max-width: 980px;
      margin: 0 auto;
      display:grid;
      grid-template-columns: repeat(5, minmax(0,1fr));
      gap:10px;
      height:100%;
      align-items:stretch;
    }
    .navBtn{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.86);
      border-radius: 16px;
      padding:10px 8px;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:3px;
      align-items:center;
      justify-content:center;
      user-select:none;
      transition: background .2s ease, border-color .2s ease, transform .08s ease;
      font-weight:900;
    }
    .navBtn:active{ transform: scale(.985); }
    .navBtn:hover{ border-color: rgba(255,255,255,.24); background: rgba(255,255,255,.06); }
    .navBtn.active{
      border-color: rgba(180,124,255,.45);
      background: rgba(180,124,255,.10);
    }
    .navIcon{ font-size:18px; line-height:1 }
    .navTxt{ font-size:10px; letter-spacing:.35px; color: rgba(255,255,255,.78) }

    /* Toasts */
    .toastHost{
      position:fixed;
      right:14px;
      bottom: calc(var(--navH) + 14px);
      width:min(420px, calc(100vw - 28px));
      display:flex;
      flex-direction:column;
      gap:10px;
      z-index:70;
      pointer-events:none;
    }
    .toast{
      pointer-events:none;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.55);
      border-radius:16px;
      padding:12px;
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      transform: translateY(10px);
      opacity:0;
      transition: opacity .25s ease, transform .25s ease;
    }
    .toast.show{ opacity:1; transform: translateY(0); }
    .toast .t{ font-weight:1000; font-size:12px; }
    .toast .b{ color:var(--muted); font-size:11px; margin-top:6px; line-height:1.35; }

    .spark{
      position:fixed;
      pointer-events:none;
      font-weight:1000;
      text-shadow: 0 10px 22px rgba(0,0,0,.55);
      will-change: transform, opacity;
      z-index:80;
    }

    @media (max-width: 820px){
      .stats{ grid-template-columns: 1fr 1fr; }
      .quickRow{ grid-template-columns: 1fr; }
      .navRow{ gap:8px; }
      .navBtn{ border-radius: 14px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <h1>NOTECRAFT</h1>
        <p>–ö–ª–∏–∫–µ—Ä-–∏–º–ø–µ—Ä–∏—è –º—É–∑—ã–∫–∏. –ù–æ—Ç—ã = –≤–∞–ª—é—Ç–∞. –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –∂—ë—Å—Ç–∫–∏–µ –∞–ø–≥—Ä–µ–π–¥—ã –∏ –¥–∞—é—Ç –±—É—Å—Ç –∫ –∫–ª–∏–∫–∞–º. –î–æ–Ω–∞—Ç ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è.</p>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="k">–ù–æ—Ç—ã</div>
          <div class="v" id="notes">0</div>
          <div class="s">–¢–≤–æ—è –≤–∞–ª—é—Ç–∞ ‚ô™</div>
        </div>
        <div class="stat">
          <div class="k">–ù–æ—Ç/–∫–ª–∏–∫</div>
          <div class="v" id="npc">1</div>
          <div class="s">–£—Ä–æ–Ω –∫–ª–∏–∫–∞</div>
        </div>
        <div class="stat">
          <div class="k">–ù–æ—Ç/—Å–µ–∫</div>
          <div class="v" id="nps">0</div>
          <div class="s">–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥</div>
        </div>
        <div class="stat">
          <div class="k">–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è</div>
          <div class="v" id="reb">0</div>
          <div class="s">–û—Ç–∫—Ä—ã–≤–∞—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç</div>
        </div>
      </div>
    </div>

    <!-- SCREENS -->
    <section class="screen active" id="screen-studio">
      <div class="studioGrid">
        <div class="card">
          <h2>–°—Ç—É–¥–∏—è</h2>
          <button class="bigBtn" id="clickBtn">
            <div class="note">‚ô™</div>
            <div class="bigTitle">–ñ–ú–ò ‚Äî –ü–ò–®–ò –ù–û–¢–´</div>
            <div class="hint">
              –†–∞–∑–≥–æ–Ω—è–π –∫–ª–∏–∫–∞–º–∏ ‚Üí –ø–æ–∫—É–ø–∞–π —É–ª—É—á—à–µ–Ω–∏—è ‚Üí –∑–∞–ø—É—Å–∫–∞–π –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥ ‚Üí –¥–µ–ª–∞–π –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è.
              –ó–∞–∫—Ä—ã—Ç—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–∫—Ä–æ—é—Ç—Å—è –ø–æ—Å–ª–µ –Ω—É–∂–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–±—ë—Ä—Å–æ–≤.
            </div>
          </button>
          <div class="sub" id="goalLine">–¶–µ–ª—å: ‚Äî</div>
        </div>

        <div class="quickRow">
          <div class="card">
            <h2>–ë—ã—Å—Ç—Ä—ã–µ –ø–æ–∫—É–ø–∫–∏</h2>
            <div class="sub">–¢—É—Ç 2 ‚Äú–∫–Ω–æ–ø–∫–∏-—É—Å–∫–æ—Ä–∏—Ç–µ–ª—è‚Äù, —á—Ç–æ–±—ã –Ω–µ –ª–µ–∑—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤ —Å–ø–∏—Å–æ–∫.</div>
            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
              <button class="btn good" id="buyBestClick">‚ö° –ö—É–ø–∏—Ç—å –ª—É—á—à–∏–π –∫–ª–∏–∫</button>
              <button class="btn acc" id="buyBestNps">üéõÔ∏è –ö—É–ø–∏—Ç—å –ª—É—á—à–∏–π –∞–≤—Ç–æ</button>
            </div>
          </div>
          <div class="card">
            <h2>–î—Ä–æ–ø—ã –∏ —Å–æ–±—ã—Ç–∏—è</h2>
            <div class="sub">
              –ò–Ω–æ–≥–¥–∞ –ø–∞–¥–∞—é—Ç –±–æ–Ω—É—Å—ã: —Ç—Ä–µ–Ω–¥—ã, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, —Ñ–∞–Ω–∞—Ç—ã —Å üíé.
              VIP-—É–¥–∞—á–∞ –ø–æ–≤—ã—à–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É —Å–æ–±—ã—Ç–∏–π.
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
              <span class="tag">üíé: <b id="gems">0</b></span>
              <span class="tag vip">VIP luck: <b id="vip">0</b></span>
              <span class="tag">offline: <b id="offb">0</b></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="screen" id="screen-upgrades">
      <div class="card">
        <h2>–£–ª—É—á—à–µ–Ω–∏—è</h2>
        <div class="sub">–°–≤–µ—Ä—Ö—É ‚Äî –±–∞–∑–æ–≤—ã–µ. –ù–∏–∂–µ ‚Äî –∑–∞–∫—Ä—ã—Ç—ã–µ (–ø–æ –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è–º).</div>
      </div>
      <div style="height:12px"></div>
      <div class="card">
        <h2>–ë–∞–∑–æ–≤—ã–µ</h2>
        <div class="list" id="basicList"></div>
      </div>
      <div style="height:12px"></div>
      <div class="card">
        <h2>–ó–∞–∫—Ä—ã—Ç—ã–µ</h2>
        <div class="list" id="lockedList"></div>
      </div>
    </section>

    <section class="screen" id="screen-rebirth">
      <div class="card">
        <h2>–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</h2>
        <div class="sub">
          –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–æ—Ç—ã –∏ –±–∞–∑–æ–≤—ã–µ –∞–ø–≥—Ä–µ–π–¥—ã, –Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–ª–∏–∫–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –≤–µ—Ç–∫–∏.
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <span class="tag reb">–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: <b id="rebReq">0</b> ‚ô™</span>
          <span class="tag">–°–µ–π—á–∞—Å: <b id="rebNow">0</b> ‚ô™</span>
          <span class="tag vip">–°–∏–ª–∞ —Ä–µ–±—ë—Ä—Å–∞: <b id="rebPower">√ó1.00</b></span>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
          <button class="btn danger" id="rebirthBtn">‚ôªÔ∏è –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ</button>
          <button class="btn warn" id="rebirthHelp">üìò –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h2>–î–æ–ª–≥–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
        <div class="sub">
          –ó–∞–∫—Ä—ã—Ç—ã–µ —É–ª—É—á—à–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–π ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å ‚Äú–¥–æ–ª–≥–∞—è –∏–≥—Ä–∞‚Äù.
          –î–æ–Ω–∞—Ç √ó2 —Ä–µ–±—ë—Ä—Å–∞ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª —Å–∏–ª—å–Ω–µ–µ.
        </div>
      </div>
    </section>

    <section class="screen" id="screen-donate">
      <div class="card">
        <h2>–î–æ–Ω–∞—Ç (—Å–∏–º—É–ª—è—Ü–∏—è)</h2>
        <div class="sub">–ë–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–ø–ª–∞—Ç. –ü—Ä–æ—Å—Ç–æ –º–µ—Ö–∞–Ω–∏–∫–∞ –º–∞–≥–∞–∑–∏–Ω–∞: x2 –Ω–æ—Ç—ã, x2 —Å–∏–ª–∞ —Ä–µ–±—ë—Ä—Å–æ–≤, —É–¥–∞—á–∞, –æ—Ñ—Ñ–ª–∞–π–Ω-–±—É—Å—Ç.</div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <span class="tag">üíé: <b id="gems2">0</b></span>
          <button class="btn good" id="freeGems">üéÅ –ü–æ–ª—É—á–∏—Ç—å 50üíé (—Ç–µ—Å—Ç)</button>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="card">
        <h2>–¢–æ–≤–∞—Ä—ã</h2>
        <div class="list" id="donateList"></div>
      </div>
    </section>

    <section class="screen" id="screen-log">
      <div class="card">
        <h2>–õ–æ–≥</h2>
        <div class="sub">–ü–æ–∫—É–ø–∫–∏, —Å–æ–±—ã—Ç–∏—è, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.</div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
          <button class="btn warn" id="clearLog">üßΩ –û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="btn danger" id="hardReset">üß® –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å</button>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="card">
        <h2>–õ–µ–Ω—Ç–∞</h2>
        <div class="list" id="logList"></div>
      </div>
    </section>
  </div>

  <!-- Bottom Nav -->
  <nav class="nav">
    <div class="navRow">
      <button class="navBtn active" data-go="studio"><div class="navIcon">‚ô™</div><div class="navTxt">–°—Ç—É–¥–∏—è</div></button>
      <button class="navBtn" data-go="upgrades"><div class="navIcon">üõ†Ô∏è</div><div class="navTxt">–ê–ø–≥—Ä–µ–π–¥—ã</div></button>
      <button class="navBtn" data-go="rebirth"><div class="navIcon">‚ôªÔ∏è</div><div class="navTxt">–†–µ–±—ë—Ä—Å</div></button>
      <button class="navBtn" data-go="donate"><div class="navIcon">üíé</div><div class="navTxt">–î–æ–Ω–∞—Ç</div></button>
      <button class="navBtn" data-go="log"><div class="navIcon">üìú</div><div class="navTxt">–õ–æ–≥</div></button>
    </div>
  </nav>

  <!-- Toasts -->
  <div class="toastHost" id="toastHost"></div>

<script>
(() => {
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => Array.from(document.querySelectorAll(s));
  const STORAGE_KEY = "notecraft_save_ui_v2";

  const fmt = (n) => {
    if (!isFinite(n)) return "‚àû";
    const abs = Math.abs(n);
    const units = [[1e12,"T"],[1e9,"B"],[1e6,"M"],[1e3,"K"]];
    for (const [v,u] of units){
      if (abs >= v) return (n/v).toFixed(abs>=v*100?0:2).replace(/\.?0+$/,"")+u;
    }
    return Math.floor(n).toString();
  };
  const now = () => Date.now();

  function toast(title, body=""){
    const host = $("#toastHost");
    const el = document.createElement("div");
    el.className = "toast";
    el.innerHTML = `<div class="t">${title}</div>${body?`<div class="b">${body}</div>`:""}`;
    host.appendChild(el);
    requestAnimationFrame(()=>el.classList.add("show"));
    setTimeout(()=>{
      el.classList.remove("show");
      setTimeout(()=>el.remove(), 260);
    }, 2200);
  }
  function spark(x,y,text){
    const el = document.createElement("div");
    el.className = "spark";
    el.textContent = text;
    el.style.left = x+"px";
    el.style.top = y+"px";
    el.style.opacity = "1";
    el.style.transform = "translate(-50%, -50%) scale(1)";
    el.style.fontSize = (12 + Math.random()*8).toFixed(0)+"px";
    document.body.appendChild(el);

    const dx = (Math.random()*2-1)*40;
    const dy = -70 - Math.random()*40;
    const t0 = performance.now();
    const dur = 620 + Math.random()*240;

    function tick(t){
      const p = Math.min(1,(t-t0)/dur);
      const ease = 1 - Math.pow(1-p,3);
      el.style.transform = `translate(${dx*ease - 50}%, ${dy*ease - 50}%) scale(${1 - 0.15*ease})`;
      el.style.opacity = (1-ease).toFixed(3);
      if (p<1) requestAnimationFrame(tick); else el.remove();
    }
    requestAnimationFrame(tick);
  }

  const state = {
    notes: 0,
    rebirths: 0,
    upgrades: {},      // base upgrades
    lockedBought: {},  // locked upgrades
    clickMultFromRebirth: 1,
    clickMultFromMeta: 1, // from locked upgrades
    npsMultFromMeta: 1,   // from locked upgrades
    donate: { moneyX2:false, rebirthX2:false, vipLuck:0, offlineBoost:0 },
    gems: 0,
    log: [],
    lastTick: now(),
    lastSave: now(),
    lastEvent: 0
  };

  const BASIC_UPGRADES = [
    { id:"beat",   name:"–ë–∏—Ç-–º–∞—à–∏–Ω–∞",         tag:"–ö–ª–∏–∫",  desc:"–ö–ª–∏–∫–∏ —Å–∏–ª—å–Ω–µ–µ.", baseCost: 15,  costMul:1.42, effect:(lvl)=>1+lvl*0.35 },
    { id:"mic",    name:"–°—Ç—É–¥–∏–π–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω", tag:"–ö–ª–∏–∫",  desc:"–ï—â—ë —Å–∏–ª—å–Ω–µ–µ –∫–ª–∏–∫–∏.", baseCost: 60, costMul:1.48, effect:(lvl)=>1+lvl*0.55 },
    { id:"studio", name:"–ê—Ä–µ–Ω–¥–∞ —Å—Ç—É–¥–∏–∏",      tag:"–ù/—Å–µ–∫", desc:"–î–∞–µ—Ç –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥.", baseCost: 90, costMul:1.55, effect:(lvl)=>lvl*2.2 }, // base nps
    { id:"mix",    name:"–°–≤–µ–¥–µ–Ω–∏–µ/–º–∞—Å—Ç–µ—Ä–∏–Ω–≥", tag:"–ù/—Å–µ–∫", desc:"–£–º–Ω–æ–∂–∞–µ—Ç –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥.", baseCost: 120, costMul:1.45, effect:(lvl)=>1+lvl*0.40 },
    { id:"promo",  name:"–ü—Ä–æ–º–æ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö",   tag:"–ì–∏–±—Ä–∏–¥",desc:"–£—Å–∏–ª–∏–≤–∞–µ—Ç –≤—Å—ë –Ω–µ–º–Ω–æ–≥–æ.", baseCost: 250, costMul:1.52, effect:(lvl)=>1+lvl*0.18 },
  ];

  const LOCKED_UPGRADES = [
    { id:"label", name:"–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å –ª–µ–π–±–ª–æ–º", reqReb:2,  cost: 2500,   desc:"–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ √ó2.2", apply:(s)=>{ s.npsMultFromMeta *= 2.2; } },
    { id:"ghost", name:"–ì–æ—Å—Ç—Ä–∞–π—Ç–µ—Ä",         reqReb:4,  cost: 12000,  desc:"–ö–ª–∏–∫–∏ √ó2",        apply:(s)=>{ s.clickMultFromMeta *= 2.0; } },
    { id:"tour",  name:"–¢—É—Ä –ø–æ –≥–æ—Ä–æ–¥–∞–º",     reqReb:6,  cost: 50000,  desc:"–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ √ó2.8 + VIP luck –º–∏–Ω–∏–º—É–º 1", apply:(s)=>{ s.npsMultFromMeta *= 2.8; s.donate.vipLuck = Math.max(s.donate.vipLuck,1); } },
    { id:"plat",  name:"–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π –∞–ª—å–±–æ–º",  reqReb:9,  cost: 250000, desc:"–ö–ª–∏–∫ √ó2.5 –∏ –ù/—Å–µ–∫ √ó2.5", apply:(s)=>{ s.clickMultFromMeta *= 2.5; s.npsMultFromMeta *= 2.5; } },
    { id:"arena", name:"–°—Ç–∞–¥–∏–æ–Ω",            reqReb:12, cost: 1300000,desc:"–ê–≤—Ç–æ-–¥–æ—Ö–æ–¥ √ó4",    apply:(s)=>{ s.npsMultFromMeta *= 4.0; } },
  ];

  const DONATE_ITEMS = [
    { id:"moneyx2", name:"√ó2 –ù–æ—Ç—ã –Ω–∞–≤—Å–µ–≥–¥–∞",  price:120, desc:"–ö–ª–∏–∫ –∏ –ù/—Å–µ–∫ √ó2", owned:(s)=>s.donate.moneyX2, buy:(s)=>{s.donate.moneyX2=true;} },
    { id:"rebx2",   name:"√ó2 –°–∏–ª–∞ —Ä–µ–±—ë—Ä—Å–∞",   price:160, desc:"–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è —Å–∏–ª—å–Ω–µ–µ √ó2", owned:(s)=>s.donate.rebirthX2, buy:(s)=>{s.donate.rebirthX2=true;} },
    { id:"luck1",   name:"VIP-—É–¥–∞—á–∞ I",       price:80,  desc:"–°–æ–±—ã—Ç–∏—è —á–∞—â–µ", owned:(s)=>s.donate.vipLuck>=1, buy:(s)=>{s.donate.vipLuck=Math.max(s.donate.vipLuck,1);} },
    { id:"luck2",   name:"VIP-—É–¥–∞—á–∞ II",      price:160, desc:"–ï—â—ë —á–∞—â–µ + –∏–Ω–æ–≥–¥–∞ üíé", owned:(s)=>s.donate.vipLuck>=2, buy:(s)=>{s.donate.vipLuck=Math.max(s.donate.vipLuck,2);} },
    { id:"off1",    name:"–û—Ñ—Ñ–ª–∞–π–Ω –±—É—Å—Ç I",    price:90,  desc:"–ë–æ–ª—å—à–µ –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–æ—Ö–æ–¥–∞", owned:(s)=>s.donate.offlineBoost>=1, buy:(s)=>{s.donate.offlineBoost=Math.max(s.donate.offlineBoost,1);} },
    { id:"off2",    name:"–û—Ñ—Ñ–ª–∞–π–Ω –±—É—Å—Ç II",   price:170, desc:"–ï—â—ë –±–æ–ª—å—à–µ –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–æ—Ö–æ–¥–∞", owned:(s)=>s.donate.offlineBoost>=2, buy:(s)=>{s.donate.offlineBoost=Math.max(s.donate.offlineBoost,2);} },
  ];

  function log(msg){
    state.log.unshift({ t:new Date().toLocaleString(), msg });
    state.log = state.log.slice(0,120);
  }

  function lvl(id){ return state.upgrades[id] || 0; }
  function cost(u){ return Math.floor(u.baseCost * Math.pow(u.costMul, lvl(u.id))); }

  function computeClick(){
    let v = 1;
    const beat = BASIC_UPGRADES.find(x=>x.id==="beat").effect(lvl("beat"));
    const mic  = BASIC_UPGRADES.find(x=>x.id==="mic").effect(lvl("mic"));
    const promo= BASIC_UPGRADES.find(x=>x.id==="promo").effect(lvl("promo"));
    v *= beat * mic * promo;
    v *= state.clickMultFromRebirth;
    v *= state.clickMultFromMeta;
    if (state.donate.moneyX2) v *= 2;
    return v;
  }
  function computeNPS(){
    const studio = BASIC_UPGRADES.find(x=>x.id==="studio").effect(lvl("studio"));
    const mix    = BASIC_UPGRADES.find(x=>x.id==="mix").effect(lvl("mix"));
    const promo  = BASIC_UPGRADES.find(x=>x.id==="promo").effect(lvl("promo"));
    let v = studio;
    v *= mix * promo;
    v *= state.npsMultFromMeta;
    if (state.donate.moneyX2) v *= 2;
    return v;
  }

  function nextRebReq(){
    const r = state.rebirths;
    const base = 25_000;
    return Math.floor(base * Math.pow(1.65, r));
  }
  function rebirthPower(){
    let p = 1 + state.rebirths * 0.22;
    if (state.donate.rebirthX2) p *= 2;
    return p;
  }

  function doRebirth(){
    const req = nextRebReq();
    if (state.notes < req){
      toast("–†–∞–Ω–æ", `–ù—É–∂–Ω–æ ${fmt(req)} ‚ô™`);
      return;
    }
    state.rebirths += 1;

    // —Ä–æ—Å—Ç —Å–∏–ª—ã –∫–ª–∏–∫–∞ –ø–æ—Å–ª–µ —Ä–µ–±—ë—Ä—Å–∞
    const gain = 1.40 + state.rebirths*0.06;
    state.clickMultFromRebirth *= gain;
    // –Ω–µ–º–Ω–æ–≥–æ –¥–æ–ø. –æ—Ç —Å–∏–ª—ã —Ä–µ–±—ë—Ä—Å–∞
    state.clickMultFromRebirth *= (1 + (rebirthPower()-1)*0.15);

    // reset "—Å—Ç—É–¥–∏–∏"
    state.notes = 0;
    state.upgrades = {};

    // —à–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞
    if (Math.random() < (0.12 + state.donate.vipLuck*0.05)){
      const g = 8 + state.donate.vipLuck*3;
      state.gems += g;
      log(`üíé –ü–æ–¥–∞—Ä–æ–∫ –∑–∞ —Ä–µ–±—ë—Ä—Å: +${g}üíé`);
      toast("–ü–æ–¥–∞—Ä–æ–∫!", `+${g}üíé`);
    }

    log(`‚ôªÔ∏è –ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ #${state.rebirths}. –£—Å–∏–ª–µ–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –≤—ã—Ä–æ—Å–ª–æ.`);
    toast("–ü–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏–µ!", `–¢–µ–ø–µ—Ä—å —Ä–µ–±—ë—Ä—Å–æ–≤: ${state.rebirths}`);
    renderAll();
    save();
    go("rebirth");
  }

  // events
  function maybeEvent(){
    const t = now();
    if (t - state.lastEvent < 10_000) return;

    const chance = 0.07 + state.donate.vipLuck*0.03 + Math.min(0.08, state.rebirths*0.004);
    if (Math.random() > chance) return;
    state.lastEvent = t;

    const roll = Math.random();
    if (roll < 0.45){
      const bonus = Math.max(10, Math.floor(computeClick() * (25 + Math.random()*40)));
      state.notes += bonus;
      log(`üéÅ –¢—Ä–µ–Ω–¥—ã: +${fmt(bonus)} ‚ô™`);
      toast("–¢—ã –≤ —Ç—Ä–µ–Ω–¥–∞—Ö!", `+${fmt(bonus)} ‚ô™`);
    } else if (roll < 0.78){
      state.__temp = { mult: 1.25 + Math.random()*0.45, until: t + 20_000 };
      log(`‚ö° –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ: –∫–ª–∏–∫–∏ √ó${state.__temp.mult.toFixed(2)} –Ω–∞ 20 —Å–µ–∫`);
      toast("–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ!", `–ö–ª–∏–∫–∏ √ó${state.__temp.mult.toFixed(2)} –Ω–∞ 20 —Å–µ–∫`);
    } else {
      const g = 5 + Math.floor(Math.random()*8) + state.donate.vipLuck*2;
      state.gems += g;
      log(`üíé –§–∞–Ω–∞—Ç: +${g}üíé`);
      toast("–§–∞–Ω–∞—Ç –∑–∞–¥–æ–Ω–∞—Ç–∏–ª!", `+${g}üíé`);
    }
  }
  function applyTemp(v){
    const b = state.__temp;
    if (!b) return v;
    if (now() > b.until){ state.__temp = null; return v; }
    return v * b.mult;
  }

  // Save/Load
  function save(){
    state.lastSave = now();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }
  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return false;
    try{ Object.assign(state, JSON.parse(raw)); return true; } catch { return false; }
  }
  function offline(){
    const t = now();
    const dt = Math.max(0, (t - (state.lastTick || t)) / 1000);
    if (dt < 3) return;
    let eff = 0.35 + state.donate.offlineBoost*0.25;
    eff = Math.min(1.0, eff);
    const gain = computeNPS() * dt * eff;
    if (gain > 1){
      state.notes += gain;
      log(`üïí –û—Ñ—Ñ–ª–∞–π–Ω: +${fmt(gain)} ‚ô™ –∑–∞ ${Math.floor(dt)} —Å–µ–∫`);
      toast("–û—Ñ—Ñ–ª–∞–π–Ω –¥–æ—Ö–æ–¥", `+${fmt(gain)} ‚ô™`);
    }
  }

  // Render UI
  function renderStats(){
    $("#notes").textContent = fmt(state.notes);
    $("#npc").textContent = fmt(applyTemp(computeClick()));
    $("#nps").textContent = fmt(computeNPS());
    $("#reb").textContent = fmt(state.rebirths);
    $("#gems").textContent = fmt(state.gems);
    $("#vip").textContent = fmt(state.donate.vipLuck);
    $("#offb").textContent = fmt(state.donate.offlineBoost);
    $("#gems2").textContent = fmt(state.gems);

    const req = nextRebReq();
    const left = Math.max(0, req - state.notes);
    $("#goalLine").textContent = left<=0
      ? `–¶–µ–ª—å: –≥–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—é (–Ω—É–∂–Ω–æ ${fmt(req)} ‚ô™)`
      : `–¶–µ–ª—å: –¥–æ –ø–µ—Ä–µ—Ä–æ–∂–¥–µ–Ω–∏—è –µ—â—ë ${fmt(left)} ‚ô™ (–Ω—É–∂–Ω–æ ${fmt(req)} ‚ô™)`;

    $("#rebReq").textContent = fmt(req);
    $("#rebNow").textContent = fmt(state.notes);
    $("#rebPower").textContent = "√ó" + rebirthPower().toFixed(2);
    $("#rebirthBtn").disabled = state.notes < req;
  }

  function renderUpgrades(){
    const basic = $("#basicList");
    basic.innerHTML = "";
    for (const u of BASIC_UPGRADES){
      const l = lvl(u.id);
      const c = cost(u);
      const can = state.notes >= c;

      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div>
          <div class="name">${u.name} <span class="tag">${u.tag}</span></div>
          <div class="desc">${u.desc}</div>
          <div class="meta">
            <span class="tag">–£—Ä. ${l}</span>
            <span class="tag">–¶–µ–Ω–∞: ${fmt(c)} ‚ô™</span>
          </div>
        </div>
        <div><button class="btn ${can?'good':''}" ${can?'':'disabled'}>–ö—É–ø–∏—Ç—å</button></div>
      `;
      el.querySelector("button").addEventListener("click", ()=>{
        if (state.notes < c) return;
        state.notes -= c;
        state.upgrades[u.id] = l+1;
        log(`üõ†Ô∏è –ö—É–ø–ª–µ–Ω–æ: ${u.name} (—É—Ä. ${l+1})`);
        renderAll();
        save();
      });
      basic.appendChild(el);
    }

    const locked = $("#lockedList");
    locked.innerHTML = "";
    for (const u of LOCKED_UPGRADES){
      const owned = !!state.lockedBought[u.id];
      const unlocked = state.rebirths >= u.reqReb;
      const can = unlocked && !owned && state.notes >= u.cost;

      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div>
          <div class="name">${u.name}
            ${owned ? `<span class="tag vip">–ö—É–ø–ª–µ–Ω–æ</span>` : (unlocked ? `<span class="tag reb">–û—Ç–∫—Ä—ã—Ç–æ</span>` : `<span class="tag lock">–ó–∞–∫—Ä—ã—Ç–æ</span>`)}
          </div>
          <div class="desc">${u.desc}</div>
          <div class="meta">
            <span class="tag">–¢—Ä–µ–±.: ${u.reqReb} —Ä–µ–±.</span>
            <span class="tag">–¶–µ–Ω–∞: ${fmt(u.cost)} ‚ô™</span>
          </div>
        </div>
        <div><button class="btn ${can?'acc':''}" ${can?'':'disabled'}>${owned?"–ï—Å—Ç—å":(unlocked?"–ö—É–ø–∏—Ç—å":"–ù—É–∂–Ω–æ —Ä–µ–±.")}</button></div>
      `;
      el.querySelector("button").addEventListener("click", ()=>{
        if (!can) return;
        state.notes -= u.cost;
        state.lockedBought[u.id] = true;
        u.apply(state);
        log(`üîì –û—Ç–∫—Ä—ã—Ç–æ: ${u.name}`);
        toast("–û—Ç–∫—Ä—ã—Ç–æ!", u.name);
        renderAll();
        save();
      });
      locked.appendChild(el);
    }
  }

  function renderDonate(){
    const list = $("#donateList");
    list.innerHTML = "";
    for (const it of DONATE_ITEMS){
      const owned = it.owned(state);
      const can = !owned && state.gems >= it.price;

      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div>
          <div class="name">${it.name} ${owned?`<span class="tag vip">–£–∂–µ –µ—Å—Ç—å</span>`:""}</div>
          <div class="desc">${it.desc}</div>
          <div class="meta"><span class="tag">–¶–µ–Ω–∞: ${it.price} üíé</span></div>
        </div>
        <div><button class="btn ${can?'good':''}" ${can?'':'disabled'}>${owned?"–ö—É–ø–ª–µ–Ω–æ":"–ö—É–ø–∏—Ç—å"}</button></div>
      `;
      el.querySelector("button").addEventListener("click", ()=>{
        if (!can) return;
        state.gems -= it.price;
        it.buy(state);
        log(`üíé –î–æ–Ω–∞—Ç: ${it.name}`);
        toast("–ö—É–ø–ª–µ–Ω–æ", it.name);
        renderAll();
        save();
      });
      list.appendChild(el);
    }
  }

  function renderLog(){
    const box = $("#logList");
    box.innerHTML = "";
    if (!state.log.length){
      const e = document.createElement("div");
      e.className = "sub";
      e.textContent = "–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ö–ª–∏–∫–∞–π—Ç–µ ‚ô™ –∏ –ø–æ–∫—É–ø–∞–π—Ç–µ –∞–ø–≥—Ä–µ–π–¥—ã.";
      box.appendChild(e);
      return;
    }
    for (const l of state.log){
      const el = document.createElement("div");
      el.className = "item";
      el.innerHTML = `
        <div>
          <div class="name">${l.msg}</div>
          <div class="desc">${l.t}</div>
        </div>
        <div><span class="tag">LOG</span></div>
      `;
      box.appendChild(el);
    }
  }

  function renderAll(){
    renderStats();
    renderUpgrades();
    renderDonate();
    renderLog();
  }

  // Best-buy buttons
  function buyBestClick(){
    const clickUpgrades = BASIC_UPGRADES.filter(u => u.tag === "–ö–ª–∏–∫" || u.tag === "–ì–∏–±—Ä–∏–¥");
    let best = null;
    for (const u of clickUpgrades){
      const c = cost(u);
      if (state.notes >= c){
        if (!best || c < best.c) best = {u, c};
      }
    }
    if (!best){
      toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–æ—Ç", "–ù–∞ –∫–ª–∏–∫-–∞–ø–≥—Ä–µ–π–¥ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚ô™");
      return;
    }
    state.notes -= best.c;
    state.upgrades[best.u.id] = (state.upgrades[best.u.id]||0) + 1;
    log(`‚ö° –ë—ã—Å—Ç—Ä–∞—è –ø–æ–∫—É–ø–∫–∞: ${best.u.name}`);
    renderAll(); save();
  }
  function buyBestNps(){
    const npsUpgrades = BASIC_UPGRADES.filter(u => u.tag === "–ù/—Å–µ–∫" || u.tag === "–ì–∏–±—Ä–∏–¥");
    let best = null;
    for (const u of npsUpgrades){
      const c = cost(u);
      if (state.notes >= c){
        if (!best || c < best.c) best = {u, c};
      }
    }
    if (!best){
      toast("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–æ—Ç", "–ù–∞ –∞–≤—Ç–æ-–∞–ø–≥—Ä–µ–π–¥ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚ô™");
      return;
    }
    state.notes -= best.c;
    state.upgrades[best.u.id] = (state.upgrades[best.u.id]||0) + 1;
    log(`üéõÔ∏è –ë—ã—Å—Ç—Ä–∞—è –ø–æ–∫—É–ø–∫–∞: ${best.u.name}`);
    renderAll(); save();
  }

  // Navigation
  const map = {
    studio: "#screen-studio",
    upgrades: "#screen-upgrades",
    rebirth: "#screen-rebirth",
    donate: "#screen-donate",
    log: "#screen-log"
  };
  function go(key){
    $$(".screen").forEach(s => s.classList.remove("active"));
    $(map[key]).classList.add("active");
    $$(".navBtn").forEach(b => b.classList.toggle("active", b.dataset.go === key));
  }
  $$(".navBtn").forEach(b => b.addEventListener("click", ()=>go(b.dataset.go)));

  // UI actions
  $("#clickBtn").addEventListener("click", (e)=>{
    const gain = applyTemp(computeClick());
    state.notes += gain;

    const rect = e.currentTarget.getBoundingClientRect();
    const x = rect.left + rect.width/2 + (Math.random()*2-1)*70;
    const y = rect.top + rect.height/2 + (Math.random()*2-1)*35;
    spark(x,y,`+${fmt(gain)}‚ô™`);

    maybeEvent();
    renderStats();
  });

  $("#buyBestClick").addEventListener("click", buyBestClick);
  $("#buyBestNps").addEventListener("click", buyBestNps);

  $("#rebirthBtn").addEventListener("click", doRebirth);
  $("#rebirthHelp").addEventListener("click", ()=>{
    toast("–ö–∞–∫ —Ä–µ–±—ë—Ä—Å —Ä–∞–±–æ—Ç–∞–µ—Ç",
      "–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–æ—Ç—ã –∏ –±–∞–∑–æ–≤—ã–µ –∞–ø–≥—Ä–µ–π–¥—ã, –Ω–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –∫–ª–∏–∫–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–∫—Ä—ã—Ç—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ä–µ–±—ë—Ä—Å–æ–≤."
    );
  });

  $("#freeGems").addEventListener("click", ()=>{
    state.gems += 50;
    log("üéÅ –¢–µ—Å—Ç: +50üíé");
    toast("–ü–æ–¥–∞—Ä–æ–∫", "+50üíé");
    renderAll(); save();
  });

  $("#clearLog").addEventListener("click", ()=>{
    state.log = [];
    toast("–û–∫", "–õ–æ–≥ –æ—á–∏—â–µ–Ω");
    renderAll(); save();
  });

  $("#hardReset").addEventListener("click", ()=>{
    if (!confirm("–ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å? –£–¥–∞–ª–∏—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.")) return;
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  });

  // Main loop
  function tick(){
    const t = now();
    const dt = (t - state.lastTick) / 1000;
    state.lastTick = t;

    const nps = computeNPS();
    if (nps > 0) state.notes += nps * dt;

    maybeEvent();
    renderStats();

    if (t - state.lastSave > 2500) save();
    requestAnimationFrame(tick);
  }

  // Boot
  const loaded = load();
  if (!loaded){
    log("üéõÔ∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å. –ñ–º–∏ ‚ô™, –∫–∞—á–∞–π—Å—è, –¥–µ–ª–∞–π —Ä–µ–±—ë—Ä—Å—ã.");
    toast("NOTECRAFT", "–ù–∞–≤–∏–≥–∞—Ü–∏—è —Å–Ω–∏–∑—É. –°—Ç—É–¥–∏—è ‚Üí –ê–ø–≥—Ä–µ–π–¥—ã ‚Üí –†–µ–±—ë—Ä—Å.");
  } else {
    offline();
    toast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ", "–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω.");
  }

  renderAll();
  requestAnimationFrame(()=>{ state.lastTick = now(); tick(); });
})();
</script>
</body>
  </html>
