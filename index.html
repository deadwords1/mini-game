<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NEON MARKET // AAA UI (Fiction)</title>
  <style>
    :root{
      color-scheme: dark;

      /* Core palette */
      --bg0:#04040a;
      --bg1:#070816;
      --ink:#ffffff;
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.46);

      --v:#7C3AED;  /* violet */
      --p:#EC4899;  /* pink */
      --c:#22D3EE;  /* cyan */
      --g:#34D399;  /* green */
      --y:#FBBF24;  /* amber */
      --r:#FB7185;  /* rose */

      /* Surfaces */
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.09);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --shadow: 0 30px 120px rgba(0,0,0,.70);

      --rad: 22px;
      --navH: 80px;
      --safeBottom: env(safe-area-inset-bottom, 0px);

      /* Motion */
      --t1: 140ms;
      --t2: 240ms;
      --ease: cubic-bezier(.2,.9,.2,1);
      --ease2: cubic-bezier(.16, 1, .3, 1);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--ink);
      background: radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.16), transparent 60%),
                  radial-gradient(1200px 800px at 80% 8%, rgba(236,72,153,.12), transparent 60%),
                  radial-gradient(1200px 800px at 50% 92%, rgba(34,211,238,.10), transparent 62%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* AAA background stack */
    .bg{
      position: fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
    }
    .bg::before{
      content:"";
      position:absolute;
      inset:-15%;
      background:
        radial-gradient(circle at 20% 20%, rgba(124,58,237,.22), transparent 55%),
        radial-gradient(circle at 80% 25%, rgba(236,72,153,.18), transparent 56%),
        radial-gradient(circle at 55% 86%, rgba(34,211,238,.14), transparent 58%);
      filter: blur(30px);
      opacity:.95;
      animation: drift 16s var(--ease2) infinite alternate;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      from{ transform: translate3d(-1.5%, -1.0%, 0) scale(1.02); }
      to  { transform: translate3d( 1.8%,  1.2%, 0) scale(1.06); }
    }
    .bg::after{
      content:"";
      position:absolute;
      inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      opacity:.18;
      mix-blend-mode: overlay;
    }

    canvas#fx{
      position: fixed;
      inset:0;
      z-index:1;
      pointer-events:none;
      opacity:.85;
    }

    /* App shell */
    .app{
      position:relative;
      z-index:2;
      min-height:100%;
      padding-bottom: calc(var(--navH) + 28px + var(--safeBottom));
    }
    .wrap{
      max-width: 1220px;
      margin:0 auto;
      padding: 16px 16px;
    }

    /* Top HUD */
    .hud{
      position: sticky;
      top: 10px;
      z-index: 4;
      border-radius: 28px;
      border:1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hud::before{
      content:"";
      position:absolute; inset:-60%;
      background:
        radial-gradient(circle at 20% 20%, rgba(124,58,237,.18), transparent 60%),
        radial-gradient(circle at 85% 25%, rgba(236,72,153,.14), transparent 62%),
        radial-gradient(circle at 55% 92%, rgba(34,211,238,.12), transparent 62%);
      opacity:.95;
      pointer-events:none;
    }
    .hudIn{
      position:relative;
      z-index:1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 260px;
      user-select:none;
    }
    .logo{
      width:52px; height:52px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 30% 30%, rgba(34,211,238,.44), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(236,72,153,.38), transparent 55%),
        linear-gradient(135deg, rgba(124,58,237,.52), rgba(236,72,153,.22));
      box-shadow:
        0 0 0 7px rgba(124,58,237,.07),
        0 18px 60px rgba(0,0,0,.40);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-70%;
      background: conic-gradient(from 210deg, transparent, rgba(255,255,255,.14), transparent);
      animation: spin 9.5s linear infinite;
      opacity:.65;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    .brandText b{
      display:block;
      font-weight:1100;
      letter-spacing:.3px;
      font-size:14px;
    }
    .brandText span{
      display:block;
      margin-top:4px;
      font-size:12px;
      color: var(--muted);
      letter-spacing:.15px;
    }

    .hudStats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
    }
    .stat{
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      min-width: 150px;
      transition: transform var(--t2) var(--ease), border-color var(--t2) var(--ease);
    }
    .stat:hover{
      transform: translateY(-1px);
      border-color: rgba(236,72,153,.22);
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: rgba(236,72,153,.92);
      box-shadow: 0 0 18px rgba(236,72,153,.20);
    }
    .dot.c{ background: rgba(34,211,238,.95); box-shadow: 0 0 18px rgba(34,211,238,.18); }
    .dot.g{ background: rgba(52,211,153,.92); box-shadow: 0 0 18px rgba(52,211,153,.16); }
    .sk{ font-size:11px; color: var(--muted); font-weight:950; letter-spacing:.15px; }
    .sv{ font-size:14px; font-weight:1150; letter-spacing:.2px; font-variant-numeric: tabular-nums; }

    /* Main layout */
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      margin-top: 14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns:1fr; }
      .stat{ min-width: 140px; }
    }

    .card{
      border-radius: var(--rad);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(16px);
      box-shadow: 0 18px 70px rgba(0,0,0,.28);
      overflow:hidden;
      position:relative;
      transform: translateZ(0);
    }
    .card::before{
      content:"";
      position:absolute; inset:-65%;
      background:
        radial-gradient(circle at 20% 20%, rgba(124,58,237,.14), transparent 60%),
        radial-gradient(circle at 82% 30%, rgba(236,72,153,.12), transparent 62%),
        radial-gradient(circle at 52% 92%, rgba(34,211,238,.10), transparent 62%);
      opacity:.95;
      pointer-events:none;
    }
    .cardIn{
      position:relative;
      z-index:1;
      padding: 14px;
    }
    .cardHead{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      margin-bottom: 10px;
      flex-wrap:wrap;
    }
    .cardHead b{
      font-weight:1150;
      letter-spacing:.22px;
      font-size:13px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-weight:950;
      font-size:11px;
      color: rgba(255,255,255,.84);
      white-space:nowrap;
    }
    .tag.good{ border-color: rgba(52,211,153,.22); }
    .tag.warn{ border-color: rgba(251,191,36,.22); }
    .tag.bad { border-color: rgba(251,113,133,.22); }

    /* Buttons */
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding: 11px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:#fff;
      font-weight:1150;
      cursor:pointer;
      user-select:none;
      transition: transform var(--t1) var(--ease), filter var(--t1) var(--ease),
                  border-color var(--t2) var(--ease), box-shadow var(--t2) var(--ease);
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
      white-space:nowrap;
    }
    .btn::after{
      content:"";
      position:absolute; inset:-80%;
      background: conic-gradient(from 210deg, transparent, rgba(255,255,255,.12), transparent);
      opacity:.0;
      transition: opacity var(--t2) var(--ease);
      pointer-events:none;
    }
    .btn:hover{
      filter: brightness(1.08);
      border-color: rgba(236,72,153,.26);
      box-shadow: 0 14px 50px rgba(0,0,0,.25), 0 0 44px rgba(236,72,153,.08);
      transform: translateY(-1px);
    }
    .btn:hover::after{ opacity:.35; }
    .btn:active{ transform: translateY(0) scale(.992); }
    .btn.primary{
      border-color: rgba(236,72,153,.26);
      background: linear-gradient(135deg, rgba(124,58,237,.24), rgba(236,72,153,.14));
    }
    .btn.ghost{
      background: rgba(0,0,0,.18);
    }
    .btn.danger{
      border-color: rgba(251,113,133,.28);
      background: linear-gradient(135deg, rgba(251,113,133,.16), rgba(255,255,255,.06));
    }
    .btn.small{ padding:9px 11px; border-radius:14px; font-size:12px; }
    .btn.full{ width:100%; }

    .help{
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }

    /* Table */
    table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
    th,td{ text-align:left; padding:10px 12px; font-size:12px; }
    th{
      color: var(--muted2);
      font-weight:950;
      letter-spacing:.18px;
      text-transform:uppercase;
      font-size:11px;
    }
    tr.row{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
    }
    tr.row td:first-child{ border-top-left-radius:16px; border-bottom-left-radius:16px; }
    tr.row td:last-child{ border-top-right-radius:16px; border-bottom-right-radius:16px; }
    .mono{ font-variant-numeric: tabular-nums; }
    .pos{ color: var(--g); font-weight:1000; }
    .neg{ color: var(--r); font-weight:1000; }

    /* Quantity stepper */
    .stepper{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 8px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      backdrop-filter: blur(10px);
      user-select:none;
    }
    .stepper button{
      width:30px;height:30px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color:#fff;
      font-weight:1150;
      cursor:pointer;
      transition: transform var(--t1) var(--ease), filter var(--t1) var(--ease), border-color var(--t2) var(--ease);
    }
    .stepper button:hover{ filter:brightness(1.08); border-color: rgba(34,211,238,.22); transform: translateY(-1px); }
    .stepper button:active{ transform: scale(.98); }
    .stepper .q{
      min-width: 28px;
      text-align:center;
      font-weight:1150;
      font-variant-numeric: tabular-nums;
    }

    /* Mini chart */
    .chart{
      width: 120px;
      height: 36px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .chart canvas{
      width:100%;
      height:100%;
      display:block;
    }

    /* Tiles in right panel */
    .tiles{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
      margin-top: 10px;
    }
    @media (max-width: 480px){
      .tiles{ grid-template-columns:1fr; }
    }
    .tile{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 12px;
      transition: transform var(--t2) var(--ease), border-color var(--t2) var(--ease), box-shadow var(--t2) var(--ease);
      transform: translateZ(0);
    }
    .tile:hover{
      transform: translateY(-2px);
      border-color: rgba(34,211,238,.22);
      box-shadow: 0 18px 60px rgba(0,0,0,.22);
    }
    .tile b{ display:block; font-weight:1150; letter-spacing:.2px; }
    .tile p{ margin:6px 0 10px; color: var(--muted); font-size:12px; line-height:1.4; }
    .tile .foot{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .tile .foot span{ color: rgba(255,255,255,.84); font-weight:1000; font-variant-numeric: tabular-nums; }

    .split{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top: 10px;
    }

    /* Bottom nav */
    .bottomNav{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(12px + var(--safeBottom));
      width: min(1000px, calc(100% - 24px));
      height: var(--navH);
      border-radius: 28px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(8,10,20,.62);
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      z-index: 20;
      overflow:hidden;
    }
    .bottomNav::before{
      content:"";
      position:absolute; inset:-60%;
      background:
        radial-gradient(circle at 20% 40%, rgba(124,58,237,.14), transparent 60%),
        radial-gradient(circle at 80% 30%, rgba(236,72,153,.12), transparent 62%),
        radial-gradient(circle at 60% 90%, rgba(34,211,238,.10), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }
    .navItem{
      flex: 1 1 0;
      height: 56px;
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      font-weight:1150;
      transition: transform var(--t2) var(--ease), border-color var(--t2) var(--ease), filter var(--t2) var(--ease);
      position:relative;
      z-index:1;
      user-select:none;
    }
    .navItem:hover{
      border-color: rgba(34,211,238,.22);
      transform: translateY(-1px);
      filter: brightness(1.05);
    }
    .navItem.active{
      border-color: rgba(236,72,153,.26);
      background: linear-gradient(135deg, rgba(124,58,237,.18), rgba(236,72,153,.12));
      box-shadow: 0 0 40px rgba(236,72,153,.08);
    }
    .navIcon{
      width:34px;height:34px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      display:grid;place-items:center;
      font-size:18px;
    }
    .navLabel{ display:flex; flex-direction:column; line-height:1.05; }
    .navLabel small{ font-size:10px; color: var(--muted2); font-weight:950; }

    /* FAB Month */
    .fabWrap{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(var(--navH) + 18px + var(--safeBottom));
      z-index: 21;
      display:grid;
      place-items:center;
      gap:10px;
    }
    .fab{
      width:66px;height:66px;border-radius: 26px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(135deg, rgba(124,58,237,.36), rgba(236,72,153,.22));
      backdrop-filter: blur(18px);
      box-shadow:
        0 26px 80px rgba(0,0,0,.46),
        0 0 54px rgba(236,72,153,.10);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      transition: transform var(--t2) var(--ease), filter var(--t2) var(--ease);
      position:relative;
      overflow:hidden;
    }
    .fab::after{
      content:"";
      position:absolute; inset:-70%;
      background: conic-gradient(from 210deg, transparent, rgba(255,255,255,.14), transparent);
      animation: spin 12s linear infinite;
      opacity:.40;
      pointer-events:none;
    }
    .fab:hover{ transform: translateY(-2px); filter: brightness(1.08); }
    .fab:active{ transform: translateY(-1px) scale(.995); }
    .fab span{
      font-size: 30px;
      font-weight: 1150;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }
    .fabHint{
      padding: 8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.26);
      backdrop-filter: blur(16px);
      font-size:11px;
      font-weight:1000;
      color: rgba(255,255,255,.84);
      opacity:.0;
      transform: translateY(6px);
      transition: opacity var(--t2) var(--ease), transform var(--t2) var(--ease);
      pointer-events:none;
    }
    .fab:hover ~ .fabHint{ opacity:1; transform: translateY(0); }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(var(--navH) + 128px + var(--safeBottom));
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(8,10,20,.72);
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow);
      font-weight:1150;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition: opacity var(--t2) var(--ease), transform var(--t2) var(--ease);
      z-index: 60;
      max-width: min(720px, calc(100% - 28px));
      text-align:center;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-4px); }

    /* Modals */
    .backdrop{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      background: rgba(0,0,0,.66);
      z-index: 100;
    }
    .backdrop.show{ display:flex; }
    .modal{
      width:min(1100px, 100%);
      max-height: min(86vh, 900px);
      overflow:auto;
      border-radius: 28px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,12,22,.92);
      backdrop-filter: blur(20px);
      box-shadow: var(--shadow);
      position:relative;
    }
    .modal::before{
      content:"";
      position:absolute; inset:-60%;
      background:
        radial-gradient(circle at 20% 20%, rgba(124,58,237,.18), transparent 60%),
        radial-gradient(circle at 82% 30%, rgba(236,72,153,.14), transparent 62%),
        radial-gradient(circle at 52% 92%, rgba(34,211,238,.12), transparent 62%);
      opacity:.95;
      pointer-events:none;
    }
    .mHead{
      position:sticky;
      top:0;
      z-index:2;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px 12px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(10,12,22,.92);
      backdrop-filter: blur(20px);
    }
    .mHead b{ font-weight:1150; letter-spacing:.2px; }
    .mBody{ position:relative; z-index:1; padding: 12px; }
    .hr{ height:1px; background: rgba(255,255,255,.08); margin: 12px 0; }

    /* Inputs */
    input,select,textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:#fff;
      outline:none;
      font-weight:950;
      transition: border-color var(--t2) var(--ease), box-shadow var(--t2) var(--ease);
    }
    textarea{ min-height: 140px; font-weight:850; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    input:focus,select:focus,textarea:focus{
      border-color: rgba(236,72,153,.28);
      box-shadow: 0 0 0 4px rgba(236,72,153,.08);
    }
    .field{ display:grid; gap:8px; }
    .field label{ font-size:11px; color: var(--muted); font-weight:950; letter-spacing:.12px; }

    .cols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 900px){
      .cols{ grid-template-columns:1fr; }
    }

    /* Admin Tabs */
    .tabs{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .tab{
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color:#fff;
      font-weight:1100;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition: transform var(--t1) var(--ease), border-color var(--t2) var(--ease), filter var(--t2) var(--ease);
    }
    .tab:hover{ transform: translateY(-1px); border-color: rgba(34,211,238,.22); filter: brightness(1.05); }
    .tab.active{
      border-color: rgba(236,72,153,.26);
      background: linear-gradient(135deg, rgba(124,58,237,.16), rgba(236,72,153,.10));
      box-shadow: 0 0 40px rgba(236,72,153,.06);
    }

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 10px;
    }
    .toolbar .left, .toolbar .right{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }

    .pill{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      font-weight:1000;
      font-variant-numeric: tabular-nums;
    }
    .pill b{
      font-weight:1150;
      background: linear-gradient(90deg, rgba(124,58,237,.98), rgba(236,72,153,.98));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ animation-duration: 0.001ms !important; animation-iteration-count:1 !important; transition-duration: 0.001ms !important; }
    }
  </style>
</head>

<body>
  <div class="bg"></div>
  <canvas id="fx"></canvas>

  <div class="app">
    <div class="wrap">
      <div class="hud">
        <div class="hudIn">
          <div class="brand">
            <div class="logo"></div>
            <div class="brandText">
              <b>NEON MARKET // AAA UI</b>
              <span>–≤—ã–º—ã—à–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∞ ‚Ä¢ —ç–∫–æ–Ω–æ–º–∏–∫–∞ ‚Ä¢ —Ä–∏—Å–∫-–∏–≤–µ–Ω—Ç—ã ‚Ä¢ –∞–¥–º–∏–Ω–∫–∞ 2.0</span>
            </div>
          </div>

          <div class="hudStats">
            <div class="stat"><div class="dot"></div><div><div class="sk">–ú–µ—Å—è—Ü</div><div class="sv" id="uiMonth">1</div></div></div>
            <div class="stat"><div class="dot c"></div><div><div class="sk">Heat</div><div class="sv" id="uiHeat">0%</div></div></div>
            <div class="stat"><div class="dot g"></div><div><div class="sk">Cash</div><div class="sv" id="uiCash">$0</div></div></div>
          </div>
        </div>
      </div>

      <!-- PAGES -->
      <section id="page-market">
        <div class="grid">
          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–†—ã–Ω–æ–∫</b>
                  <div class="help">–¶–µ–Ω—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏. –ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º.</div>
                </div>
                <span class="tag" id="uiRisk">–†–∏—Å–∫: 0%</span>
              </div>

              <table>
                <thead>
                  <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>Trend</th>
                    <th class="mono">Buy</th>
                    <th class="mono">Sell</th>
                    <th>Qty</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="marketRows"></tbody>
              </table>

              <div class="hr"></div>

              <div class="cols">
                <div class="pill"><span>–°–∫–ª–∞–¥</span><b id="uiCap">0/0</b></div>
                <div class="pill"><span>–û—Ü–µ–Ω–∫–∞ —Å–∫–ª–∞–¥–∞</span><b id="uiInvValue">$0</b></div>
              </div>

              <div class="toolbar">
                <div class="left">
                  <button class="btn small" id="btnSave">üíæ Save</button>
                  <button class="btn small danger" id="btnReset">‚ôªÔ∏è Reset</button>
                  <button class="btn small" id="btnAdmin">üõ†Ô∏è Admin</button>
                </div>
                <div class="right">
                  <button class="btn small primary" id="btnSellAll">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
                </div>
              </div>

              <div style="height:10px"></div>
              <div class="help" id="uiHint"></div>
            </div>
          </div>

          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–°–æ—Å—Ç–æ—è–Ω–∏–µ</b>
                  <div class="help">–ê–∫—Ç–∏–≤—ã, –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.</div>
                </div>
                <span class="tag" id="uiAssets">‚Äî</span>
              </div>

              <div class="tiles">
                <div class="tile">
                  <b>–°–Ω–∏–∑–∏—Ç—å Heat</b>
                  <p>–ü–ª–∞—Ç–∏—à—å ‚Üí Heat –ø–∞–¥–∞–µ—Ç. –•–æ—Ä–æ—à–æ –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ–π.</p>
                  <div class="foot">
                    <span id="uiCoolCost">$0</span>
                    <button class="btn small" id="btnCool">–°–Ω–∏–∑–∏—Ç—å</button>
                  </div>
                </div>

                <div class="tile">
                  <b>–ó–∞—â–∏—Ç–∞</b>
                  <p>–°–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –∏ –ø–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å —É–π—Ç–∏.</p>
                  <div class="foot">
                    <span id="uiArmorCost">$0</span>
                    <button class="btn small" id="btnArmor">–ö—É–ø–∏—Ç—å</button>
                  </div>
                </div>

                <div class="tile">
                  <b>–®–∞–Ω—Å —É–π—Ç–∏</b>
                  <p>–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –º–∞—à–∏–Ω—ã/–ø–µ—Ä–∫–æ–≤ –∏ Heat.</p>
                  <div class="foot">
                    <span id="uiRunChance">0%</span>
                    <button class="btn small ghost" id="btnGoAssets">–ê–∫—Ç–∏–≤—ã</button>
                  </div>
                </div>

                <div class="tile">
                  <b>–î–æ—Ö–æ–¥ –±–∏–∑–Ω–µ—Å–∞</b>
                  <p>–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
                  <div class="foot">
                    <span id="uiIncome">$0</span>
                    <button class="btn small ghost" id="btnGoAssets2">–ë–∏–∑–Ω–µ—Å</button>
                  </div>
                </div>
              </div>

              <div class="hr"></div>
              <div class="help">–°–æ–±—ã—Ç–∏—è –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ: –≤—ã–±—Ä–æ—Å–∏—Ç—å –≥—Ä—É–∑ / —É–π—Ç–∏ / ‚Äú–≤–∑—è—Ç–∫–∞‚Äù (–≤—Å—ë ‚Äî –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞).</div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-inventory" style="display:none;">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</b>
                  <div class="help">Qty, Avg, –æ—Ü–µ–Ω–∫–∞ –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å.</div>
                </div>
                <span class="tag" id="uiProfitTag">–ü—Ä–æ—Ñ–∏—Ç: $0</span>
              </div>

              <table>
                <thead>
                  <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th class="mono">Qty</th>
                    <th class="mono">Avg</th>
                    <th class="mono">–û—Ü–µ–Ω–∫–∞</th>
                    <th class="mono">Œî</th>
                  </tr>
                </thead>
                <tbody id="invRows"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <section id="page-assets" style="display:none;">
        <div class="grid">
          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–ú–∞—à–∏–Ω—ã</b>
                  <div class="help">–ú–∞—à–∏–Ω–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —à–∞–Ω—Å —É–π—Ç–∏ –∏ ‚ÄúHeat multiplier‚Äù.</div>
                </div>
                <span class="tag" id="uiCarTag">‚Äî</span>
              </div>

              <table>
                <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="mono">–¶–µ–Ω–∞</th><th class="mono">–£–π—Ç–∏</th><th class="mono">HeatMul</th><th></th></tr></thead>
                <tbody id="carRows"></tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–ë–∞–∑–∞ –∏ –ë–∏–∑–Ω–µ—Å</b>
                  <div class="help">–ë–∞–∑–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–ª–∞–¥. –ë–∏–∑–Ω–µ—Å –ø–ª–∞—Ç–∏—Ç –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü.</div>
                </div>
                <span class="tag" id="uiHomeBizTag">‚Äî</span>
              </div>

              <div class="cols">
                <div>
                  <div class="split" style="justify-content:space-between;">
                    <span class="tag">üè† –ë–∞–∑–∞</span>
                    <span class="tag" id="uiHome">‚Äî</span>
                  </div>
                  <table>
                    <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="mono">–¶–µ–Ω–∞</th><th class="mono">–ö–∞–ø</th><th></th></tr></thead>
                    <tbody id="homeRows"></tbody>
                  </table>
                </div>
                <div>
                  <div class="split" style="justify-content:space-between;">
                    <span class="tag">üè≠ –ë–∏–∑–Ω–µ—Å</span>
                    <span class="tag" id="uiBiz">‚Äî</span>
                  </div>
                  <table>
                    <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="mono">–¶–µ–Ω–∞</th><th class="mono">–î–æ—Ö–æ–¥/–º–µ—Å</th><th></th></tr></thead>
                    <tbody id="bizRows"></tbody>
                  </table>
                </div>
              </div>

              <div class="hr"></div>
              <div class="pill"><span>–¢–µ–∫—É—â–∏–π –¥–æ—Ö–æ–¥/–º–µ—Å</span><b id="uiIncome2">$0</b></div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-upgrades" style="display:none;">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–ü–µ—Ä–∫–∏</b>
                  <div class="help">–°–∫–∏–¥–∫–∏/–ø—Ä–∏–±—ã–ª—å/—Ä–∏—Å–∫. –ü—Ä–æ–∫–∞—á–∫–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Å—å –≥–µ–π–º–ø–ª–µ–π.</div>
                </div>
                <span class="tag">Upgrades</span>
              </div>

              <div class="cols" id="perkCards"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-log" style="display:none;">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="cardIn">
              <div class="cardHead">
                <div>
                  <b>–õ–µ–Ω—Ç–∞</b>
                  <div class="help">–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∏ —Å–æ–±—ã—Ç–∏–π. –£–¥–æ–±–Ω–æ –¥–µ–±–∞–∂–∏—Ç—å –±–∞–ª–∞–Ω—Å.</div>
                </div>
                <div class="split">
                  <button class="btn small" id="btnClearLog">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
              </div>

              <div id="logBox" style="display:grid;gap:10px"></div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- FAB month -->
  <div class="fabWrap">
    <div class="fab" id="fabMonth" title="–ü—Ä–æ–∂–∏—Ç—å –º–µ—Å—è—Ü"><span>Ôºã</span></div>
    <div class="fabHint">–ü—Ä–æ–∂–∏—Ç—å –º–µ—Å—è—Ü</div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottomNav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="navItem active" data-go="market">
      <div class="navIcon">üßø</div>
      <div class="navLabel">–†—ã–Ω–æ–∫<small>buy/sell</small></div>
    </div>
    <div class="navItem" data-go="inventory">
      <div class="navIcon">üéí</div>
      <div class="navLabel">–°–∫–ª–∞–¥<small>inv</small></div>
    </div>
    <div class="navItem" data-go="assets">
      <div class="navIcon">üöó</div>
      <div class="navLabel">–ê–∫—Ç–∏–≤—ã<small>cars</small></div>
    </div>
    <div class="navItem" data-go="upgrades">
      <div class="navIcon">üß¨</div>
      <div class="navLabel">–ü–µ—Ä–∫–∏<small>upg</small></div>
    </div>
    <div class="navItem" data-go="log">
      <div class="navIcon">üóÇÔ∏è</div>
      <div class="navLabel">–õ–µ–Ω—Ç–∞<small>log</small></div>
    </div>
  </nav>

  <!-- Event Modal -->
  <div class="backdrop" id="eventBack">
    <div class="modal">
      <div class="mHead">
        <b id="eventTitle">–°–æ–±—ã—Ç–∏–µ</b>
        <button class="btn small" id="eventClose">‚úï</button>
      </div>
      <div class="mBody">
        <div class="help" id="eventText"></div>
        <div class="hr"></div>
        <div class="cols">
          <div class="pill"><span>–®–∞–Ω—Å —É–π—Ç–∏</span><b id="eventRunChance">0%</b></div>
          <div class="pill"><span>–¶–µ–Ω–∞ ‚Äú–≤–∑—è—Ç–∫–∏‚Äù</span><b id="eventBribeCost">$0</b></div>
        </div>
        <div class="split" style="margin-top:12px">
          <button class="btn danger" id="actDump">üóëÔ∏è –í—ã–±—Ä–æ—Å–∏—Ç—å –≥—Ä—É–∑</button>
          <button class="btn primary" id="actRun">üèéÔ∏è –£–π—Ç–∏</button>
          <button class="btn" id="actBribe">üíµ ‚Äú–í–∑—è—Ç–∫–∞‚Äù</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Modal -->
  <div class="backdrop" id="adminBack">
    <div class="modal">
      <div class="mHead">
        <b id="adminTitle">–ê–¥–º–∏–Ω–∫–∞</b>
        <div class="split">
          <button class="btn small" id="admUndo">‚Ü∂ Undo</button>
          <button class="btn small" id="admRedo">‚Ü∑ Redo</button>
          <button class="btn small" id="adminClose">‚úï</button>
        </div>
      </div>
      <div class="mBody" id="adminBody"></div>
    </div>
  </div>

  <div class="toast" id="toast">–û–∫</div>

<script>
(() => {
  /* ========= Background FX (particles + parallax) ========= */
  const fx = document.getElementById('fx');
  const ctx = fx.getContext('2d');
  let W=0,H=0,DPR=1;
  const P=[];
  const N=140;
  let mouseX=0, mouseY=0;

  function resize(){
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    W = fx.width = Math.floor(window.innerWidth * DPR);
    H = fx.height = Math.floor(window.innerHeight * DPR);
    fx.style.width = window.innerWidth+'px';
    fx.style.height = window.innerHeight+'px';
  }
  window.addEventListener('resize', resize);
  resize();

  function rnd(a,b){ return a + Math.random()*(b-a); }

  function spawn(i){
    P[i] = {
      x:rnd(0,W), y:rnd(0,H),
      vx:rnd(-.22,.22)*DPR, vy:rnd(-.22,.22)*DPR,
      r:rnd(0.8,2.2)*DPR,
      a:rnd(.15,.75),
      t:rnd(0,Math.PI*2),
      hue: rnd(0,1) // blend between violet/pink/cyan
    };
  }
  for(let i=0;i<N;i++) spawn(i);

  window.addEventListener('pointermove',(e)=>{
    mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
    mouseY = (e.clientY / window.innerHeight - 0.5) * 2;
  }, {passive:true});

  function draw(){
    ctx.clearRect(0,0,W,H);

    // Parallax glow
    const px = mouseX * 0.06;
    const py = mouseY * 0.06;

    const g1 = ctx.createRadialGradient(W*(0.18+px),H*(0.22+py),0, W*(0.18+px),H*(0.22+py), Math.min(W,H)*0.44);
    g1.addColorStop(0,'rgba(124,58,237,0.18)');
    g1.addColorStop(1,'rgba(124,58,237,0.00)');
    ctx.fillStyle=g1; ctx.fillRect(0,0,W,H);

    const g2 = ctx.createRadialGradient(W*(0.82-px),H*(0.18+py),0, W*(0.82-px),H*(0.18+py), Math.min(W,H)*0.40);
    g2.addColorStop(0,'rgba(236,72,153,0.14)');
    g2.addColorStop(1,'rgba(236,72,153,0.00)');
    ctx.fillStyle=g2; ctx.fillRect(0,0,W,H);

    const g3 = ctx.createRadialGradient(W*(0.52),H*(0.88-py),0, W*(0.52),H*(0.88-py), Math.min(W,H)*0.46);
    g3.addColorStop(0,'rgba(34,211,238,0.12)');
    g3.addColorStop(1,'rgba(34,211,238,0.00)');
    ctx.fillStyle=g3; ctx.fillRect(0,0,W,H);

    // Particles + links
    for(const p of P){
      p.x += p.vx; p.y += p.vy;
      p.t += 0.008;
      if(p.x < -60*DPR) p.x = W+60*DPR;
      if(p.x >  W+60*DPR) p.x = -60*DPR;
      if(p.y < -60*DPR) p.y = H+60*DPR;
      if(p.y >  H+60*DPR) p.y = -60*DPR;

      const tw = (Math.sin(p.t)+1)*0.5;
      const rr = p.r*(0.8 + tw*0.9);

      // color blend
      const cV = [124,58,237];
      const cP = [236,72,153];
      const cC = [34,211,238];
      let col;
      if(p.hue < 0.5){
        const k = p.hue/0.5;
        col = [
          Math.round(cV[0]*(1-k) + cP[0]*k),
          Math.round(cV[1]*(1-k) + cP[1]*k),
          Math.round(cV[2]*(1-k) + cP[2]*k),
        ];
      }else{
        const k = (p.hue-0.5)/0.5;
        col = [
          Math.round(cP[0]*(1-k) + cC[0]*k),
          Math.round(cP[1]*(1-k) + cC[1]*k),
          Math.round(cP[2]*(1-k) + cC[2]*k),
        ];
      }

      ctx.beginPath();
      ctx.arc(p.x, p.y, rr, 0, Math.PI*2);
      ctx.fillStyle = `rgba(${col[0]},${col[1]},${col[2]},${0.06*p.a})`;
      ctx.fill();
    }

    for(let i=0;i<N;i++){
      for(let j=i+1;j<N;j++){
        const a=P[i], b=P[j];
        const dx=a.x-b.x, dy=a.y-b.y;
        const d = Math.sqrt(dx*dx+dy*dy);
        if(d < 120*DPR){
          const alpha = (1 - d/(120*DPR)) * 0.05;
          ctx.strokeStyle = `rgba(34,211,238,${alpha})`;
          ctx.beginPath();
          ctx.moveTo(a.x,a.y);
          ctx.lineTo(b.x,b.y);
          ctx.stroke();
        }
      }
    }

    requestAnimationFrame(draw);
  }
  draw();

  /* ========= Game (Fictional economy sim) ========= */
  const $ = (id)=>document.getElementById(id);
  const toastEl = $("toast");
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 1400);
  }

  function money(n){
    const sign = n<0 ? "-" : "";
    n = Math.abs(Math.floor(Number(n)||0));
    return sign + "$" + n.toLocaleString("en-US");
  }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function rnd(a,b){ return a + Math.random()*(b-a); }
  function chance(p){ return Math.random() < p; }
  function esc(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  const ITEMS = [
    { id:"moon_dust",      name:"Moon Dust",      base: 1200,  vol:1, vibe:"–ª—É–Ω–Ω–∞—è –ø—ã–ª—å" },
    { id:"neon_spice",     name:"Neon Spice",     base: 2400,  vol:1, vibe:"–Ω–µ–æ–Ω–æ–≤–∞—è —Å–ø–µ—Ü–∏—è" },
    { id:"cipher_caps",    name:"Cipher Caps",    base: 3900,  vol:1, vibe:"—à–∏—Ñ—Ä-–∫–∞–ø—Å—É–ª—ã" },
    { id:"void_resin",     name:"Void Resin",     base: 5200,  vol:2, vibe:"—Å–º–æ–ª–∞ –ø—É—Å—Ç–æ—Ç—ã" },
    { id:"pink_glass",     name:"Pink Glass",     base: 7800,  vol:2, vibe:"—Ä–æ–∑–æ–≤–æ–µ —Å—Ç–µ–∫–ª–æ" },
    { id:"aurora_crystal", name:"Aurora Crystal", base: 11000, vol:3, vibe:"–∫—Ä–∏—Å—Ç–∞–ª–ª –∞–≤—Ä–æ—Ä—ã" },
  ];

  const CARS = [
    { id:"none",    name:"–ü–µ—à–∫–æ–º",    price:0,      run:0.10, heatMul:1.16 },
    { id:"hatch",   name:"Hatchback", price:12000,  run:0.18, heatMul:1.06 },
    { id:"sedan",   name:"Sedan",     price:24000,  run:0.24, heatMul:1.00 },
    { id:"sport",   name:"Sport",     price:52000,  run:0.34, heatMul:0.92 },
    { id:"armored", name:"Armored",   price:98000,  run:0.44, heatMul:0.86 },
    { id:"ghost",   name:"Ghost GT",  price:165000, run:0.56, heatMul:0.78 },
  ];
  const HOMES = [
    { id:"room",   name:"–ö–æ–º–Ω–∞—Ç–∞",  price:0,      cap: 20 },
    { id:"flat",   name:"–ö–≤–∞—Ä—Ç–∏—Ä–∞", price:18000,  cap: 40 },
    { id:"house",  name:"–î–æ–º",      price:52000,  cap: 75 },
    { id:"villa",  name:"–í–∏–ª–ª–∞",    price:120000, cap:120 },
    { id:"bunker", name:"–ë—É–Ω–∫–µ—Ä",   price:260000, cap:200 },
  ];
  const BIZ = [
    { id:"none",      name:"–ù–µ—Ç –±–∏–∑–Ω–µ—Å–∞", price:0,      income:0 },
    { id:"laundry",   name:"–ü—Ä–∞—á–µ—á–Ω–∞—è",   price:25000,  income:1800 },
    { id:"club",      name:"–ö–ª—É–±",        price:85000,  income:6400 },
    { id:"logistics", name:"–õ–æ–≥–∏—Å—Ç–∏–∫–∞",   price:170000, income:14000 },
    { id:"empire",    name:"–ò–º–ø–µ—Ä–∏—è",     price:420000, income:38000 },
  ];
  const PERKS = [
    { id:"negotiator", name:"–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫", desc:"–°–Ω–∏–∂–∞–µ—Ç —Ü–µ–Ω—É –ø–æ–∫—É–ø–∫–∏ –Ω–∞ 3%/—É—Ä.", base:9000,  max:6 },
    { id:"salesman",   name:"–ü—Ä–æ–¥–∞–∂–Ω–∏–∫",    desc:"–ü–æ–≤—ã—à–∞–µ—Ç —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ 3%/—É—Ä.", base:9000,  max:6 },
    { id:"ghosting",   name:"–¢–∏—Ö–∏–π —Ä–µ–∂–∏–º",  desc:"–°–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –Ω–∞ 2%/—É—Ä.", base:12000, max:8 },
    { id:"runner",     name:"–ì–æ–Ω—â–∏–∫",       desc:"–ü–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å —É–π—Ç–∏ –Ω–∞ 3%/—É—Ä.", base:14000, max:8 },
    { id:"warehouse",  name:"–°–∫–ª–∞–¥",        desc:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –±–∞–∑—ã –Ω–∞ 5%/—É—Ä.", base:15000, max:10 },
    { id:"network",    name:"–°–µ—Ç—å",         desc:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –±–∏–∑–Ω–µ—Å–∞ –Ω–∞ 6%/—É—Ä.", base:18000, max:8 },
  ];

  const SAVE_KEY = "neon_market_aaa_v3";
  const ADMIN_PASS = "112";

  const DEFAULT = () => ({
    month: 1,
    cash: 25000,
    heat: 0,
    armor: 0,
    profit: 0,
    deals: 0,

    carId: "none",
    homeId:"room",
    bizId: "none",

    perks: Object.fromEntries(PERKS.map(p=>[p.id,0])),
    prices: Object.fromEntries(ITEMS.map(it=>[it.id, Math.floor(it.base * rnd(0.85,1.20))])),
    inv: Object.fromEntries(ITEMS.map(it=>[it.id, {qty:0, avg:0}])),
    priceHist: Object.fromEntries(ITEMS.map(it=>[it.id, []])),
    log: []
  });

  let S = load() || DEFAULT();
  let pending = null;

  // Admin undo/redo stacks
  const undoStack = [];
  const redoStack = [];
  function pushUndo(){
    undoStack.push(JSON.stringify(S));
    if(undoStack.length > 50) undoStack.shift();
    redoStack.length = 0;
  }

  function load(){
    try{
      const raw = localStorage.getItem(SAVE_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch{ return null; }
  }
  function save(){
    localStorage.setItem(SAVE_KEY, JSON.stringify(S));
    toast("Saved");
  }
  function reset(){
    localStorage.removeItem(SAVE_KEY);
    S = DEFAULT();
    log("–ù–æ–≤–∞—è –∏–≥—Ä–∞. –†—ã–Ω–æ–∫ –æ—Ç–∫—Ä—ã—Ç.");
    renderAll();
    toast("Reset");
  }

  function log(msg){
    S.log.unshift({t: Date.now(), msg});
    if(S.log.length > 100) S.log.length = 100;
    renderLog();
  }

  function perk(id){ return Number(S.perks[id]||0); }
  function car(){ return CARS.find(x=>x.id===S.carId) || CARS[0]; }
  function home(){ return HOMES.find(x=>x.id===S.homeId) || HOMES[0]; }
  function biz(){ return BIZ.find(x=>x.id===S.bizId) || BIZ[0]; }

  function cap(){
    const base = home().cap;
    const mul = 1 + perk("warehouse")*0.05;
    return Math.floor(base * mul);
  }
  function used(){
    let u=0;
    for(const it of ITEMS) u += (S.inv[it.id].qty||0) * it.vol;
    return u;
  }

  function buyPrice(id){
    const p = S.prices[id];
    const disc = 1 - perk("negotiator")*0.03;
    return Math.max(1, Math.floor(p * disc));
  }
  function sellPrice(id){
    const p = S.prices[id];
    const up = 1 + perk("salesman")*0.03;
    return Math.max(1, Math.floor(p * up));
  }

  function invValue(){
    let v=0;
    for(const it of ITEMS){
      v += (S.inv[it.id].qty||0) * sellPrice(it.id);
    }
    return v;
  }

  function riskSellBase(){
    const heat = S.heat/100;
    const base = 0.06 + heat*0.22;
    const armorRed = Math.min(0.10, S.armor*0.02);
    const perkRed = Math.min(0.14, perk("ghosting")*0.02);
    const carMul = car().heatMul;
    return clamp((base*carMul) - armorRed - perkRed, 0.02, 0.40);
  }
  function runChance(){
    const base = car().run;
    const perkUp = perk("runner")*0.03;
    const armorUp = Math.min(0.06, S.armor*0.01);
    const heatPenalty = (S.heat/100)*0.10;
    return clamp(base + perkUp + armorUp - heatPenalty, 0.05, 0.92);
  }
  function bribeCost(){
    const cargo = invValue();
    const heatFactor = 1 + (S.heat/100)*1.3;
    return Math.floor(2400*heatFactor + cargo*0.05);
  }
  function coolCost(){ return Math.floor(1200 + S.heat*140); }
  function armorCost(){
    const next = S.armor + 1;
    return Math.floor(9000 * (1.18 ** (next-1)));
  }
  function incomeMonth(){
    const base = biz().income;
    const mul = 1 + perk("network")*0.06;
    return Math.floor(base * mul);
  }

  // ===== Price history buffer =====
  function ensureHist(){
    for(const it of ITEMS){
      const arr = S.priceHist[it.id] || [];
      // keep last 12
      while(arr.length > 12) arr.shift();
      S.priceHist[it.id] = arr;
    }
  }
  function pushPriceSnapshot(){
    ensureHist();
    for(const it of ITEMS){
      const arr = S.priceHist[it.id];
      arr.push(S.prices[it.id]);
      while(arr.length > 12) arr.shift();
    }
  }
  pushPriceSnapshot();

  // ===== Navigation =====
  const pages = ["market","inventory","assets","upgrades","log"];
  function showPage(key){
    for(const p of pages){
      const el = $("page-"+p);
      el.style.display = (p===key) ? "" : "none";
    }
    document.querySelectorAll(".navItem").forEach(n=>{
      n.classList.toggle("active", n.getAttribute("data-go")===key);
    });
  }
  document.querySelectorAll(".navItem").forEach(n=>{
    n.addEventListener("click", ()=> showPage(n.getAttribute("data-go")));
  });
  $("btnGoAssets").onclick = ()=> showPage("assets");
  $("btnGoAssets2").onclick = ()=> showPage("assets");

  // ===== Render helpers =====
  function riskTagClass(r){
    if(r >= 0.22) return "bad";
    if(r >= 0.14) return "warn";
    return "good";
  }

  function drawMiniChart(canvas, values){
    const c = canvas;
    const w = c.width = 240;
    const h = c.height = 72;
    const g = c.getContext("2d");
    g.clearRect(0,0,w,h);

    if(!values || values.length < 2) return;

    const min = Math.min(...values);
    const max = Math.max(...values);
    const pad = 8;
    const dx = (w - pad*2) / (values.length - 1);
    const norm = (v)=> {
      const t = (v - min) / Math.max(1e-9, (max-min));
      return h - pad - t*(h - pad*2);
    };

    // background glow
    const grad = g.createLinearGradient(0,0,w,h);
    grad.addColorStop(0,"rgba(124,58,237,0.20)");
    grad.addColorStop(0.5,"rgba(236,72,153,0.12)");
    grad.addColorStop(1,"rgba(34,211,238,0.12)");
    g.fillStyle = grad;
    g.globalAlpha = 0.35;
    g.fillRect(0,0,w,h);
    g.globalAlpha = 1;

    // line
    g.lineWidth = 3;
    g.lineJoin = "round";
    g.lineCap = "round";
    const stroke = g.createLinearGradient(0,0,w,0);
    stroke.addColorStop(0,"rgba(34,211,238,0.95)");
    stroke.addColorStop(0.5,"rgba(236,72,153,0.95)");
    stroke.addColorStop(1,"rgba(124,58,237,0.95)");
    g.strokeStyle = stroke;

    g.beginPath();
    values.forEach((v,i)=>{
      const x = pad + dx*i;
      const y = norm(v);
      if(i===0) g.moveTo(x,y);
      else g.lineTo(x,y);
    });
    g.stroke();

    // dots (last point)
    const lastX = pad + dx*(values.length-1);
    const lastY = norm(values[values.length-1]);
    g.fillStyle = "rgba(255,255,255,0.9)";
    g.beginPath(); g.arc(lastX,lastY,3.8,0,Math.PI*2); g.fill();
  }

  function renderTop(){
    $("uiMonth").textContent = String(S.month);
    $("uiHeat").textContent = `${Math.round(S.heat)}%`;
    $("uiCash").textContent = money(S.cash);

    const r = riskSellBase();
    const tag = $("uiRisk");
    tag.textContent = `–†–∏—Å–∫: ${Math.round(r*100)}%`;
    tag.className = `tag ${riskTagClass(r)}`;

    $("uiCap").textContent = `${used()}/${cap()}`;
    $("uiInvValue").textContent = money(invValue());

    $("uiCoolCost").textContent = money(coolCost());
    $("uiArmorCost").textContent = money(armorCost());

    $("uiRunChance").textContent = `${Math.round(runChance()*100)}%`;
    $("uiIncome").textContent = money(incomeMonth());
    $("uiIncome2").textContent = money(incomeMonth());

    $("uiProfitTag").textContent = `–ü—Ä–æ—Ñ–∏—Ç: ${money(S.profit)}`;

    $("uiAssets").textContent = `üöó ${car().name} ‚Ä¢ üè† ${home().name} ‚Ä¢ üè≠ ${biz().name}`;
    $("uiCarTag").textContent = `–£–π—Ç–∏: ${Math.round(runChance()*100)}%`;
    $("uiHomeBizTag").textContent = `${home().name} / ${biz().name}`;
    $("uiHome").textContent = home().name;
    $("uiBiz").textContent = biz().name;

    const hints=[];
    if(r > 0.22) hints.push("–†–∏—Å–∫ –≤—ã—Å–æ–∫–∏–π: —Å–Ω–∏–∑—å Heat –∏–ª–∏ –∫—É–ø–∏ –∑–∞—â–∏—Ç—É.");
    else hints.push("–†–∏—Å–∫ –Ω–æ—Ä–º: –ø—Ä–æ–¥–∞–≤–∞–π –ø–∞—Ä—Ç–∏—è–º–∏ –∏ –ª–æ–≤–∏ –º–æ–º–µ–Ω—Ç –ø–æ —Å–ø—Ä–µ–¥—É.");
    if(runChance() < 0.25) hints.push("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å–ª–∞–±—ã–π: –∞–ø–≥—Ä–µ–π–¥ –º–∞—à–∏–Ω—ã –ø–æ–¥–Ω–∏–º–µ—Ç —à–∞–Ω—Å —É–π—Ç–∏.");
    if(used() > cap()*0.85) hints.push("–°–∫–ª–∞–¥ –ø–æ—á—Ç–∏ –ø–æ–ª–Ω—ã–π: —Ä–∞—Å—à–∏—Ä—å –±–∞–∑—É/–ø–µ—Ä–∫–∏ –∏–ª–∏ –ø—Ä–æ–¥–∞–π –ª–∏—à–Ω–µ–µ.");
    $("uiHint").textContent = hints.join(" ");
  }

  // Stepper state per item (UI convenience)
  const qState = Object.fromEntries(ITEMS.map(it=>[it.id, 1]));

  function renderMarket(){
    ensureHist();
    const body = $("marketRows");
    body.innerHTML = "";

    for(const it of ITEMS){
      const buy = buyPrice(it.id);
      const sell = sellPrice(it.id);
      const spread = Math.round(((sell-buy)/Math.max(1,buy))*100);
      const spreadCls = spread >= 0 ? "pos" : "neg";

      const tr = document.createElement("tr");
      tr.className = "row";

      const q = qState[it.id] || 1;

      tr.innerHTML = `
        <td>
          <b style="font-weight:1150">${esc(it.name)}</b>
          <div style="color:var(--muted);font-size:11px;margin-top:3px">${esc(it.vibe)} ‚Ä¢ vol ${it.vol}</div>
        </td>
        <td>
          <div class="chart"><canvas id="ch_${it.id}"></canvas></div>
        </td>
        <td class="mono">${money(buy)}</td>
        <td class="mono">${money(sell)} <span class="${spreadCls}">(${spread}%)</span></td>
        <td>
          <div class="stepper" data-step="${it.id}">
            <button data-dec="${it.id}">‚àí</button>
            <div class="q mono" id="q_${it.id}">${q}</div>
            <button data-inc="${it.id}">+</button>
          </div>
        </td>
        <td style="width:260px">
          <div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap">
            <button class="btn small" data-buy="${it.id}">–ö—É–ø–∏—Ç—å</button>
            <button class="btn small primary" data-sell="${it.id}">–ü—Ä–æ–¥–∞—Ç—å</button>
          </div>
        </td>
      `;
      body.appendChild(tr);

      // chart
      const canvas = tr.querySelector(`#ch_${it.id}`);
      const hist = S.priceHist[it.id] || [];
      drawMiniChart(canvas, hist);
    }

    body.querySelectorAll("[data-inc]").forEach(b=>{
      b.addEventListener("click", ()=>{
        const id = b.getAttribute("data-inc");
        qState[id] = clamp((qState[id]||1)+1, 1, 99);
        const qEl = document.getElementById("q_"+id);
        if(qEl) qEl.textContent = qState[id];
      });
    });
    body.querySelectorAll("[data-dec]").forEach(b=>{
      b.addEventListener("click", ()=>{
        const id = b.getAttribute("data-dec");
        qState[id] = clamp((qState[id]||1)-1, 1, 99);
        const qEl = document.getElementById("q_"+id);
        if(qEl) qEl.textContent = qState[id];
      });
    });

    body.querySelectorAll("[data-buy]").forEach(b=>{
      b.addEventListener("click", ()=>{
        const id = b.getAttribute("data-buy");
        buyItem(id, qState[id]||1);
      });
    });
    body.querySelectorAll("[data-sell]").forEach(b=>{
      b.addEventListener("click", ()=>{
        const id = b.getAttribute("data-sell");
        sellItem(id, qState[id]||1);
      });
    });
  }

  function renderInventory(){
    const body = $("invRows");
    body.innerHTML = "";
    let totalDelta=0;

    for(const it of ITEMS){
      const slot = S.inv[it.id];
      const q = slot.qty||0;
      const avg = slot.avg||0;
      const cur = sellPrice(it.id);
      const est = q * cur;
      const cost = q * avg;
      const delta = q ? (est - cost) : 0;
      totalDelta += delta;

      const cls = delta >= 0 ? "pos" : "neg";

      const tr = document.createElement("tr");
      tr.className = "row";
      tr.innerHTML = `
        <td>${esc(it.name)}</td>
        <td class="mono">${q}</td>
        <td class="mono">${avg ? money(avg) : "‚Äî"}</td>
        <td class="mono">${q ? money(est) : "‚Äî"}</td>
        <td class="mono ${q ? cls : ""}">${q ? money(delta) : "‚Äî"}</td>
      `;
      body.appendChild(tr);
    }
  }

  function renderAssets(){
    const carBody = $("carRows");
    carBody.innerHTML = "";
    for(const c of CARS){
      const owned = (S.carId===c.id);
      const tr = document.createElement("tr");
      tr.className="row";
      tr.innerHTML = `
        <td>${esc(c.name)} ${owned? `<span class="tag good">–≤—ã–±—Ä–∞–Ω–æ</span>`:""}</td>
        <td class="mono">${money(c.price)}</td>
        <td class="mono">${Math.round(c.run*100)}%</td>
        <td class="mono">${c.heatMul.toFixed(2)}x</td>
        <td style="text-align:right;width:160px">
          ${owned? "" : `<button class="btn small" data-car="${c.id}">${c.price===0?"–í—ã–±—Ä–∞—Ç—å":"–ö—É–ø–∏—Ç—å"}</button>`}
        </td>
      `;
      carBody.appendChild(tr);
    }
    carBody.querySelectorAll("[data-car]").forEach(b=>{
      b.addEventListener("click", ()=> buyCar(b.getAttribute("data-car")));
    });

    const homeBody = $("homeRows");
    homeBody.innerHTML = "";
    for(const h of HOMES){
      const owned = (S.homeId===h.id);
      const tr = document.createElement("tr");
      tr.className="row";
      tr.innerHTML = `
        <td>${esc(h.name)} ${owned? `<span class="tag good">–≤—ã–±—Ä–∞–Ω–æ</span>`:""}</td>
        <td class="mono">${money(h.price)}</td>
        <td class="mono">${h.cap}</td>
        <td style="text-align:right;width:160px">
          ${owned? "" : `<button class="btn small" data-home="${h.id}">${h.price===0?"–í—ã–±—Ä–∞—Ç—å":"–ö—É–ø–∏—Ç—å"}</button>`}
        </td>
      `;
      homeBody.appendChild(tr);
    }
    homeBody.querySelectorAll("[data-home]").forEach(b=>{
      b.addEventListener("click", ()=> buyHome(b.getAttribute("data-home")));
    });

    const bizBody = $("bizRows");
    bizBody.innerHTML = "";
    for(const z of BIZ){
      const owned = (S.bizId===z.id);
      const tr = document.createElement("tr");
      tr.className="row";
      tr.innerHTML = `
        <td>${esc(z.name)} ${owned? `<span class="tag good">–≤—ã–±—Ä–∞–Ω–æ</span>`:""}</td>
        <td class="mono">${money(z.price)}</td>
        <td class="mono">${money(z.income)}</td>
        <td style="text-align:right;width:160px">
          ${owned? "" : `<button class="btn small" data-biz="${z.id}">${z.price===0?"–í—ã–±—Ä–∞—Ç—å":"–ö—É–ø–∏—Ç—å"}</button>`}
        </td>
      `;
      bizBody.appendChild(tr);
    }
    bizBody.querySelectorAll("[data-biz]").forEach(b=>{
      b.addEventListener("click", ()=> buyBiz(b.getAttribute("data-biz")));
    });
  }

  function perkCost(p){
    const lvl = perk(p.id);
    return Math.floor(p.base * (1.22 ** lvl));
  }

  function renderUpgrades(){
    const grid = $("perkCards");
    grid.innerHTML = "";
    for(const p of PERKS){
      const lvl = perk(p.id);
      const maxed = lvl >= p.max;
      const cost = perkCost(p);

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="cardIn">
          <div class="cardHead">
            <div>
              <b>${esc(p.name)}</b>
              <div class="help">${esc(p.desc)}</div>
            </div>
            <span class="tag">${lvl}/${p.max}</span>
          </div>
          <div class="cols">
            <div class="pill"><span>–¶–µ–Ω–∞</span><b>${money(cost)}</b></div>
            <div class="pill"><span>–°—Ç–∞—Ç—É—Å</span><b>${maxed?"MAX":"OK"}</b></div>
          </div>
          <div class="split" style="margin-top:12px; justify-content:flex-end;">
            <button class="btn primary" ${maxed ? "disabled":""} data-perk="${p.id}">
              ${maxed ? "–ú–∞–∫—Å–∏–º—É–º" : "–£–ª—É—á—à–∏—Ç—å"}
            </button>
          </div>
        </div>
      `;
      grid.appendChild(card);
    }

    grid.querySelectorAll("[data-perk]").forEach(b=>{
      b.addEventListener("click", ()=> buyPerk(b.getAttribute("data-perk")));
    });
  }

  function renderLog(){
    const box = $("logBox");
    box.innerHTML = "";
    if(!S.log || !S.log.length){
      const t = document.createElement("div");
      t.className = "tile";
      t.innerHTML = `<b>–ü—É—Å—Ç–æ</b><p>–°–æ–±—ã—Ç–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–¥–µ–ª–æ–∫ –∏ –º–µ—Å—è—Ü–µ–≤.</p>`;
      box.appendChild(t);
      return;
    }
    for(const e of S.log){
      const t = document.createElement("div");
      t.className = "tile";
      t.innerHTML = `<b class="mono">${new Date(e.t).toLocaleString()}</b><p>${esc(e.msg)}</p>`;
      box.appendChild(t);
    }
  }

  function renderAll(){
    renderTop();
    renderMarket();
    renderInventory();
    renderAssets();
    renderUpgrades();
    renderLog();
  }

  /* ========= Core actions ========= */
  function buyItem(id, qty){
    const it = ITEMS.find(x=>x.id===id);
    if(!it) return;
    qty = clamp(Math.floor(qty||1), 1, 99);

    const unit = buyPrice(id);
    const totalCost = unit * qty;
    const totalVol = it.vol * qty;

    if(used() + totalVol > cap()){
      toast("–°–∫–ª–∞–¥ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω");
      return;
    }
    if(S.cash < totalCost){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }

    pushUndo();

    S.cash -= totalCost;
    S.deals += 1;

    const slot = S.inv[id];
    const oldQ = slot.qty;
    const newQ = oldQ + qty;
    // weighted avg
    slot.avg = newQ === 0 ? 0 : Math.floor((slot.avg*oldQ + unit*qty)/newQ);
    slot.qty = newQ;

    S.heat = clamp(S.heat + rnd(0.2, 0.9)*car().heatMul*qty*0.15, 0, 100);

    log(`–ü–æ–∫—É–ø–∫–∞: ${it.name} x${qty} –∑–∞ ${money(totalCost)} (avg ${money(slot.avg)})`);
    renderAll();
  }

  function sellItem(id, qty){
    const it = ITEMS.find(x=>x.id===id);
    if(!it) return;
    const slot = S.inv[id];
    if(!slot || slot.qty<=0){
      toast("–ù–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ");
      return;
    }
    qty = clamp(Math.floor(qty||1), 1, slot.qty);

    const r = riskSellBase() + (qty >= 6 ? 0.03 : 0);
    if(chance(r)){
      pending = { type:"sell", itemId:id, qty };
      openEvent("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ", `–°—Ä–∞–±–æ—Ç–∞–ª–æ —Ä–∏—Å–∫-—Å–æ–±—ã—Ç–∏–µ (—Ä–∏—Å–∫ –±—ã–ª ${Math.round(r*100)}%). –í—ã–±–∏—Ä–∞–π –¥–µ–π—Å—Ç–≤–∏–µ.`);
      return;
    }

    pushUndo();
    doSell(id, qty);
    renderAll();
  }

  function doSell(id, qty){
    const it = ITEMS.find(x=>x.id===id);
    const slot = S.inv[id];
    qty = Math.min(qty, slot.qty);
    if(qty<=0) return 0;

    const unit = sellPrice(id);
    const income = unit * qty;
    const cost = slot.avg * qty;
    const delta = income - cost;

    S.cash += income;
    S.profit += delta;
    S.deals += 1;

    slot.qty -= qty;
    if(slot.qty===0) slot.avg=0;

    S.heat = clamp(S.heat + rnd(0.8,2.2)*car().heatMul*qty*0.12, 0, 100);

    log(`–ü—Ä–æ–¥–∞–∂–∞: ${it.name} x${qty} –∑–∞ ${money(income)} (Œî ${money(delta)})`);
    return income;
  }

  function sellAll(){
    // Sells everything; if event triggers, pauses at first batch
    for(const it of ITEMS){
      const q = S.inv[it.id].qty||0;
      if(q<=0) continue;

      const r = riskSellBase() + (q >= 6 ? 0.03 : 0);
      if(chance(r)){
        pending = { type:"sell", itemId:it.id, qty:q };
        openEvent("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ", `–°—Ä–∞–±–æ—Ç–∞–ª–æ —Ä–∏—Å–∫-—Å–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –ø–∞—Ä—Ç–∏–∏ (—Ä–∏—Å–∫ –±—ã–ª ${Math.round(r*100)}%).`);
        return;
      }
      pushUndo();
      doSell(it.id, q);
    }
    toast("–ü—Ä–æ–¥–∞–Ω–æ");
    renderAll();
  }

  function buyCar(id){
    const c = CARS.find(x=>x.id===id);
    if(!c || S.carId===id) return;
    if(c.price>0 && S.cash < c.price){ toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash"); return; }

    pushUndo();

    if(c.price>0) S.cash -= c.price;
    S.carId = id;
    log(`–ú–∞—à–∏–Ω–∞: ${c.name} (${c.price? money(c.price) : "‚Äî"})`);
    renderAll();
  }
  function buyHome(id){
    const h = HOMES.find(x=>x.id===id);
    if(!h || S.homeId===id) return;
    if(h.price>0 && S.cash < h.price){ toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash"); return; }

    pushUndo();

    if(h.price>0) S.cash -= h.price;
    S.homeId = id;
    log(`–ë–∞–∑–∞: ${h.name} (${h.price? money(h.price) : "‚Äî"})`);
    renderAll();
  }
  function buyBiz(id){
    const z = BIZ.find(x=>x.id===id);
    if(!z || S.bizId===id) return;
    if(z.price>0 && S.cash < z.price){ toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash"); return; }

    pushUndo();

    if(z.price>0) S.cash -= z.price;
    S.bizId = id;
    log(`–ë–∏–∑–Ω–µ—Å: ${z.name} (${z.price? money(z.price) : "‚Äî"})`);
    renderAll();
  }
  function buyPerk(id){
    const p = PERKS.find(x=>x.id===id);
    if(!p) return;
    const lvl = perk(id);
    if(lvl>=p.max){ toast("MAX"); return; }
    const cost = perkCost(p);
    if(S.cash < cost){ toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash"); return; }

    pushUndo();

    S.cash -= cost;
    S.perks[id] = lvl + 1;
    log(`–ü–µ—Ä–∫: ${p.name} —É—Ä. ${S.perks[id]} (${money(cost)})`);
    renderAll();
  }

  function nextMonth(){
    pushUndo();

    const inc = incomeMonth();
    if(inc>0){
      S.cash += inc;
      log(`–î–æ—Ö–æ–¥ –±–∏–∑–Ω–µ—Å–∞: +${money(inc)} (${biz().name})`);
    }

    const before = S.heat;
    S.heat = clamp(S.heat - (8 + perk("ghosting")*2), 0, 100);
    if(before !== S.heat) log(`Heat: ${Math.round(before)}% ‚Üí ${Math.round(S.heat)}%`);

    // price changes
    for(const it of ITEMS){
      const base = it.base;
      const vol = 0.22 + it.vol*0.05;
      const wave = rnd(-vol, vol);
      const momentum = rnd(-0.08, 0.08);
      const p = S.prices[it.id];
      const target = base * (1 + wave);
      const next = p * (1 + momentum) * 0.55 + target * 0.45;
      S.prices[it.id] = Math.max(120, Math.floor(next));
    }

    S.month += 1;
    pushPriceSnapshot();
    log(`–ú–µ—Å—è—Ü #${S.month}: —Ü–µ–Ω—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å`);
    renderAll();
    toast("–ù–æ–≤—ã–π –º–µ—Å—è—Ü");
  }

  /* ========= Event modal ========= */
  const eventBack = $("eventBack");
  const eventTitle = $("eventTitle");
  const eventText = $("eventText");
  const eventRunChance = $("eventRunChance");
  const eventBribeCost = $("eventBribeCost");

  function openEvent(title, text){
    eventTitle.textContent = title;
    eventText.textContent = text;
    eventRunChance.textContent = `${Math.round(runChance()*100)}%`;
    eventBribeCost.textContent = money(bribeCost());
    eventBack.classList.add("show");
  }
  function closeEvent(){
    eventBack.classList.remove("show");
    pending = null;
  }
  $("eventClose").onclick = closeEvent;
  eventBack.addEventListener("click", (e)=>{ if(e.target===eventBack) closeEvent(); });

  $("actDump").onclick = ()=>{
    if(!pending) return closeEvent();
    pushUndo();

    const lost = invValue();
    for(const it of ITEMS){
      S.inv[it.id].qty = 0;
      S.inv[it.id].avg = 0;
    }
    S.heat = clamp(S.heat + 6, 0, 100);
    log(`–ì—Ä—É–∑ –≤—ã–±—Ä–æ—à–µ–Ω. –ü–æ—Ç–µ—Ä—è –æ—Ü–µ–Ω–æ—á–Ω–æ: ${money(lost)}`);
    closeEvent();
    renderAll();
  };

  $("actRun").onclick = ()=>{
    if(!pending) return closeEvent();
    pushUndo();

    const p = runChance();
    if(chance(p)){
      const add = 6 + Math.floor(rnd(0,6));
      S.heat = clamp(S.heat + add, 0, 100);
      log(`–£–π—Ç–∏ —É–¥–∞–ª–æ—Å—å (—à–∞–Ω—Å ${Math.round(p*100)}%). Heat +${add}%`);
      closeEvent();
      renderAll();
      return;
    }

    const fine = Math.floor(bribeCost()*0.35 + 2500);
    if(pending.type==="sell"){
      const slot = S.inv[pending.itemId];
      const lost = Math.min(pending.qty, slot.qty);
      slot.qty -= lost;
      if(slot.qty===0) slot.avg=0;
      log(`–ù–µ —É—à—ë–ª. –ö–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏–∏ (${lost} —à—Ç). –®—Ç—Ä–∞—Ñ: ${money(fine)}`);
    }else{
      log(`–ù–µ —É—à—ë–ª. –®—Ç—Ä–∞—Ñ: ${money(fine)}`);
    }
    S.cash = Math.max(0, S.cash - fine);
    S.heat = clamp(S.heat + 18, 0, 100);

    closeEvent();
    renderAll();
  };

  $("actBribe").onclick = ()=>{
    if(!pending) return closeEvent();
    const cost = bribeCost();
    if(S.cash < cost){ toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash"); return; }
    pushUndo();

    const base = 0.62 + perk("negotiator")*0.03 - (S.heat/100)*0.25;
    const ok = chance(clamp(base, 0.20, 0.92));
    S.cash -= cost;

    if(ok){
      S.heat = clamp(S.heat + 4, 0, 100);
      log(`‚Äú–í–∑—è—Ç–∫–∞‚Äù —Å—Ä–∞–±–æ—Ç–∞–ª–∞: -${money(cost)}. –°–¥–µ–ª–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∞.`);
      if(pending.type==="sell") doSell(pending.itemId, pending.qty);
    }else{
      const fine = Math.floor(cost*0.65 + 3500);
      S.cash = Math.max(0, S.cash - fine);
      S.heat = clamp(S.heat + 20, 0, 100);

      if(pending.type==="sell"){
        const slot = S.inv[pending.itemId];
        const lost = Math.min(pending.qty, slot.qty);
        slot.qty -= lost;
        if(slot.qty===0) slot.avg=0;
        log(`‚Äú–í–∑—è—Ç–∫–∞‚Äù –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å. –ü–æ—Ç–µ—Ä–∏: ${money(cost)} + —à—Ç—Ä–∞—Ñ ${money(fine)} + –∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏–∏ (${lost} —à—Ç).`);
      }else{
        log(`‚Äú–í–∑—è—Ç–∫–∞‚Äù –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å. –ü–æ—Ç–µ—Ä–∏: ${money(cost)} + —à—Ç—Ä–∞—Ñ ${money(fine)}.`);
      }
    }

    closeEvent();
    renderAll();
  };

  /* ========= Quick actions ========= */
  $("btnSellAll").onclick = sellAll;
  $("btnCool").onclick = ()=>{
    const cost = coolCost();
    if(S.cash < cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
    pushUndo();

    const before = S.heat;
    S.cash -= cost;
    S.heat = clamp(S.heat - (35 + perk("ghosting")*3), 0, 100);
    log(`–°–Ω–∏–∂–µ–Ω–∏–µ Heat: ${Math.round(before)}% ‚Üí ${Math.round(S.heat)}% (${money(cost)})`);
    renderAll();
  };
  $("btnArmor").onclick = ()=>{
    const cost = armorCost();
    if(S.cash < cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
    pushUndo();

    S.cash -= cost;
    S.armor += 1;
    log(`–ó–∞—â–∏—Ç–∞: —É—Ä–æ–≤–µ–Ω—å ${S.armor} (${money(cost)})`);
    renderAll();
  };

  $("fabMonth").onclick = nextMonth;

  $("btnSave").onclick = save;
  $("btnReset").onclick = ()=>{ if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) reset(); };
  $("btnClearLog").onclick = ()=>{ pushUndo(); S.log = []; renderLog(); toast("–û—á–∏—â–µ–Ω–æ"); };

  /* ========= Admin 2.0 ========= */
  const adminBack = $("adminBack");
  const adminBody = $("adminBody");
  const adminTitle = $("adminTitle");

  $("adminClose").onclick = ()=> adminBack.classList.remove("show");
  adminBack.addEventListener("click", (e)=>{ if(e.target===adminBack) adminBack.classList.remove("show"); });

  $("admUndo").onclick = ()=>{
    if(!undoStack.length){ toast("Undo –ø—É—Å—Ç–æ"); return; }
    redoStack.push(JSON.stringify(S));
    const prev = undoStack.pop();
    S = JSON.parse(prev);
    save();
    renderAll();
    toast("Undo");
    if(adminBack.classList.contains("show")) openAdminPanel(currentAdminTab, adminSearch);
  };
  $("admRedo").onclick = ()=>{
    if(!redoStack.length){ toast("Redo –ø—É—Å—Ç–æ"); return; }
    undoStack.push(JSON.stringify(S));
    const next = redoStack.pop();
    S = JSON.parse(next);
    save();
    renderAll();
    toast("Redo");
    if(adminBack.classList.contains("show")) openAdminPanel(currentAdminTab, adminSearch);
  };

  let currentAdminTab = "overview";
  let adminSearch = "";

  $("btnAdmin").onclick = ()=> openAdminGate();

  function openAdminGate(){
    adminTitle.textContent = "–ê–¥–º–∏–Ω–∫–∞ ‚Ä¢ –≤—Ö–æ–¥";
    adminBody.innerHTML = `
      <div class="help">–í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é <b>–∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ–≥–æ</b>.</div>
      <div class="hr"></div>
      <div class="cols">
        <div class="field">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input id="admPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢" />
        </div>
        <div class="field">
          <label>–î–µ–π—Å—Ç–≤–∏–µ</label>
          <button class="btn primary full" id="admEnter">–í–æ–π—Ç–∏</button>
        </div>
      </div>
      <div style="height:10px"></div>
      <div class="help">–ü–∞—Ä–æ–ª—å –≤ –∫–æ–¥–µ: <b>${ADMIN_PASS}</b> (–º–æ–∂–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é <code>ADMIN_PASS</code>).</div>
    `;
    adminBack.classList.add("show");
    $("admEnter").onclick = ()=>{
      const p = $("admPass").value || "";
      if(p !== ADMIN_PASS){ toast("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å"); return; }
      openAdminPanel("overview", "");
    };
  }

  function openAdminPanel(tab="overview", search=""){
    currentAdminTab = tab;
    adminSearch = search || "";
    adminTitle.textContent = "–ê–¥–º–∏–Ω–∫–∞ ‚Ä¢ 2.0";

    const tabs = [
      ["overview","Overview"],
      ["market","Market"],
      ["inventory","Inventory"],
      ["assets","Assets"],
      ["perks","Perks"],
      ["io","Import/Export"]
    ];

    const tabsHtml = tabs.map(([k,label])=>`
      <div class="tab ${k===tab?"active":""}" data-tab="${k}">${label}</div>
    `).join("");

    const searchBar = `
      <div class="toolbar">
        <div class="left tabs">${tabsHtml}</div>
        <div class="right" style="min-width:min(420px,100%)">
          <input id="admSearch" placeholder="–ü–æ–∏—Å–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ/ID)..." value="${esc(adminSearch)}" />
        </div>
      </div>
      <div class="hr"></div>
    `;

    let content = "";

    if(tab === "overview"){
      content = renderAdminOverview();
    }else if(tab === "market"){
      content = renderAdminMarket(adminSearch);
    }else if(tab === "inventory"){
      content = renderAdminInventory(adminSearch);
    }else if(tab === "assets"){
      content = renderAdminAssets();
    }else if(tab === "perks"){
      content = renderAdminPerks(adminSearch);
    }else if(tab === "io"){
      content = renderAdminIO();
    }

    adminBody.innerHTML = searchBar + content;
    adminBack.classList.add("show");

    adminBody.querySelectorAll("[data-tab]").forEach(t=>{
      t.onclick = ()=> openAdminPanel(t.getAttribute("data-tab"), adminSearch);
    });

    const s = $("admSearch");
    if(s){
      s.oninput = ()=>{
        adminSearch = s.value || "";
        openAdminPanel(currentAdminTab, adminSearch);
      };
    }

    // Bind actions
    bindAdminHandlers();
  }

  function renderAdminOverview(){
    return `
      <div class="cols">
        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>State</b>
                <div class="help">–ë—ã—Å—Ç—Ä–æ –ø—Ä–∞–≤—å –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ = –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ.</div>
              </div>
              <span class="tag">live</span>
            </div>

            <div class="cols">
              ${fieldNum("Month","adm_month", S.month, 1, 9999, 1)}
              ${fieldNum("Cash","adm_cash", S.cash, -999999999, 999999999, 1)}
              ${fieldNum("Heat (0..100)","adm_heat", S.heat, 0, 100, 1)}
              ${fieldNum("Armor","adm_armor", S.armor, 0, 9999, 1)}
              ${fieldNum("Profit","adm_profit", S.profit, -999999999, 999999999, 1)}
              ${fieldNum("Deals","adm_deals", S.deals, 0, 9999999, 1)}
            </div>

            <div class="split" style="margin-top:12px;justify-content:flex-end">
              <button class="btn" id="adm_apply_overview">‚úÖ Apply</button>
              <button class="btn danger" id="adm_wipe">üß® Wipe save</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>Quick Tools</b>
                <div class="help">–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∞ –±–∞–ª–∞–Ω—Å–∞.</div>
              </div>
              <span class="tag">tools</span>
            </div>

            <div class="cols">
              <button class="btn full" id="adm_preset_rich">üí∞ –°–¥–µ–ª–∞—Ç—å –±–æ–≥–∞—Ç—ã–º</button>
              <button class="btn full" id="adm_preset_heat0">üßä Heat = 0</button>
              <button class="btn full" id="adm_preset_heat100">üî• Heat = 100</button>
              <button class="btn full" id="adm_preset_clearinv">üß∫ –û—á–∏—Å—Ç–∏—Ç—å —Å–∫–ª–∞–¥</button>
              <button class="btn full" id="adm_preset_fullinv">üì¶ –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–∫–ª–∞–¥</button>
              <button class="btn full" id="adm_preset_maxperks">üß¨ MAX Perks</button>
            </div>

            <div class="hr"></div>
            <div class="help">–°–æ–≤–µ—Ç: –∏—Å–ø–æ–ª—å–∑—É–π Undo/Redo —Å–≤–µ—Ä—Ö—É, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å —Ç–µ—Å—Ç—ã.</div>
          </div>
        </div>
      </div>
    `;
  }

  function renderAdminMarket(search){
    const q = (search||"").trim().toLowerCase();
    const rows = ITEMS.filter(it=>{
      if(!q) return true;
      return it.id.toLowerCase().includes(q) || it.name.toLowerCase().includes(q) || it.vibe.toLowerCase().includes(q);
    }).map(it=>`
      <div class="card" style="margin:0">
        <div class="cardIn">
          <div class="cardHead">
            <div>
              <b>${esc(it.name)} <span class="tag">${esc(it.id)}</span></b>
              <div class="help">${esc(it.vibe)} ‚Ä¢ base ${money(it.base)} ‚Ä¢ vol ${it.vol}</div>
            </div>
            <span class="tag">price</span>
          </div>
          <div class="cols">
            ${fieldNum("Price","adm_price_"+it.id, S.prices[it.id], 1, 999999999, 1)}
            ${fieldText("Hint (optional)","adm_note_"+it.id, "")}
          </div>
        </div>
      </div>
    `).join("");

    return `
      <div class="help">–ü—Ä–∞–≤–∫–∞ —Ü–µ–Ω. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–∂–º–∏ Apply.</div>
      <div class="hr"></div>
      <div style="display:grid;gap:12px">${rows || `<div class="help">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>`}</div>
      <div class="hr"></div>
      <div class="split" style="justify-content:flex-end">
        <button class="btn primary" id="adm_apply_market">‚úÖ Apply</button>
      </div>
    `;
  }

  function renderAdminInventory(search){
    const q = (search||"").trim().toLowerCase();
    const rows = ITEMS.filter(it=>{
      if(!q) return true;
      return it.id.toLowerCase().includes(q) || it.name.toLowerCase().includes(q) || it.vibe.toLowerCase().includes(q);
    }).map(it=>{
      const slot = S.inv[it.id] || {qty:0, avg:0};
      return `
        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>${esc(it.name)} <span class="tag">${esc(it.id)}</span></b>
                <div class="help">vol ${it.vol} ‚Ä¢ —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ ${money(S.prices[it.id])}</div>
              </div>
              <span class="tag">inv</span>
            </div>
            <div class="cols">
              ${fieldNum("Qty","adm_qty_"+it.id, slot.qty, 0, 999999, 1)}
              ${fieldNum("Avg","adm_avg_"+it.id, slot.avg, 0, 999999999, 1)}
            </div>
          </div>
        </div>
      `;
    }).join("");

    return `
      <div class="help">–ü—Ä–∞–≤–∫–∞ —Å–∫–ª–∞–¥–∞. –ú–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ —Å—Ç–∞–≤–∏—Ç—å qty/avg.</div>
      <div class="hr"></div>
      <div style="display:grid;gap:12px">${rows || `<div class="help">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>`}</div>
      <div class="hr"></div>
      <div class="split" style="justify-content:flex-end">
        <button class="btn primary" id="adm_apply_inventory">‚úÖ Apply</button>
      </div>
    `;
  }

  function renderAdminAssets(){
    const carOpts = CARS.map(c=>`<option value="${c.id}" ${S.carId===c.id?"selected":""}>${esc(c.name)} (${money(c.price)})</option>`).join("");
    const homeOpts = HOMES.map(h=>`<option value="${h.id}" ${S.homeId===h.id?"selected":""}>${esc(h.name)} (${money(h.price)})</option>`).join("");
    const bizOpts = BIZ.map(z=>`<option value="${z.id}" ${S.bizId===z.id?"selected":""}>${esc(z.name)} (${money(z.price)})</option>`).join("");

    return `
      <div class="cols">
        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>–í—ã–±–æ—Ä –∞–∫—Ç–∏–≤–æ–≤</b>
                <div class="help">–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –º–µ–Ω—è–µ—Ç –º–∞—à–∏–Ω—É/–±–∞–∑—É/–±–∏–∑–Ω–µ—Å.</div>
              </div>
              <span class="tag">select</span>
            </div>
            <div class="cols">
              ${fieldSelect("Car","adm_car", carOpts)}
              ${fieldSelect("Home","adm_home", homeOpts)}
              ${fieldSelect("Business","adm_biz", bizOpts)}
              <div class="field">
                <label>Info</label>
                <div class="pill"><span>–£–π—Ç–∏</span><b>${Math.round(runChance()*100)}%</b></div>
              </div>
            </div>
            <div class="split" style="margin-top:12px;justify-content:flex-end">
              <button class="btn primary" id="adm_apply_assets">‚úÖ Apply</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>–ë–∞–ª–∞–Ω—Å-—Ç—é–Ω–∏–Ω–≥</b>
                <div class="help">–ë—ã—Å—Ç—Ä–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Heat.</div>
              </div>
              <span class="tag">tune</span>
            </div>

            <div class="cols">
              ${fieldNum("Armor","adm_armor2", S.armor, 0, 9999, 1)}
              ${fieldNum("Heat","adm_heat2", S.heat, 0, 100, 1)}
            </div>

            <div class="split" style="margin-top:12px;justify-content:flex-end">
              <button class="btn" id="adm_apply_tune">‚úÖ Apply</button>
            </div>
          </div>
        </div>
      </div>
    `;
  }

  function renderAdminPerks(search){
    const q = (search||"").trim().toLowerCase();
    const rows = PERKS.filter(p=>{
      if(!q) return true;
      return p.id.toLowerCase().includes(q) || p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q);
    }).map(p=>{
      return `
        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>${esc(p.name)} <span class="tag">${esc(p.id)}</span></b>
                <div class="help">${esc(p.desc)} ‚Ä¢ max ${p.max}</div>
              </div>
              <span class="tag">perk</span>
            </div>
            <div class="cols">
              ${fieldNum("Level","adm_perk_"+p.id, S.perks[p.id]||0, 0, p.max, 1)}
              <div class="field">
                <label>Cost next</label>
                <div class="pill"><span>–¶–µ–Ω–∞</span><b>${money(perkCost(p))}</b></div>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join("");

    return `
      <div class="help">–†–µ–¥–∞–∫—Ç–∏—Ä—É–π —É—Ä–æ–≤–Ω–∏ –ø–µ—Ä–∫–æ–≤ (0..max). –ü–æ—Å–ª–µ ‚Äî Apply.</div>
      <div class="hr"></div>
      <div style="display:grid;gap:12px">${rows || `<div class="help">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>`}</div>
      <div class="hr"></div>
      <div class="split" style="justify-content:flex-end">
        <button class="btn primary" id="adm_apply_perks">‚úÖ Apply</button>
      </div>
    `;
  }

  function renderAdminIO(){
    return `
      <div class="cols">
        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>Export</b>
                <div class="help">–°–∫–æ–ø–∏—Ä—É–π state —Ü–µ–ª–∏–∫–æ–º, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å/–ø–µ—Ä–µ–∫–∏–Ω—É—Ç—å.</div>
              </div>
              <span class="tag">json</span>
            </div>
            <div class="field">
              <label>JSON</label>
              <textarea id="adm_json">${esc(JSON.stringify(S, null, 2))}</textarea>
            </div>
            <div class="split" style="margin-top:12px; justify-content:flex-end">
              <button class="btn" id="adm_copy">üìã Copy</button>
              <button class="btn primary" id="adm_apply_json">‚úÖ Apply JSON</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin:0">
          <div class="cardIn">
            <div class="cardHead">
              <div>
                <b>Import</b>
                <div class="help">–í—Å—Ç–∞–≤—å JSON, –Ω–∞–∂–º–∏ Apply ‚Äî –∏ –≤—Å—ë –æ–±–Ω–æ–≤–∏—Ç—Å—è.</div>
              </div>
              <span class="tag">safe</span>
            </div>

            <div class="help">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ —Å–ª–æ–º–∞–ª ‚Äî –∂–º–∏ Wipe –≤ Overview.</div>
            <div class="hr"></div>

            <div class="cols">
              <button class="btn full" id="adm_export_save">üíæ Save now</button>
              <button class="btn full danger" id="adm_force_reload">‚Ü∫ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å UI</button>
            </div>
          </div>
        </div>
      </div>
    `;
  }

  function fieldNum(label, id, value, min, max, step){
    return `
      <div class="field">
        <label>${esc(label)}</label>
        <input type="number" id="${id}" value="${Number(value||0)}" min="${min}" max="${max}" step="${step}">
      </div>
    `;
  }
  function fieldText(label, id, value){
    return `
      <div class="field">
        <label>${esc(label)}</label>
        <input type="text" id="${id}" value="${esc(value||"")}">
      </div>
    `;
  }
  function fieldSelect(label, id, optionsHtml){
    return `
      <div class="field">
        <label>${esc(label)}</label>
        <select id="${id}">${optionsHtml}</select>
      </div>
    `;
  }

  function bindAdminHandlers(){
    // Overview apply
    const a = $("adm_apply_overview");
    if(a){
      a.onclick = ()=>{
        pushUndo();
        S.month = Math.max(1, Number($("adm_month").value||1));
        S.cash = Number($("adm_cash").value||0);
        S.heat = clamp(Number($("adm_heat").value||0), 0, 100);
        S.armor = Math.max(0, Number($("adm_armor").value||0));
        S.profit = Number($("adm_profit").value||0);
        S.deals = Math.max(0, Number($("adm_deals").value||0));
        log("–ê–¥–º–∏–Ω–∫–∞: –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.");
        save(); renderAll(); toast("Applied");
      };
    }
    const wipe = $("adm_wipe");
    if(wipe){
      wipe.onclick = ()=>{
        if(confirm("–¢–æ—á–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ?")){
          reset();
          adminBack.classList.remove("show");
        }
      };
    }

    // Overview presets
    const pr = $("adm_preset_rich");
    if(pr) pr.onclick = ()=>{ pushUndo(); S.cash = 999999; log("–ê–¥–º–∏–Ω–∫–∞: cash = 999999"); save(); renderAll(); openAdminPanel("overview", adminSearch); };
    const p0 = $("adm_preset_heat0");
    if(p0) p0.onclick = ()=>{ pushUndo(); S.heat = 0; log("–ê–¥–º–∏–Ω–∫–∞: heat = 0"); save(); renderAll(); openAdminPanel("overview", adminSearch); };
    const p100 = $("adm_preset_heat100");
    if(p100) p100.onclick = ()=>{ pushUndo(); S.heat = 100; log("–ê–¥–º–∏–Ω–∫–∞: heat = 100"); save(); renderAll(); openAdminPanel("overview", adminSearch); };
    const pc = $("adm_preset_clearinv");
    if(pc) pc.onclick = ()=>{ pushUndo(); for(const it of ITEMS){ S.inv[it.id]={qty:0,avg:0}; } log("–ê–¥–º–∏–Ω–∫–∞: —Å–∫–ª–∞–¥ –æ—á–∏—â–µ–Ω"); save(); renderAll(); openAdminPanel("overview", adminSearch); };
    const pf = $("adm_preset_fullinv");
    if(pf) pf.onclick = ()=>{
      pushUndo();
      // fill to cap with random items
      for(const it of ITEMS){ S.inv[it.id]={qty:0,avg:0}; }
      let remaining = cap();
      while(remaining > 0){
        const it = ITEMS[Math.floor(Math.random()*ITEMS.length)];
        if(remaining - it.vol < 0) break;
        const add = Math.min(10, Math.floor(remaining/it.vol));
        const qty = Math.max(1, Math.floor(rnd(1, add)));
        const unit = buyPrice(it.id);
        const slot = S.inv[it.id];
        const oldQ = slot.qty;
        const newQ = oldQ + qty;
        slot.avg = newQ===0 ? 0 : Math.floor((slot.avg*oldQ + unit*qty)/newQ);
        slot.qty = newQ;
        remaining -= it.vol*qty;
      }
      log("–ê–¥–º–∏–Ω–∫–∞: —Å–∫–ª–∞–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω (—Ä–∞–Ω–¥–æ–º).");
      save(); renderAll(); openAdminPanel("overview", adminSearch);
    };
    const pm = $("adm_preset_maxperks");
    if(pm) pm.onclick = ()=>{
      pushUndo();
      for(const p of PERKS) S.perks[p.id] = p.max;
      log("–ê–¥–º–∏–Ω–∫–∞: –≤—Å–µ –ø–µ—Ä–∫–∏ MAX.");
      save(); renderAll(); openAdminPanel("overview", adminSearch);
    };

    // Market apply
    const am = $("adm_apply_market");
    if(am){
      am.onclick = ()=>{
        pushUndo();
        for(const it of ITEMS){
          const el = document.getElementById("adm_price_"+it.id);
          if(el) S.prices[it.id] = Math.max(1, Math.floor(Number(el.value||S.prices[it.id]||1)));
        }
        pushPriceSnapshot();
        log("–ê–¥–º–∏–Ω–∫–∞: —Ü–µ–Ω—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.");
        save(); renderAll(); toast("Applied");
        openAdminPanel("market", adminSearch);
      };
    }

    // Inventory apply
    const ai = $("adm_apply_inventory");
    if(ai){
      ai.onclick = ()=>{
        pushUndo();
        for(const it of ITEMS){
          const q = document.getElementById("adm_qty_"+it.id);
          const a = document.getElementById("adm_avg_"+it.id);
          if(q) S.inv[it.id].qty = Math.max(0, Math.floor(Number(q.value||0)));
          if(a) S.inv[it.id].avg = Math.max(0, Math.floor(Number(a.value||0)));
        }
        log("–ê–¥–º–∏–Ω–∫–∞: —Å–∫–ª–∞–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω.");
        save(); renderAll(); toast("Applied");
        openAdminPanel("inventory", adminSearch);
      };
    }

    // Assets apply
    const aa = $("adm_apply_assets");
    if(aa){
      aa.onclick = ()=>{
        pushUndo();
        const c = $("adm_car")?.value; if(c) S.carId=c;
        const h = $("adm_home")?.value; if(h) S.homeId=h;
        const b = $("adm_biz")?.value; if(b) S.bizId=b;
        log("–ê–¥–º–∏–Ω–∫–∞: –∞–∫—Ç–∏–≤—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.");
        save(); renderAll(); toast("Applied");
        openAdminPanel("assets", adminSearch);
      };
    }

    const at = $("adm_apply_tune");
    if(at){
      at.onclick = ()=>{
        pushUndo();
        S.armor = Math.max(0, Number($("adm_armor2").value||0));
        S.heat = clamp(Number($("adm_heat2").value||0), 0, 100);
        log("–ê–¥–º–∏–Ω–∫–∞: tune –ø—Ä–∏–º–µ–Ω—ë–Ω.");
        save(); renderAll(); toast("Applied");
        openAdminPanel("assets", adminSearch);
      };
    }

    // Perks apply
    const ap = $("adm_apply_perks");
    if(ap){
      ap.onclick = ()=>{
        pushUndo();
        for(const p of PERKS){
          const el = document.getElementById("adm_perk_"+p.id);
          if(el){
            const v = Math.floor(Number(el.value||0));
            S.perks[p.id] = clamp(v, 0, p.max);
          }
        }
        log("–ê–¥–º–∏–Ω–∫–∞: –ø–µ—Ä–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã.");
        save(); renderAll(); toast("Applied");
        openAdminPanel("perks", adminSearch);
      };
    }

    // IO
    const copy = $("adm_copy");
    if(copy){
      copy.onclick = async ()=>{
        try{
          await navigator.clipboard.writeText($("adm_json").value || "");
          toast("Copied");
        }catch{
          toast("Copy –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω");
        }
      };
    }
    const aj = $("adm_apply_json");
    if(aj){
      aj.onclick = ()=>{
        const raw = ($("adm_json").value || "").trim();
        if(!raw) return;
        try{
          const obj = JSON.parse(raw);
          pushUndo();
          S = obj;

          // minimal sanity
          S.month = Math.max(1, Number(S.month||1));
          S.cash = Number(S.cash||0);
          S.heat = clamp(Number(S.heat||0), 0, 100);
          S.armor = Math.max(0, Number(S.armor||0));
          S.profit = Number(S.profit||0);
          S.deals = Math.max(0, Number(S.deals||0));
          S.log = Array.isArray(S.log) ? S.log : [];
          S.perks = S.perks || Object.fromEntries(PERKS.map(p=>[p.id,0]));
          S.inv = S.inv || Object.fromEntries(ITEMS.map(it=>[it.id,{qty:0,avg:0}]));
          S.prices = S.prices || Object.fromEntries(ITEMS.map(it=>[it.id,it.base]));
          S.priceHist = S.priceHist || Object.fromEntries(ITEMS.map(it=>[it.id,[]]));
          ensureHist();

          save(); renderAll(); toast("Applied JSON");
          openAdminPanel("io", adminSearch);
        }catch{
          toast("JSON –æ—à–∏–±–∫–∞");
        }
      };
    }
    const ex = $("adm_export_save");
    if(ex) ex.onclick = ()=>{ save(); toast("Saved"); };
    const fr = $("adm_force_reload");
    if(fr) fr.onclick = ()=>{ renderAll(); toast("UI reloaded"); openAdminPanel(currentAdminTab, adminSearch); };
  }

  /* ========= Admin open button ========= */
  function openAdmin(){
    openAdminGate();
  }
  // already bound via btnAdmin click

  /* ========= Autosave ========= */
  setInterval(()=>{ try{ localStorage.setItem(SAVE_KEY, JSON.stringify(S)); }catch{} }, 5000);

  /* ========= Boot ========= */
  if(!S.log || !S.log.length){
    S.log = [];
    log("–°—Ç–∞—Ä—Ç: –ø–æ–∫—É–ø–∞–π, –ø—Ä–æ–∂–∏–≤–∞–π –º–µ—Å—è—Ü (Ôºã), –ø—Ä–æ–¥–∞–≤–∞–π –ø–∞—Ä—Ç–∏—è–º–∏ –∏ —Å–ª–µ–¥–∏ –∑–∞ Heat.");
  }
  ensureHist();
  renderAll();
  showPage("market");

})();
</script>
</body>
  </html>
