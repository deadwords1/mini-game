<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DarkSurvival ‚Äî –†—É–ª–µ—Ç–∫–∞</title>
  <style>
    :root{
      --bg:#f6efe6;
      --panel:#efe3d6;
      --text:#2a1c14;
      --muted:#7b5c4f;
      --accent:#c5461f;
      --btnGrad: linear-gradient(135deg, #5a2a16 0%, #b13a1b 55%, #6a2416 100%);
      --card:#fff7ef;
      --border: rgba(123,92,79,.30);
      --shadow: 0 14px 30px rgba(38,16,10,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .topbar{
      height:56px; background:#2b2b2b; color:#fff;
      display:flex; align-items:center; gap:10px; padding:0 14px;
      position:sticky; top:0; z-index:5;
    }
    .topbar .x{
      width:34px; height:34px; border-radius:10px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.08);
      user-select:none;
    }
    .topbar .title{
      display:flex; align-items:center; gap:8px; flex:1;
      font-weight:900; opacity:.95;
    }
    .wrap{max-width:980px; margin:0 auto; padding:16px 14px 40px;}
    .hero{ text-align:center; padding:10px 6px 6px; }
    .hero h1{
      margin:10px 0 6px;
      font-size:34px; line-height:1.05;
      color: var(--accent); font-weight:1000;
    }
    .hero .sub{color:var(--muted); font-weight:800; font-size:14px;}

    .panel{
      margin-top:14px;
      background: var(--card);
      border:2px solid var(--border);
      border-radius:18px;
      box-shadow: 0 12px 24px rgba(38,16,10,.12);
      padding: 14px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 860px){
      .row{ grid-template-columns: 1.1fr .9fr; align-items: start; }
    }

    .box{
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(123,92,79,.25);
      border-radius: 16px;
      padding: 12px;
    }

    label{display:block; font-weight:900; color:#3a231a; margin-bottom:8px;}
    .input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 2px solid rgba(123,92,79,.25);
      background: rgba(255,255,255,.7);
      font-weight: 800;
      outline: none;
    }
    .hint{color:var(--muted); font-weight:800; font-size:13px; margin-top:8px; line-height:1.35;}
    .btn{
      width:100%;
      padding: 14px 14px;
      border-radius: 14px;
      border:0;
      background: var(--btnGrad);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      box-shadow: var(--shadow);
      transition: transform .08s ease, filter .08s ease;
    }
    .btn:active{transform: scale(.99); filter:brightness(.98)}
    .btn:disabled{opacity:.55; cursor:not-allowed; box-shadow:none}

    .btnGhost{
      width:100%;
      padding: 12px 14px;
      border-radius: 14px;
      border: 2px solid rgba(123,92,79,.35);
      background: transparent;
      color:#3a231a;
      font-weight:1000;
      cursor:pointer;
    }

    .wheelWrap{
      display:grid;
      place-items:center;
      gap: 12px;
      padding: 8px 0 4px;
    }

    canvas{
      width:min(420px, 92vw);
      height:min(420px, 92vw);
      max-width:420px;
      max-height:420px;
      background: linear-gradient(135deg, rgba(197,70,31,.06), rgba(123,42,24,.06));
      border-radius: 999px;
      border: 2px solid var(--border);
      box-shadow: 0 18px 40px rgba(0,0,0,.14);
    }

    .pointer{
      width: 0; height:0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 26px solid #2a1c14;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
      margin-top: -6px;
    }

    .stats{
      display:flex;
      flex-direction:column;
      gap:8px;
      font-weight:900;
      color:#3a231a;
    }
    .pill{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      background: rgba(255,255,255,.55);
      border-radius: 14px;
      border: 1px solid rgba(123,92,79,.25);
      font-size: 13px;
    }
    .pill b{font-weight:1000; color:var(--accent)}
    .small{font-size:12px; font-weight:800; color:var(--muted); line-height:1.35}

    /* modal */
    .overlay{
      position: fixed; inset:0;
      background: rgba(0,0,0,.35);
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      z-index: 20;
    }
    .overlay.show{display:flex}
    .modal{
      width: min(560px, 96vw);
      background: var(--panel);
      border-radius: 16px;
      border: 2px solid rgba(123,92,79,.35);
      box-shadow: 0 20px 40px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modalHead{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(123,92,79,.25);
    }
    .modalHead h3{margin:0; font-size:20px; font-weight:1000;}
    .closeX{
      width:36px; height:36px;
      border-radius:12px; border:0;
      background: rgba(0,0,0,.08);
      font-weight:1000; cursor:pointer;
    }
    .modalBody{padding: 14px;}
    .winTitle{
      font-size: 22px;
      font-weight: 1000;
      color: var(--accent);
      margin: 4px 0 8px;
      text-align:center;
    }
    .winDesc{
      text-align:center;
      color:#3a231a;
      font-weight:800;
      line-height:1.35;
      margin: 0 0 10px;
    }
    .codeBox{
      text-align:center;
      font-weight:1000;
      background: rgba(255,255,255,.6);
      border: 1px solid rgba(123,92,79,.25);
      border-radius: 14px;
      padding: 10px 12px;
      margin: 10px 0 10px;
      word-break: break-word;
    }
    .modalActions{
      display:flex;
      gap: 12px;
      justify-content:center;
      padding: 12px 14px 16px;
      border-top: 1px solid rgba(123,92,79,.25);
      flex-wrap: wrap;
    }
    .actionBtn{
      min-width: 180px;
      border-radius: 12px;
      border:0;
      padding: 12px 14px;
      font-weight: 1000;
      cursor:pointer;
    }
    .actionBtn.gray{background:#80858b; color:#fff;}
    .actionBtn.orange{background: var(--btnGrad); color:#fff;}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="x">‚úï</div>
    <div class="title">üü™ darksurvival</div>
    <div style="display:flex;gap:10px;opacity:.95;">
      <span style="width:4px;height:4px;border-radius:99px;background:#fff;"></span>
      <span style="width:4px;height:4px;border-radius:99px;background:#fff;"></span>
      <span style="width:4px;height:4px;border-radius:99px;background:#fff;"></span>
    </div>
  </div>

  <div class="wrap">
    <div class="hero">
      <h1>üé° –†—É–ª–µ—Ç–∫–∞<br/>DarkSurvival</h1>
      <div class="sub">–î–æ—Å—Ç—É–ø –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É. –ö—Ä—É—Ç–æ–µ –≤—ã–±–∏—Ç—å —Å–ª–æ–∂–Ω–æ ‚Äî –Ω–æ —Ä–µ–∞–ª—å–Ω–æ üòà</div>
    </div>

    <div class="panel">
      <div class="row">
        <!-- Left: wheel -->
        <div class="box">
          <div class="wheelWrap">
            <div class="pointer"></div>
            <canvas id="wheel" width="520" height="520" aria-label="wheel"></canvas>
            <button class="btn" id="spinBtn">–ö—Ä—É—Ç–∏—Ç—å</button>
            <div class="small" id="spinNote" style="text-align:center;">
              –í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ ‚Üí –Ω–∞–∂–º–∏—Ç–µ ¬´–ö—Ä—É—Ç–∏—Ç—å¬ª. –ü—Ä–æ–º–æ–∫–æ–¥ (–∫—Ä–æ–º–µ –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ) —Ä–∞–±–æ—Ç–∞–µ—Ç 1 —Ä–∞–∑ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
            </div>
          </div>
        </div>

        <!-- Right: inputs + info -->
        <div class="box">
          <label for="promo">–ü—Ä–æ–º–æ–∫–æ–¥</label>
          <input class="input" id="promo" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: DS-7F2K9" autocomplete="off" />

          <div class="hint">
            ‚Ä¢ –î–ª—è —Ç–µ—Å—Ç–∞: –∞–¥–º–∏–Ω-–ø—Ä–æ–º–æ–∫–æ–¥ <b>1</b> (–±–µ–∑ –ª–∏–º–∏—Ç–∞)<br/>
            ‚Ä¢ –û–±—ã—á–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã (1 —Ä–∞–∑ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ)
          </div>

          <div style="height:10px"></div>

          <label for="nick">–ù–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è)</label>
          <input class="input" id="nick" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: spxce_mxn" autocomplete="off" />

          <div style="height:12px"></div>

          <div class="stats" id="oddsBox"></div>

          <div style="height:10px"></div>
          <div class="small">
            ‚ö†Ô∏è –ù–∞ —á–∏—Å—Ç–æ–º —Å–∞–π—Ç–µ –Ω–µ–ª—å–∑—è ¬´–∑–∞–ø—Ä–µ—Ç–∏—Ç—å¬ª —á–µ–ª–æ–≤–µ–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ TG –Ω–∞ 100%.<br/>
            –Ø –¥–æ–±–∞–≤–∏–ª —É–Ω–∏–∫–∞–ª—å–Ω—ã–π <b>Claim ID</b> (–∫–æ–¥ –∑–∞—è–≤–∫–∏). –î–ª—è 100% –∑–∞—â–∏—Ç—ã –¥–∞–ª—å—à–µ –¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ –±–æ—Ç–∞: –±–æ—Ç –≤—ã–¥–∞—ë—Ç
            –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –∫–æ–¥ –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ –∑–∞—è–≤–∫–∏.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Win modal -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modalHead">
        <h3>üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!</h3>
        <button class="closeX" id="closeModal">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="winTitle" id="winTitle">‚Äî</div>
        <div class="winDesc" id="winDesc">‚Äî</div>

        <div class="codeBox" id="claimBox">Claim ID: ‚Äî</div>

        <div class="small" style="text-align:center;">
          –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑¬ª ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç —Å @SalesManagerX –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ.
        </div>
      </div>
      <div class="modalActions">
        <button class="actionBtn gray" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Claim ID</button>
        <button class="actionBtn orange" id="claimBtn">–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑</button>
      </div>
    </div>
  </div>

<script>
  // ====== SETTINGS ======
  const SALES_USERNAME = "SalesManagerX"; // @SalesManagerX
  const ADMIN_PROMO = "1";

  // 10 –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ (–ø–æ–º–µ–Ω—è–µ—à—å –Ω–∞ —Å–≤–æ–∏)
  const PROMOS = [
    "DS-7F2K9","DS-A3M8Q","DS-V9P1X","DS-4J6ZT","DS-N2W5L",
    "DS-8C0RD","DS-K1H7B","DS-Q6T2Y","DS-5U9SN","DS-X3D4G"
  ];

  // ====== PRIZES + WEIGHTS (–≤ —Å—É–º–º–µ 100%) ======
  // "–∫—Ä—É—Ç–æ–µ —Å–ª–æ–∂–Ω–æ":
  // VOID 0.3%, LUXE 1.2%, PLATINUM 5%, VIP 10% (—É —Ç–µ–±—è –±—ã–ª–æ 30/20/7/3 ‚Äî —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –ª–µ–≥–∫–æ)
  // –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤–∞–ª—é—Ç–∞/–ø–æ–∏–Ω—Ç—ã
  const PRIZES = [
    { id:"vip",       label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è VIP",        type:"rank",   value:"VIP",       weight:10.0,  emoji:"üü©", desc:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è VIP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ." },
    { id:"platinum",  label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è PLATINUM",   type:"rank",   value:"PLATINUM",  weight:5.0,   emoji:"‚¨ú", desc:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è PLATINUM –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ." },
    { id:"luxe",      label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è LUXE",       type:"rank",   value:"LUXE",      weight:1.2,   emoji:"üíé", desc:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è LUXE –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ." },
    { id:"void",      label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è VOID",       type:"rank",   value:"VOID",      weight:0.3,   emoji:"üü™", desc:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è VOID –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ." },

    { id:"rub_1000",  label:"–í–∞–ª—é—Ç–∞ 1 000‚ÇΩ",         type:"money",  value:1000,        weight:20.0,  emoji:"üí∏", desc:"–î–µ–Ω–µ–∂–Ω—ã–π –ø—Ä–∏–∑ 1 000‚ÇΩ." },
    { id:"rub_5000",  label:"–í–∞–ª—é—Ç–∞ 5 000‚ÇΩ",         type:"money",  value:5000,        weight:16.0,  emoji:"üí∞", desc:"–î–µ–Ω–µ–∂–Ω—ã–π –ø—Ä–∏–∑ 5 000‚ÇΩ." },
    { id:"rub_10000", label:"–í–∞–ª—é—Ç–∞ 10 000‚ÇΩ",        type:"money",  value:10000,       weight:10.0,  emoji:"üíµ", desc:"–î–µ–Ω–µ–∂–Ω—ã–π –ø—Ä–∏–∑ 10 000‚ÇΩ." },
    { id:"rub_50000", label:"–í–∞–ª—é—Ç–∞ 50 000‚ÇΩ",        type:"money",  value:50000,       weight:1.0,   emoji:"üèÜ", desc:"–î–µ–Ω–µ–∂–Ω—ã–π –ø—Ä–∏–∑ 50 000‚ÇΩ (—Ä–µ–¥–∫–æ)." },

    { id:"p_5",       label:"–ü–æ–∏–Ω—Ç—ã +5",             type:"points", value:5,           weight:15.0,  emoji:"‚≠ê", desc:"–ò–≥—Ä–æ–≤—ã–µ –ø–æ–∏–Ω—Ç—ã +5." },
    { id:"p_10",      label:"–ü–æ–∏–Ω—Ç—ã +10",            type:"points", value:10,          weight:10.0,  emoji:"üåü", desc:"–ò–≥—Ä–æ–≤—ã–µ –ø–æ–∏–Ω—Ç—ã +10." },
    { id:"p_20",      label:"–ü–æ–∏–Ω—Ç—ã +20",            type:"points", value:20,          weight:7.0,   emoji:"‚ú®", desc:"–ò–≥—Ä–æ–≤—ã–µ –ø–æ–∏–Ω—Ç—ã +20." },
    { id:"p_30",      label:"–ü–æ–∏–Ω—Ç—ã +30",            type:"points", value:30,          weight:3.0,   emoji:"üî•", desc:"–ò–≥—Ä–æ–≤—ã–µ –ø–æ–∏–Ω—Ç—ã +30." },
    { id:"p_50",      label:"–ü–æ–∏–Ω—Ç—ã +50",            type:"points", value:50,          weight:1.5,   emoji:"üëë", desc:"–ò–≥—Ä–æ–≤—ã–µ –ø–æ–∏–Ω—Ç—ã +50 (—Ä–µ–¥–∫–æ)." },
  ];

  // ====== Helpers ======
  const $ = (id)=>document.getElementById(id);
  const fmtRub = (n)=> new Intl.NumberFormat("ru-RU").format(n) + "‚ÇΩ";

  function totalWeight(){
    return PRIZES.reduce((a,p)=>a+p.weight,0);
  }

  function pickWeighted(){
    const sum = totalWeight();
    let r = Math.random() * sum;
    for(const p of PRIZES){
      r -= p.weight;
      if(r <= 0) return p;
    }
    return PRIZES[PRIZES.length-1];
  }

  function genClaimId(){
    const arr = new Uint32Array(3);
    crypto.getRandomValues(arr);
    const base = Array.from(arr).map(x => x.toString(36)).join("-").toUpperCase();
    const t = Date.now().toString(36).toUpperCase();
    return `DS-${t}-${base}`;
  }

  function promoUsedKey(promo){ return `ds_promo_used_${promo}`; }

  function isPromoAllowed(promo){
    promo = (promo||"").trim();
    if(!promo) return { ok:false, reason:"–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥." };
    if(promo === ADMIN_PROMO) return { ok:true, admin:true };
    if(!PROMOS.includes(promo)) return { ok:false, reason:"–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥." };
    if(localStorage.getItem(promoUsedKey(promo)) === "1"){
      return { ok:false, reason:"–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ." };
    }
    return { ok:true, admin:false };
  }

  function markPromoUsed(promo){
    if(promo === ADMIN_PROMO) return; // –∞–¥–º–∏–Ω –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º
    localStorage.setItem(promoUsedKey(promo), "1");
  }

  // ====== Wheel rendering ======
  const canvas = $("wheel");
  const ctx = canvas.getContext("2d");
  const cx = canvas.width/2, cy = canvas.height/2;
  const radius = Math.min(cx,cy) - 14;

  // —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ –ø—Ä–∏–∑–∞–º
  const segments = PRIZES.map(p => ({
    ...p,
    colorA: "rgba(197,70,31,.16)",
    colorB: "rgba(123,42,24,.16)"
  }));

  let currentRotation = 0; // radians
  let spinning = false;

  function drawWheel(rotationRad){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // base circle
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(rotationRad);

    const n = segments.length;
    const arc = (Math.PI*2)/n;

    for(let i=0;i<n;i++){
      const s = segments[i];
      const start = i*arc;
      const end = start + arc;

      // slice
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,radius,start,end);
      ctx.closePath();

      // alternating vibes
      const grad = ctx.createLinearGradient(
        Math.cos(start)*radius, Math.sin(start)*radius,
        Math.cos(end)*radius, Math.sin(end)*radius
      );
      grad.addColorStop(0, i%2===0 ? "rgba(197,70,31,.20)" : "rgba(123,42,24,.20)");
      grad.addColorStop(1, i%2===0 ? "rgba(123,42,24,.16)" : "rgba(197,70,31,.16)");
      ctx.fillStyle = grad;
      ctx.fill();

      ctx.lineWidth = 2;
      ctx.strokeStyle = "rgba(123,92,79,.30)";
      ctx.stroke();

      // text
      ctx.save();
      ctx.rotate(start + arc/2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#2a1c14";
      ctx.font = "900 16px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      const label = `${s.emoji} ${shortLabel(s.label)}`;
      ctx.fillText(label, radius - 16, 6);
      ctx.restore();
    }

    // center cap
    ctx.beginPath();
    ctx.arc(0,0,58,0,Math.PI*2);
    ctx.fillStyle = "rgba(255,255,255,.65)";
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = "rgba(123,92,79,.30)";
    ctx.stroke();

    ctx.fillStyle = "#c5461f";
    ctx.font = "1000 18px system-ui, -apple-system, Segoe UI, Roboto, Arial";
    ctx.textAlign = "center";
    ctx.fillText("SPIN", 0, 7);

    ctx.restore();
  }

  function shortLabel(s){
    // –∫–æ–º–ø–∞–∫—Ç–Ω–æ, —á—Ç–æ–± –Ω–∞ –∫–æ–ª–µ—Å–µ –Ω–µ –∫–∞—à–µ–π
    return s
      .replace("–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è ","")
      .replace("–í–∞–ª—é—Ç–∞ ","")
      .replace("–ü–æ–∏–Ω—Ç—ã ","+")
      .replace("‚ÇΩ","‚ÇΩ");
  }

  drawWheel(currentRotation);

  // ====== Odds UI ======
  function renderOdds(){
    const box = $("oddsBox");
    box.innerHTML = "";

    const top = [...PRIZES].sort((a,b)=>a.weight-b.weight);
    const show = [
      top[0], top[1], top[2],
      ...PRIZES.filter(p=>p.type==="rank").sort((a,b)=>a.weight-b.weight)
    ].slice(0,6);

    // –ø–æ–∫–∞–∂–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —à–∞–Ω—Å—ã –∫—Ä–∞—Å–∏–≤–æ (–Ω–µ –≤—Å–µ 13 –ø—É–Ω–∫—Ç–æ–≤, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å)
    const blocks = [
      { title:"–°–∞–º—ã–µ —Ä–µ–¥–∫–∏–µ", items: top.slice(0,4) },
      { title:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏", items: PRIZES.filter(p=>p.type==="rank") },
    ];

    for(const b of blocks){
      const head = document.createElement("div");
      head.className = "pill";
      head.innerHTML = `<span>${b.title}</span><b>—à–∞–Ω—Å—ã</b>`;
      box.appendChild(head);

      for(const p of b.items){
        const el = document.createElement("div");
        el.className = "pill";
        el.innerHTML = `<span>${p.label}</span><b>${p.weight.toFixed(1)}%</b>`;
        box.appendChild(el);
      }
    }
  }
  renderOdds();

  // ====== Spin logic: –≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–∏–∑ –ø–æ –≤–µ—Å—É, –∑–∞—Ç–µ–º –¥–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫–æ–ª–µ—Å–æ —Ç–∞–∫, —á—Ç–æ–±—ã —Å—Ç—Ä–µ–ª–∫–∞ –ø–æ–ø–∞–ª–∞ –Ω–∞ –Ω–µ–≥–æ ======
  function segmentIndexById(id){
    return segments.findIndex(s => s.id === id);
  }

  function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

  function spinToPrize(targetPrize){
    const n = segments.length;
    const arc = (Math.PI*2)/n;
    const idx = segmentIndexById(targetPrize.id);

    // pointer is at top (angle -90deg). We'll target slice center to land at pointer.
    const pointerAngle = -Math.PI/2;

    // Center angle of the target slice in wheel coordinates:
    const sliceCenter = (idx * arc) + arc/2;

    // We want: rotation + sliceCenter ‚âà pointerAngle (mod 2pi)
    // => rotation ‚âà pointerAngle - sliceCenter + k*2pi
    const baseTarget = pointerAngle - sliceCenter;

    // Add extra spins
    const extraTurns = 6 + Math.floor(Math.random()*4); // 6..9 turns
    const targetRotation = baseTarget + extraTurns * Math.PI * 2;

    const start = currentRotation;
    const delta = targetRotation - start;

    const duration = 4200 + Math.random()*600; // ms
    const t0 = performance.now();

    return new Promise(resolve => {
      function frame(now){
        const t = Math.min(1, (now - t0)/duration);
        const k = easeOutCubic(t);
        currentRotation = start + delta * k;
        drawWheel(currentRotation);
        if(t < 1) requestAnimationFrame(frame);
        else resolve();
      }
      requestAnimationFrame(frame);
    });
  }

  // ====== Modal + claim ======
  let lastWin = null; // {prize, claimId, promo, ts}
  const overlay = $("overlay");
  const spinBtn = $("spinBtn");
  const promoInput = $("promo");
  const nickInput = $("nick");
  const winTitle = $("winTitle");
  const winDesc = $("winDesc");
  const claimBox = $("claimBox");

  function openModal(){ overlay.classList.add("show"); }
  function closeModal(){ overlay.classList.remove("show"); }

  $("closeModal").addEventListener("click", closeModal);
  overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });

  $("copyBtn").addEventListener("click", async ()=>{
    if(!lastWin) return;
    try{
      await navigator.clipboard.writeText(lastWin.claimId);
      alert("Claim ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω ‚úÖ");
    }catch{
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. Claim ID: " + lastWin.claimId);
    }
  });

  function buildTelegramText(win){
    const nick = (nickInput.value || "").trim();
    const promo = (win.promo || "").trim();

    const lines = [];
    lines.push("–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –•–æ—á—É –∑–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑ –∏–∑ —Ä—É–ª–µ—Ç–∫–∏ DarkSurvival.");
    lines.push("");
    lines.push("–ù–∏–∫: " + nick);
    lines.push("–ü—Ä–æ–º–æ–∫–æ–¥: " + promo);
    lines.push("–ü—Ä–∏–∑: " + win.prize.label);
    lines.push("Claim ID: " + win.claimId);
    lines.push("–í—Ä–µ–º—è: " + new Date(win.ts).toLocaleString("ru-RU"));
    lines.push("");
    lines.push("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Claim ID.");

    return lines.join("\n");
  }

  function openTelegram(username, text){
    const url = `https://t.me/${encodeURIComponent(username)}?text=${encodeURIComponent(text)}`;
    window.open(url, "_blank");
  }

  $("claimBtn").addEventListener("click", ()=>{
    if(!lastWin) return;

    const nick = (nickInput.value || "").trim();
    if(!nick){
      alert("–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏ –Ω–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ üôÇ");
      return;
    }

    const text = buildTelegramText(lastWin);
    openTelegram(SALES_USERNAME, text);
  });

  // ====== Spin button ======
  spinBtn.addEventListener("click", async ()=>{
    if(spinning) return;

    const promo = (promoInput.value || "").trim();
    const check = isPromoAllowed(promo);
    if(!check.ok){
      alert(check.reason);
      return;
    }

    spinning = true;
    spinBtn.disabled = true;
    spinBtn.textContent = "–ö—Ä—É—Ç–∏–º...";

    // pick win
    const prize = pickWeighted();
    const claimId = genClaimId();
    const ts = Date.now();

    // spin animation to land on it
    await spinToPrize(prize);

    // mark promo used (–µ—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω)
    markPromoUsed(promo);

    lastWin = { prize, claimId, promo, ts };

    // persist win locally (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä—É)
    try{
      const histKey = "ds_roulette_history";
      const prev = JSON.parse(localStorage.getItem(histKey) || "[]");
      prev.unshift(lastWin);
      localStorage.setItem(histKey, JSON.stringify(prev.slice(0,25)));
    }catch{}

    winTitle.textContent = prize.label;
    winDesc.textContent = prize.desc;
    claimBox.textContent = "Claim ID: " + claimId;

    openModal();

    spinBtn.textContent = "–ö—Ä—É—Ç–∏—Ç—å";
    spinBtn.disabled = false;
    spinning = false;
  });

  // initial draw
  drawWheel(currentRotation);

  // small UX: Enter to spin
  promoInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") spinBtn.click();
  });
  nickInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") {
      if(lastWin) $("claimBtn").click();
      else spinBtn.click();
    }
  });
</script>
</body>
  </html>
