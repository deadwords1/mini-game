<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Neon Market Sim (Fiction)</title>
  <style>
    :root{
      color-scheme: dark;
      --bgA:#05060c;
      --bgB:#0b0d1a;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --txt:#ffffff;
      --muted: rgba(255,255,255,.70);

      --p1:#7C3AED; /* violet */
      --p2:#EC4899; /* pink */
      --p3:#22D3EE; /* cyan */
      --good:#34D399;
      --warn:#FBBF24;
      --bad:#FB7185;

      --r: 22px;
      --shadow: 0 30px 120px rgba(0,0,0,.65);
      --navH: 78px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--txt);
      background:
        radial-gradient(900px 520px at 16% 12%, rgba(124,58,237,.22), transparent 60%),
        radial-gradient(900px 520px at 84% 10%, rgba(236,72,153,.18), transparent 60%),
        radial-gradient(900px 520px at 50% 94%, rgba(34,211,238,.14), transparent 62%),
        linear-gradient(180deg, var(--bgA), var(--bgB));
      overflow-x:hidden;
    }

    /* new grain */
    body::before{
      content:"";
      position:fixed; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.95' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.14'/%3E%3C/svg%3E");
      opacity:.18;
      mix-blend-mode: overlay;
      pointer-events:none;
      z-index: 1;
    }

    /* subtle moving glow layer */
    .glow{
      position:fixed; inset:-20%;
      background:
        radial-gradient(circle at 20% 20%, rgba(124,58,237,.20), transparent 55%),
        radial-gradient(circle at 78% 22%, rgba(236,72,153,.16), transparent 56%),
        radial-gradient(circle at 50% 88%, rgba(34,211,238,.12), transparent 58%);
      filter: blur(30px);
      opacity:.85;
      animation: drift 14s ease-in-out infinite alternate;
      pointer-events:none;
      z-index: 0;
    }
    @keyframes drift{
      from{ transform: translate3d(-1.5%, -1%, 0) scale(1.02); }
      to{   transform: translate3d( 1.8%,  1.3%, 0) scale(1.06); }
    }

    /* Layout */
    .app{
      position:relative;
      z-index:2;
      min-height:100%;
      padding-bottom: calc(var(--navH) + 22px);
    }
    .wrap{
      max-width: 1180px;
      margin:0 auto;
      padding: 18px 16px;
    }

    /* Header (different design: wide capsule) */
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 14px 14px;
      border-radius: 26px;
      border:1px solid var(--stroke);
      background: linear-gradient(135deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      position:sticky;
      top:12px;
      z-index:3;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
      min-width: 0;
    }
    .mark{
      width:48px; height:48px;
      border-radius: 18px;
      background:
        radial-gradient(circle at 30% 30%, rgba(34,211,238,.40), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(236,72,153,.35), transparent 55%),
        linear-gradient(135deg, rgba(124,58,237,.55), rgba(236,72,153,.25));
      border:1px solid rgba(255,255,255,.14);
      box-shadow:
        0 0 0 6px rgba(124,58,237,.08),
        0 18px 50px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
    }
    .mark::after{
      content:"";
      position:absolute; inset:-70%;
      background: conic-gradient(from 210deg, transparent, rgba(255,255,255,.14), transparent);
      animation: spin 10s linear infinite;
      opacity:.65;
      pointer-events:none;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    .brandText{ min-width:0; }
    .brandText b{
      display:block;
      font-weight:1000;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandText span{
      display:block;
      margin-top:3px;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .stats{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .chip{
      display:flex; align-items:center; gap:10px;
      padding: 10px 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      min-width: 150px;
    }
    .chip .k{ font-size:11px; color:var(--muted); font-weight:900; }
    .chip .v{ font-size:14px; font-weight:1000; letter-spacing:.2px; }
    .spark{
      width:10px; height:10px;
      border-radius:999px;
      background: rgba(236,72,153,.92);
      box-shadow: 0 0 18px rgba(236,72,153,.24);
    }
    .spark.c{ background: rgba(34,211,238,.95); box-shadow: 0 0 18px rgba(34,211,238,.22); }
    .spark.g{ background: rgba(52,211,153,.92); box-shadow: 0 0 18px rgba(52,211,153,.20); }

    /* Pages */
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .chip{ min-width: 140px; }
    }

    .card{
      border-radius: var(--r);
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(14px);
      box-shadow: 0 18px 70px rgba(0,0,0,.30);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-60%;
      background:
        radial-gradient(circle at 22% 18%, rgba(124,58,237,.14), transparent 60%),
        radial-gradient(circle at 82% 26%, rgba(236,72,153,.12), transparent 62%),
        radial-gradient(circle at 52% 92%, rgba(34,211,238,.10), transparent 62%);
      opacity:.95;
      pointer-events:none;
    }
    .cardIn{
      position:relative;
      z-index:1;
      padding: 14px;
    }
    .cardTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 12px;
    }
    .cardTitle b{
      font-size:13px;
      font-weight:1000;
      letter-spacing:.22px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-weight:950;
      font-size:11px;
      color: rgba(255,255,255,.85);
      white-space:nowrap;
    }

    /* table list */
    table{
      width:100%;
      border-collapse:separate;
      border-spacing: 0 10px;
    }
    th,td{
      text-align:left;
      padding:10px 12px;
      font-size:12px;
    }
    th{
      color: var(--muted);
      font-weight:900;
      letter-spacing:.18px;
      text-transform:uppercase;
      font-size:11px;
    }
    .row{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
    }
    .row td:first-child{ border-top-left-radius:16px; border-bottom-left-radius:16px; }
    .row td:last-child{ border-top-right-radius:16px; border-bottom-right-radius:16px; }

    .mono{ font-variant-numeric: tabular-nums; }
    .pos{ color: var(--good); font-weight:950; }
    .neg{ color: var(--bad); font-weight:950; }
    .warn{ color: var(--warn); font-weight:950; }

    /* Buttons */
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding: 11px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .14s ease, border-color .16s ease, box-shadow .16s ease;
      position:relative;
      overflow:hidden;
      transform: translateZ(0);
      white-space:nowrap;
    }
    .btn:hover{
      filter: brightness(1.08);
      border-color: rgba(236,72,153,.30);
      box-shadow: 0 14px 50px rgba(0,0,0,.25), 0 0 34px rgba(236,72,153,.10);
      transform: translateY(-1px);
    }
    .btn:active{ transform: translateY(0px) scale(.992); }
    .btn.primary{
      border-color: rgba(236,72,153,.30);
      background: linear-gradient(135deg, rgba(124,58,237,.26), rgba(236,72,153,.16));
    }
    .btn.danger{
      border-color: rgba(251,113,133,.30);
      background: linear-gradient(135deg, rgba(251,113,133,.18), rgba(255,255,255,.06));
    }
    .btn.full{ width:100%; }
    .btn.small{ padding:9px 11px; border-radius:14px; font-size:12px; }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    /* Quick tiles */
    .tiles{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;
    }
    @media (max-width: 480px){
      .tiles{ grid-template-columns: 1fr; }
    }
    .tile{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 12px;
      transition:.15s;
    }
    .tile:hover{
      border-color: rgba(34,211,238,.26);
      box-shadow: 0 16px 54px rgba(0,0,0,.25);
      transform: translateY(-1px);
    }
    .tile b{ display:block; font-weight:1000; letter-spacing:.2px; }
    .tile p{ margin:6px 0 10px; color:var(--muted); font-size:12px; line-height:1.4; }
    .tile .foot{ display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .tile .foot span{ color: rgba(255,255,255,.85); font-weight:950; }

    /* Bottom Nav fixed */
    .bottomNav{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: 12px;
      width: min(980px, calc(100% - 24px));
      height: var(--navH);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,12,22,.62);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 10px 12px;
      z-index: 9;
      overflow:hidden;
    }
    .bottomNav::before{
      content:"";
      position:absolute; inset:-60%;
      background:
        radial-gradient(circle at 20% 40%, rgba(124,58,237,.14), transparent 60%),
        radial-gradient(circle at 80% 30%, rgba(236,72,153,.12), transparent 62%),
        radial-gradient(circle at 60% 90%, rgba(34,211,238,.10), transparent 62%);
      opacity:.9;
      pointer-events:none;
    }

    .navItem{
      flex: 1 1 0;
      height: 56px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      font-weight:1000;
      transition:.15s;
      position:relative;
      z-index:1;
      user-select:none;
    }
    .navItem:hover{
      border-color: rgba(34,211,238,.24);
      transform: translateY(-1px);
    }
    .navItem.active{
      border-color: rgba(236,72,153,.30);
      background: linear-gradient(135deg, rgba(124,58,237,.18), rgba(236,72,153,.12));
      box-shadow: 0 0 38px rgba(236,72,153,.10);
    }
    .navIcon{
      width:34px;height:34px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      display:grid;place-items:center;
      font-size:18px;
    }
    .navLabel{ display:flex; flex-direction:column; line-height:1.05; }
    .navLabel small{ font-size:10px; color:var(--muted); font-weight:900; }

    /* Floating + month button */
    .fab{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(var(--navH) + 18px);
      width: 64px;
      height: 64px;
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(124,58,237,.34), rgba(236,72,153,.22));
      backdrop-filter: blur(14px);
      box-shadow:
        0 22px 70px rgba(0,0,0,.45),
        0 0 46px rgba(236,72,153,.10);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      z-index: 10;
      transition:.15s;
    }
    .fab:hover{ transform: translateX(-50%) translateY(-2px); filter: brightness(1.08); }
    .fab:active{ transform: translateX(-50%) translateY(-1px) scale(.995); }
    .fab span{
      font-size: 30px;
      font-weight: 1000;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }
    .fabHint{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(var(--navH) + 88px);
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(14px);
      font-size:11px;
      font-weight:950;
      color: rgba(255,255,255,.85);
      z-index: 10;
      opacity:.0;
      transition:.18s;
      pointer-events:none;
    }
    .fab:hover + .fabHint{ opacity:1; transform: translateX(-50%) translateY(-2px); }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom: calc(var(--navH) + 110px);
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(10,12,22,.72);
      backdrop-filter: blur(16px);
      box-shadow: var(--shadow);
      font-weight:1000;
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 50;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-4px); }

    /* Modal */
    .backdrop{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      background: rgba(0,0,0,.64);
      z-index: 100;
    }
    .backdrop.show{ display:flex; }

    .modal{
      width:min(980px, 100%);
      max-height: min(86vh, 860px);
      overflow:auto;
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(12,14,26,.92);
      backdrop-filter: blur(18px);
      box-shadow: var(--shadow);
      position:relative;
    }
    .mHead{
      position:sticky;
      top:0;
      background: rgba(12,14,26,.92);
      backdrop-filter: blur(18px);
      border-bottom:1px solid rgba(255,255,255,.06);
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      z-index:2;
    }
    .mHead b{ font-weight:1000; letter-spacing:.2px; }
    .mBody{ padding:12px; }
    .mGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 860px){
      .mGrid{ grid-template-columns: 1fr; }
    }
    .field{ display:grid; gap:8px; }
    .field label{ font-size:11px; color:var(--muted); font-weight:900; }
    input,select,textarea{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:#fff;
      outline:none;
      font-weight:900;
    }
    textarea{ min-height: 90px; font-weight:800; }
    input:focus,select:focus,textarea:focus{
      border-color: rgba(236,72,153,.30);
      box-shadow: 0 0 0 4px rgba(236,72,153,.08);
    }
    .hr{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 12px 0;
    }

    .help{
      color: var(--muted);
      font-size:12px;
      line-height:1.45;
    }

    .pillLine{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      margin-top:10px;
      font-weight:950;
    }
    .pillLine b{
      font-weight:1000;
      background: linear-gradient(90deg, rgba(124,58,237,.98), rgba(236,72,153,.98));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
  </style>
</head>

<body>
  <div class="glow"></div>

  <div class="app">
    <div class="wrap">
      <div class="header">
        <div class="brand">
          <div class="mark"></div>
          <div class="brandText">
            <b>Neon Market Sim</b>
            <span>–≤—ã–º—ã—à–ª–µ–Ω–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞ ‚Ä¢ —Ä–∏—Å–∫-—Å–æ–±—ã—Ç–∏—è ‚Ä¢ –∞–∫—Ç–∏–≤—ã</span>
          </div>
        </div>

        <div class="stats">
          <div class="chip"><div class="spark"></div><div><div class="k">–ú–µ—Å—è—Ü</div><div class="v mono" id="uiMonth">1</div></div></div>
          <div class="chip"><div class="spark c"></div><div><div class="k">Heat</div><div class="v mono" id="uiHeat">0%</div></div></div>
          <div class="chip"><div class="spark g"></div><div><div class="k">Cash</div><div class="v mono" id="uiCash">$0</div></div></div>
        </div>
      </div>

      <!-- PAGES -->
      <section id="page-market">
        <div class="grid">
          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–†—ã–Ω–æ–∫</b>
                <span class="tag" id="uiRiskTag">–†–∏—Å–∫: 0%</span>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th class="mono">Buy</th>
                    <th class="mono">Sell</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="marketRows"></tbody>
              </table>
              <div class="pillLine">
                <span>–°–∫–ª–∞–¥</span>
                <b class="mono" id="uiCap">0/0</b>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</b>
                <span class="tag" id="uiAssetsTag">–ê–∫—Ç–∏–≤—ã</span>
              </div>

              <div class="tiles">
                <div class="tile">
                  <b>–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</b>
                  <p>–ü—Ä–æ–¥–∞—ë—Ç –≤–µ—Å—å —Å–∫–ª–∞–¥. –ú–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–∏—Å–∫-—Å–æ–±—ã—Ç–∏–µ.</p>
                  <div class="foot">
                    <span class="mono" id="uiInvValue">$0</span>
                    <button class="btn primary small" id="btnSellAll">–ü—Ä–æ–¥–∞—Ç—å</button>
                  </div>
                </div>

                <div class="tile">
                  <b>–°–Ω–∏–∑–∏—Ç—å Heat</b>
                  <p>–ü–ª–∞—Ç–∏—à—å –∏ —É–º–µ–Ω—å—à–∞–µ—à—å Heat –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É–Ω–∫—Ç–æ–≤.</p>
                  <div class="foot">
                    <span class="mono" id="uiCoolCost">$0</span>
                    <button class="btn small" id="btnCool">–°–Ω–∏–∑–∏—Ç—å</button>
                  </div>
                </div>

                <div class="tile">
                  <b>–ó–∞—â–∏—Ç–∞</b>
                  <p>–ú–µ–Ω—å—à–µ —Ä–∏—Å–∫ + —á—É—Ç—å –≤—ã—à–µ —à–∞–Ω—Å ‚Äú—É–π—Ç–∏‚Äù.</p>
                  <div class="foot">
                    <span class="mono" id="uiArmorCost">$0</span>
                    <button class="btn small" id="btnArmor">–ö—É–ø–∏—Ç—å</button>
                  </div>
                </div>

                <div class="tile">
                  <b>–ê–¥–º–∏–Ω</b>
                  <p>–í—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é. –ú–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å—ë.</p>
                  <div class="foot">
                    <span class="mono">–ø–∞—Ä–æ–ª—å: ‚Ä¢‚Ä¢‚Ä¢</span>
                    <button class="btn danger small" id="btnAdmin">–û—Ç–∫—Ä—ã—Ç—å</button>
                  </div>
                </div>
              </div>

              <div class="actions">
                <button class="btn small" id="btnSave">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn small danger" id="btnReset">‚ôªÔ∏è –°–±—Ä–æ—Å</button>
              </div>

              <div style="height:10px"></div>
              <div class="help" id="uiHint"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-inventory" style="display:none;">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</b>
                <span class="tag">—Å–∫–ª–∞–¥ –∏ —Å—Ä–µ–¥–Ω—è—è –∑–∞–∫—É–ø–∫–∞</span>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th class="mono">Qty</th>
                    <th class="mono">Avg</th>
                    <th class="mono">–û—Ü–µ–Ω–∫–∞</th>
                    <th class="mono">Œî</th>
                  </tr>
                </thead>
                <tbody id="invRows"></tbody>
              </table>

              <div class="pillLine">
                <span>–ü—Ä–æ—Ñ–∏—Ç</span>
                <b class="mono" id="uiProfit">$0</b>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-assets" style="display:none;">
        <div class="grid">
          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–ú–∞—à–∏–Ω—ã</b>
                <span class="tag" id="uiRunTag">–£–π—Ç–∏: 0%</span>
              </div>
              <table>
                <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="mono">–¶–µ–Ω–∞</th><th class="mono">–£–π—Ç–∏</th><th></th></tr></thead>
                <tbody id="carRows"></tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–ë–∞–∑–∞ –∏ –ë–∏–∑–Ω–µ—Å</b>
                <span class="tag">–∫–∞–ø / –¥–æ—Ö–æ–¥</span>
              </div>

              <div class="help">–ë–∞–∑–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–ª–∞–¥. –ë–∏–∑–Ω–µ—Å –¥–∞—ë—Ç –¥–æ—Ö–æ–¥ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü.</div>
              <div class="hr"></div>

              <div class="mGrid">
                <div>
                  <div class="cardTitle"><b>–ë–∞–∑–∞</b><span class="tag" id="uiHomeTag">‚Äî</span></div>
                  <table>
                    <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="mono">–¶–µ–Ω–∞</th><th class="mono">–ö–∞–ø</th><th></th></tr></thead>
                    <tbody id="homeRows"></tbody>
                  </table>
                </div>
                <div>
                  <div class="cardTitle"><b>–ë–∏–∑–Ω–µ—Å</b><span class="tag" id="uiBizTag">‚Äî</span></div>
                  <table>
                    <thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="mono">–¶–µ–Ω–∞</th><th class="mono">–î–æ—Ö–æ–¥/–º–µ—Å</th><th></th></tr></thead>
                    <tbody id="bizRows"></tbody>
                  </table>
                </div>
              </div>

              <div class="pillLine">
                <span>–î–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü</span>
                <b class="mono" id="uiIncome">$0</b>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-upgrades" style="display:none;">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–ü—Ä–æ–∫–∞—á–∫–∏</b>
                <span class="tag">—Å–∫–∏–¥–∫–∏ / –±–æ–Ω—É—Å—ã / —Ä–∏—Å–∫</span>
              </div>

              <div class="mGrid" id="perkCards"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="page-log" style="display:none;">
        <div class="grid" style="grid-template-columns: 1fr;">
          <div class="card">
            <div class="cardIn">
              <div class="cardTitle">
                <b>–°–æ–±—ã—Ç–∏—è</b>
                <span class="tag">–∏—Å—Ç–æ—Ä–∏—è</span>
              </div>
              <div class="actions">
                <button class="btn small" id="btnClearLog">–û—á–∏—Å—Ç–∏—Ç—å</button>
              </div>
              <div style="height:10px"></div>
              <div id="logBox" style="display:grid;gap:10px"></div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <!-- Floating month button -->
  <div class="fab" id="fabMonth" title="–ü—Ä–æ–∂–∏—Ç—å –º–µ—Å—è—Ü"><span>Ôºã</span></div>
  <div class="fabHint">–ü—Ä–æ–∂–∏—Ç—å –º–µ—Å—è—Ü</div>

  <!-- Bottom nav -->
  <nav class="bottomNav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="navItem active" data-go="market">
      <div class="navIcon">üßø</div>
      <div class="navLabel">–†—ã–Ω–æ–∫<small>buy/sell</small></div>
    </div>
    <div class="navItem" data-go="inventory">
      <div class="navIcon">üéí</div>
      <div class="navLabel">–°–∫–ª–∞–¥<small>inv</small></div>
    </div>
    <div class="navItem" data-go="assets">
      <div class="navIcon">üöó</div>
      <div class="navLabel">–ê–∫—Ç–∏–≤—ã<small>cars</small></div>
    </div>
    <div class="navItem" data-go="upgrades">
      <div class="navIcon">üß¨</div>
      <div class="navLabel">–ü–µ—Ä–∫–∏<small>upg</small></div>
    </div>
    <div class="navItem" data-go="log">
      <div class="navIcon">üóÇÔ∏è</div>
      <div class="navLabel">–õ–µ–Ω—Ç–∞<small>log</small></div>
    </div>
  </nav>

  <!-- Event modal -->
  <div class="backdrop" id="eventBack">
    <div class="modal">
      <div class="mHead">
        <b id="eventTitle">–°–æ–±—ã—Ç–∏–µ</b>
        <button class="btn small" id="eventClose">‚úï</button>
      </div>
      <div class="mBody">
        <div class="help" id="eventText"></div>

        <div class="hr"></div>

        <div class="mGrid">
          <div class="pillLine"><span>–®–∞–Ω—Å —É–π—Ç–∏</span><b class="mono" id="eventRunChance">0%</b></div>
          <div class="pillLine"><span>–¶–µ–Ω–∞ ‚Äú–≤–∑—è—Ç–∫–∏‚Äù</span><b class="mono" id="eventBribeCost">$0</b></div>
        </div>

        <div class="actions">
          <button class="btn danger" id="actDump">üóëÔ∏è –í—ã–±—Ä–æ—Å–∏—Ç—å –≥—Ä—É–∑</button>
          <button class="btn primary" id="actRun">üèéÔ∏è –£–π—Ç–∏</button>
          <button class="btn" id="actBribe">üíµ ‚Äú–í–∑—è—Ç–∫–∞‚Äù</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin modal -->
  <div class="backdrop" id="adminBack">
    <div class="modal">
      <div class="mHead">
        <b>–ê–¥–º–∏–Ω–∫–∞</b>
        <button class="btn small" id="adminClose">‚úï</button>
      </div>
      <div class="mBody" id="adminBody"></div>
    </div>
  </div>

  <div class="toast" id="toast">–û–∫</div>

<script>
(() => {
  // Fictional economy game (black market / contraband items). No real-world guidance.
  const $ = (id)=>document.getElementById(id);

  const toastEl = $("toast");
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 1400);
  }
  function money(n){
    const sign = n < 0 ? "-" : "";
    n = Math.abs(Math.floor(Number(n)||0));
    return sign + "$" + n.toLocaleString("en-US");
  }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
  function rnd(a,b){ return a + Math.random()*(b-a); }
  function randi(a,b){ return Math.floor(rnd(a,b+1)); }
  function chance(p){ return Math.random() < p; }
  function esc(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  // ===== Data =====
  const ITEMS = [
    { id:"moon_dust",      name:"Moon Dust",      base: 1200,  vol:1, vibe:"–ª—É–Ω–Ω–∞—è –ø—ã–ª—å" },
    { id:"neon_spice",     name:"Neon Spice",     base: 2400,  vol:1, vibe:"–Ω–µ–æ–Ω–æ–≤–∞—è —Å–ø–µ—Ü–∏—è" },
    { id:"cipher_caps",    name:"Cipher Caps",    base: 3900,  vol:1, vibe:"—à–∏—Ñ—Ä-–∫–∞–ø—Å—É–ª—ã" },
    { id:"void_resin",     name:"Void Resin",     base: 5200,  vol:2, vibe:"—Å–º–æ–ª–∞ –ø—É—Å—Ç–æ—Ç—ã" },
    { id:"pink_glass",     name:"Pink Glass",     base: 7800,  vol:2, vibe:"—Ä–æ–∑–æ–≤–æ–µ —Å—Ç–µ–∫–ª–æ" },
    { id:"aurora_crystal", name:"Aurora Crystal", base: 11000, vol:3, vibe:"–∫—Ä–∏—Å—Ç–∞–ª–ª –∞–≤—Ä–æ—Ä—ã" },
  ];

  const CARS = [
    { id:"none",    name:"–ü–µ—à–∫–æ–º",    price:0,      run:0.10, heatMul:1.16 },
    { id:"hatch",   name:"Hatchback", price:12000,  run:0.18, heatMul:1.06 },
    { id:"sedan",   name:"Sedan",     price:24000,  run:0.24, heatMul:1.00 },
    { id:"sport",   name:"Sport",     price:52000,  run:0.34, heatMul:0.92 },
    { id:"armored", name:"Armored",   price:98000,  run:0.44, heatMul:0.86 },
    { id:"ghost",   name:"Ghost GT",  price:165000, run:0.56, heatMul:0.78 },
  ];

  const HOMES = [
    { id:"room",   name:"–ö–æ–º–Ω–∞—Ç–∞",  price:0,      cap: 20 },
    { id:"flat",   name:"–ö–≤–∞—Ä—Ç–∏—Ä–∞", price:18000,  cap: 40 },
    { id:"house",  name:"–î–æ–º",      price:52000,  cap: 75 },
    { id:"villa",  name:"–í–∏–ª–ª–∞",    price:120000, cap:120 },
    { id:"bunker", name:"–ë—É–Ω–∫–µ—Ä",   price:260000, cap:200 },
  ];

  const BIZ = [
    { id:"none",      name:"–ù–µ—Ç –±–∏–∑–Ω–µ—Å–∞", price:0,      income:0 },
    { id:"laundry",   name:"–ü—Ä–∞—á–µ—á–Ω–∞—è",   price:25000,  income:1800 },
    { id:"club",      name:"–ö–ª—É–±",        price:85000,  income:6400 },
    { id:"logistics", name:"–õ–æ–≥–∏—Å—Ç–∏–∫–∞",   price:170000, income:14000 },
    { id:"empire",    name:"–ò–º–ø–µ—Ä–∏—è",     price:420000, income:38000 },
  ];

  const PERKS = [
    { id:"negotiator", name:"–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—â–∏–∫", desc:"–°–Ω–∏–∂–∞–µ—Ç —Ü–µ–Ω—É –ø–æ–∫—É–ø–∫–∏ –Ω–∞ 3%/—É—Ä.", base:9000,  max:6 },
    { id:"salesman",   name:"–ü—Ä–æ–¥–∞–∂–Ω–∏–∫",    desc:"–ü–æ–≤—ã—à–∞–µ—Ç —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ 3%/—É—Ä.", base:9000,  max:6 },
    { id:"ghosting",   name:"–¢–∏—Ö–∏–π —Ä–µ–∂–∏–º",  desc:"–°–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –Ω–∞ 2%/—É—Ä.", base:12000, max:8 },
    { id:"runner",     name:"–ì–æ–Ω—â–∏–∫",       desc:"–ü–æ–≤—ã—à–∞–µ—Ç —à–∞–Ω—Å —É–π—Ç–∏ –Ω–∞ 3%/—É—Ä.", base:14000, max:8 },
    { id:"warehouse",  name:"–°–∫–ª–∞–¥",        desc:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –±–∞–∑—ã –Ω–∞ 5%/—É—Ä.", base:15000, max:10 },
    { id:"network",    name:"–°–µ—Ç—å",         desc:"–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –±–∏–∑–Ω–µ—Å–∞ –Ω–∞ 6%/—É—Ä.", base:18000, max:8 },
  ];

  const SAVE_KEY = "neon_market_sim_v2";
  const ADMIN_PASS = "112";

  const DEFAULT = () => ({
    month: 1,
    cash: 25000,
    heat: 0,       // 0..100
    armor: 0,      // protection level
    profit: 0,
    deals: 0,

    carId: "none",
    homeId: "room",
    bizId: "none",

    perks: Object.fromEntries(PERKS.map(p => [p.id, 0])),
    prices: Object.fromEntries(ITEMS.map(it => [it.id, Math.floor(it.base * rnd(0.85, 1.20))])),
    inv: Object.fromEntries(ITEMS.map(it => [it.id, { qty:0, avg:0 }])),

    log: []
  });

  let S = load() || DEFAULT();

  function load(){
    try{
      const raw = localStorage.getItem(SAVE_KEY);
      if(!raw) return null;
      return JSON.parse(raw);
    }catch{ return null; }
  }
  function save(){
    localStorage.setItem(SAVE_KEY, JSON.stringify(S));
    toast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ");
  }
  function reset(){
    localStorage.removeItem(SAVE_KEY);
    S = DEFAULT();
    log("–ù–æ–≤–∞—è –∏–≥—Ä–∞. –†—ã–Ω–æ–∫ –æ—Ç–∫—Ä—ã—Ç.");
    renderAll();
    toast("–°–±—Ä–æ—Å");
  }

  function log(msg){
    S.log.unshift({ t: Date.now(), msg });
    if(S.log.length > 80) S.log.length = 80;
    renderLog();
  }

  function perk(id){ return Number(S.perks[id] || 0); }
  function car(){ return CARS.find(x=>x.id===S.carId) || CARS[0]; }
  function home(){ return HOMES.find(x=>x.id===S.homeId) || HOMES[0]; }
  function biz(){ return BIZ.find(x=>x.id===S.bizId) || BIZ[0]; }

  function cap(){
    const base = home().cap;
    const mul = 1 + perk("warehouse")*0.05;
    return Math.floor(base * mul);
  }
  function used(){
    let u = 0;
    for(const it of ITEMS) u += (S.inv[it.id].qty||0) * it.vol;
    return u;
  }

  function buyPrice(id){
    const p = S.prices[id];
    const disc = 1 - perk("negotiator")*0.03;
    return Math.max(1, Math.floor(p * disc));
  }
  function sellPrice(id){
    const p = S.prices[id];
    const up = 1 + perk("salesman")*0.03;
    return Math.max(1, Math.floor(p * up));
  }

  function riskSellBase(){
    // base risk from heat + armor/perks reduce + car affects
    const heat = S.heat / 100;
    const base = 0.06 + heat*0.22;               // 6%..28%
    const armorRed = Math.min(0.10, S.armor*0.02);
    const perkRed = Math.min(0.14, perk("ghosting")*0.02);
    const carMul = car().heatMul;
    return clamp((base * carMul) - armorRed - perkRed, 0.02, 0.40);
  }

  function runChance(){
    const base = car().run;
    const perkUp = perk("runner")*0.03;
    const armorUp = Math.min(0.06, S.armor*0.01);
    const heatPenalty = (S.heat/100)*0.10;
    return clamp(base + perkUp + armorUp - heatPenalty, 0.05, 0.92);
  }

  function bribeCost(){
    // purely in-game cost model
    let cargoValue = 0;
    for(const it of ITEMS){
      cargoValue += (S.inv[it.id].qty||0) * S.prices[it.id];
    }
    const heatFactor = 1 + (S.heat/100)*1.3;
    return Math.floor(2400*heatFactor + cargoValue*0.05);
  }

  function coolCost(){
    return Math.floor(1200 + S.heat*140);
  }
  function armorCost(){
    const next = S.armor + 1;
    return Math.floor(9000 * (1.18 ** (next-1)));
  }

  function incomeMonth(){
    const base = biz().income;
    const mul = 1 + perk("network")*0.06;
    return Math.floor(base * mul);
  }

  function invValue(){
    let v = 0;
    for(const it of ITEMS){
      const q = S.inv[it.id].qty||0;
      v += q * sellPrice(it.id);
    }
    return v;
  }

  // ===== UI Navigation =====
  const pages = ["market","inventory","assets","upgrades","log"];
  function showPage(key){
    for(const p of pages){
      const el = $("page-"+p);
      el.style.display = (p===key) ? "" : "none";
    }
    document.querySelectorAll(".navItem").forEach(n=>{
      n.classList.toggle("active", n.getAttribute("data-go") === key);
    });
  }
  document.querySelectorAll(".navItem").forEach(n=>{
    n.addEventListener("click", ()=> showPage(n.getAttribute("data-go")));
  });

  // ===== Rendering =====
  function renderTop(){
    $("uiMonth").textContent = String(S.month);
    $("uiHeat").textContent = `${Math.round(S.heat)}%`;
    $("uiCash").textContent = money(S.cash);

    $("uiRiskTag").textContent = `–†–∏—Å–∫: ${Math.round(riskSellBase()*100)}%`;

    const a = [];
    a.push(`üöó ${car().name}`);
    a.push(`üè† ${home().name}`);
    a.push(`üè≠ ${biz().name}`);
    $("uiAssetsTag").textContent = a.join(" ‚Ä¢ ");

    $("uiCap").textContent = `${used()}/${cap()}`;
    $("uiInvValue").textContent = money(invValue());
    $("uiCoolCost").textContent = money(coolCost());
    $("uiArmorCost").textContent = money(armorCost());

    $("uiRunTag").textContent = `–£–π—Ç–∏: ${Math.round(runChance()*100)}%`;
    $("uiHomeTag").textContent = home().name;
    $("uiBizTag").textContent = biz().name;
    $("uiIncome").textContent = money(incomeMonth());

    // Hint
    const hints = [];
    const r = riskSellBase();
    if(r > 0.22) hints.push("–†–∏—Å–∫ –≤—ã—Å–æ–∫–∏–π: —Å–Ω–∏–∑—å Heat –∏–ª–∏ –∫—É–ø–∏ –∑–∞—â–∏—Ç—É.");
    else hints.push("–†–∏—Å–∫ –Ω–æ—Ä–º: –ø—Ä–æ–¥–∞–≤–∞–π —á–∞—Å—Ç—è–º–∏, —Å–ª–µ–¥–∏ –∑–∞ —Ü–µ–Ω–∞–º–∏.");
    if(runChance() < 0.25) hints.push("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å–ª–∞–±—ã–π: –∞–ø–≥—Ä–µ–π–¥ –º–∞—à–∏–Ω—ã –ø–æ–¥–Ω–∏–º–µ—Ç —à–∞–Ω—Å —É–π—Ç–∏.");
    if(used() > cap()*0.85) hints.push("–°–∫–ª–∞–¥ –ø–æ—á—Ç–∏ –ø–æ–ª–Ω—ã–π: —Ä–∞—Å—à–∏—Ä—å –±–∞–∑—É/–ø–µ—Ä–∫–∏ –∏–ª–∏ –ø—Ä–æ–¥–∞–π –ª–∏—à–Ω–µ–µ.");
    $("uiHint").textContent = hints.join(" ");
  }

  function renderMarket(){
    const body = $("marketRows");
    body.innerHTML = "";

    ITEMS.forEach(it=>{
      const buy = buyPrice(it.id);
      const sell = sellPrice(it.id);
      const spreadPct = Math.round(((sell - buy)/Math.max(1,buy))*100);
      const cls = spreadPct >= 0 ? "pos" : "neg";

      const tr = document.createElement("tr");
      tr.className = "row";
      tr.innerHTML = `
        <td>
          <b style="font-weight:1000">${esc(it.name)}</b>
          <div style="color:var(--muted);font-size:11px;margin-top:3px">${esc(it.vibe)} ‚Ä¢ vol ${it.vol}</div>
        </td>
        <td class="mono">${money(buy)}</td>
        <td class="mono">${money(sell)} <span class="${cls}">(${spreadPct}%)</span></td>
        <td style="width:220px">
          <div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap">
            <button class="btn small" data-buy="${it.id}">–ö—É–ø–∏—Ç—å</button>
            <button class="btn primary small" data-sell="${it.id}">–ü—Ä–æ–¥–∞—Ç—å</button>
          </div>
        </td>
      `;
      body.appendChild(tr);
    });

    body.querySelectorAll("[data-buy]").forEach(b=>{
      b.addEventListener("click", ()=> buyItem(b.getAttribute("data-buy")));
    });
    body.querySelectorAll("[data-sell]").forEach(b=>{
      b.addEventListener("click", ()=> sellOne(b.getAttribute("data-sell")));
    });
  }

  function renderInv(){
    const body = $("invRows");
    body.innerHTML = "";

    let totalDelta = 0;
    ITEMS.forEach(it=>{
      const slot = S.inv[it.id];
      const q = slot.qty||0;
      const avg = slot.avg||0;
      const cur = sellPrice(it.id);
      const est = q * cur;
      const cost = q * avg;
      const delta = q ? (est - cost) : 0;
      totalDelta += delta;

      const cls = delta >= 0 ? "pos" : "neg";
      const tr = document.createElement("tr");
      tr.className = "row";
      tr.innerHTML = `
        <td>${esc(it.name)}</td>
        <td class="mono">${q}</td>
        <td class="mono">${avg ? money(avg) : "‚Äî"}</td>
        <td class="mono">${q ? money(est) : "‚Äî"}</td>
        <td class="mono ${q ? cls : ""}">${q ? money(delta) : "‚Äî"}</td>
      `;
      body.appendChild(tr);
    });

    $("uiProfit").textContent = money(S.profit);
  }

  function renderAssets(){
    // Cars
    const carBody = $("carRows");
    carBody.innerHTML = "";
    CARS.forEach(c=>{
      const owned = (S.carId === c.id);
      const tr = document.createElement("tr");
      tr.className = "row";
      tr.innerHTML = `
        <td>${esc(c.name)} ${owned ? `<span class="tag">–≤—ã–±—Ä–∞–Ω–æ</span>` : ""}</td>
        <td class="mono">${money(c.price)}</td>
        <td class="mono">${Math.round(c.run*100)}%</td>
        <td style="width:160px;text-align:right">
          ${owned ? "" : `<button class="btn small" data-car="${c.id}">${c.price===0?"–í—ã–±—Ä–∞—Ç—å":"–ö—É–ø–∏—Ç—å"}</button>`}
        </td>
      `;
      carBody.appendChild(tr);
    });
    carBody.querySelectorAll("[data-car]").forEach(b=>{
      b.addEventListener("click", ()=> buyCar(b.getAttribute("data-car")));
    });

    // Homes
    const homeBody = $("homeRows");
    homeBody.innerHTML = "";
    HOMES.forEach(h=>{
      const owned = (S.homeId === h.id);
      const tr = document.createElement("tr");
      tr.className = "row";
      tr.innerHTML = `
        <td>${esc(h.name)} ${owned ? `<span class="tag">–≤—ã–±—Ä–∞–Ω–æ</span>` : ""}</td>
        <td class="mono">${money(h.price)}</td>
        <td class="mono">${h.cap}</td>
        <td style="width:160px;text-align:right">
          ${owned ? "" : `<button class="btn small" data-home="${h.id}">${h.price===0?"–í—ã–±—Ä–∞—Ç—å":"–ö—É–ø–∏—Ç—å"}</button>`}
        </td>
      `;
      homeBody.appendChild(tr);
    });
    homeBody.querySelectorAll("[data-home]").forEach(b=>{
      b.addEventListener("click", ()=> buyHome(b.getAttribute("data-home")));
    });

    // Biz
    const bizBody = $("bizRows");
    bizBody.innerHTML = "";
    BIZ.forEach(z=>{
      const owned = (S.bizId === z.id);
      const tr = document.createElement("tr");
      tr.className = "row";
      tr.innerHTML = `
        <td>${esc(z.name)} ${owned ? `<span class="tag">–≤—ã–±—Ä–∞–Ω–æ</span>` : ""}</td>
        <td class="mono">${money(z.price)}</td>
        <td class="mono">${money(z.income)}</td>
        <td style="width:160px;text-align:right">
          ${owned ? "" : `<button class="btn small" data-biz="${z.id}">${z.price===0?"–í—ã–±—Ä–∞—Ç—å":"–ö—É–ø–∏—Ç—å"}</button>`}
        </td>
      `;
      bizBody.appendChild(tr);
    });
    bizBody.querySelectorAll("[data-biz]").forEach(b=>{
      b.addEventListener("click", ()=> buyBiz(b.getAttribute("data-biz")));
    });
  }

  function perkCost(p){
    const lvl = perk(p.id);
    return Math.floor(p.base * (1.22 ** lvl));
  }

  function renderUpgrades(){
    const grid = $("perkCards");
    grid.innerHTML = "";
    PERKS.forEach(p=>{
      const lvl = perk(p.id);
      const cost = perkCost(p);
      const maxed = lvl >= p.max;

      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <div class="cardIn">
          <div class="cardTitle">
            <b>${esc(p.name)} <span class="tag">—É—Ä. ${lvl}/${p.max}</span></b>
            <span class="tag">${maxed ? "MAX" : money(cost)}</span>
          </div>
          <div class="help">${esc(p.desc)}</div>
          <div class="actions" style="margin-top:12px">
            <button class="btn primary full" ${maxed ? "disabled" : ""} data-perk="${p.id}">
              ${maxed ? "–ú–∞–∫—Å–∏–º—É–º" : "–£–ª—É—á—à–∏—Ç—å"}
            </button>
          </div>
        </div>
      `;
      grid.appendChild(div);
    });

    grid.querySelectorAll("[data-perk]").forEach(b=>{
      b.addEventListener("click", ()=> buyPerk(b.getAttribute("data-perk")));
    });
  }

  function renderLog(){
    const box = $("logBox");
    if(!box) return;
    box.innerHTML = "";
    const list = S.log || [];
    if(!list.length){
      const el = document.createElement("div");
      el.className = "tile";
      el.innerHTML = `<b>–ü—É—Å—Ç–æ</b><p>–°–æ–±—ã—Ç–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Å–¥–µ–ª–æ–∫ –∏ –º–µ—Å—è—Ü–µ–≤.</p>`;
      box.appendChild(el);
      return;
    }
    list.forEach(e=>{
      const el = document.createElement("div");
      el.className = "tile";
      el.innerHTML = `<b class="mono">${new Date(e.t).toLocaleString()}</b><p>${esc(e.msg)}</p>`;
      box.appendChild(el);
    });
  }

  function renderAll(){
    renderTop();
    renderMarket();
    renderInv();
    renderAssets();
    renderUpgrades();
    renderLog();
  }

  // ===== Core actions =====
  function buyItem(id){
    const it = ITEMS.find(x=>x.id===id);
    const price = buyPrice(id);

    if(used() + it.vol > cap()){
      toast("–°–∫–ª–∞–¥ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω");
      return;
    }
    if(S.cash < price){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }

    S.cash -= price;
    S.deals += 1;

    const slot = S.inv[id];
    const oldQ = slot.qty;
    const newQ = oldQ + 1;
    slot.avg = oldQ === 0 ? price : Math.floor((slot.avg*oldQ + price)/newQ);
    slot.qty = newQ;

    S.heat = clamp(S.heat + rnd(0.2, 0.9) * car().heatMul, 0, 100);

    log(`–ü–æ–∫—É–ø–∫–∞: ${it.name} –∑–∞ ${money(price)} (avg ${money(slot.avg)})`);
    renderAll();
  }

  // Risk event pending
  let pending = null;

  function sellOne(id){
    const slot = S.inv[id];
    if(!slot || slot.qty <= 0){
      toast("–ù–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ");
      return;
    }

    const r = riskSellBase();
    if(chance(r)){
      pending = { type:"sell", itemId:id, qty:1 };
      openEvent("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ", `–°—Ä–∞–±–æ—Ç–∞–ª–æ —Ä–∏—Å–∫-—Å–æ–±—ã—Ç–∏–µ (—Ä–∏—Å–∫ –±—ã–ª ${Math.round(r*100)}%). –í—ã–±–∏—Ä–∞–π –¥–µ–π—Å—Ç–≤–∏–µ.`);
      return;
    }

    doSell(id, 1);
    renderAll();
  }

  function doSell(id, qty){
    const it = ITEMS.find(x=>x.id===id);
    const slot = S.inv[id];
    qty = Math.min(qty, slot.qty);
    if(qty <= 0) return 0;

    const unit = sellPrice(id);
    const income = unit * qty;
    const cost = slot.avg * qty;
    const delta = income - cost;

    S.cash += income;
    S.profit += delta;
    S.deals += 1;

    slot.qty -= qty;
    if(slot.qty === 0) slot.avg = 0;

    S.heat = clamp(S.heat + rnd(0.8, 2.2) * car().heatMul, 0, 100);

    log(`–ü—Ä–æ–¥–∞–∂–∞: ${it.name} x${qty} –∑–∞ ${money(income)} (Œî ${money(delta)})`);
    return income;
  }

  function sellAll(){
    // Sells all inventory, but if event triggers, pauses on first triggered sell
    for(const it of ITEMS){
      const q = S.inv[it.id].qty || 0;
      if(q <= 0) continue;

      // try sell in one batch
      const r = riskSellBase() + (q >= 6 ? 0.03 : 0);
      if(chance(r)){
        pending = { type:"sell", itemId:it.id, qty:q };
        openEvent("–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ", `–°—Ä–∞–±–æ—Ç–∞–ª–æ —Ä–∏—Å–∫-—Å–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –ø–∞—Ä—Ç–∏–∏ (—Ä–∏—Å–∫ –±—ã–ª ${Math.round(r*100)}%).`);
        return;
      }
      doSell(it.id, q);
    }
    toast("–ü—Ä–æ–¥–∞–Ω–æ");
    renderAll();
  }

  function buyCar(id){
    const c = CARS.find(x=>x.id===id);
    if(!c) return;
    if(S.carId === id) return;
    if(c.price > 0 && S.cash < c.price){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }
    if(c.price > 0) S.cash -= c.price;
    S.carId = id;
    log(`–ú–∞—à–∏–Ω–∞: ${c.name} (${c.price ? money(c.price) : "‚Äî"})`);
    renderAll();
  }

  function buyHome(id){
    const h = HOMES.find(x=>x.id===id);
    if(!h) return;
    if(S.homeId === id) return;
    if(h.price > 0 && S.cash < h.price){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }
    if(h.price > 0) S.cash -= h.price;
    S.homeId = id;
    log(`–ë–∞–∑–∞: ${h.name} (${h.price ? money(h.price) : "‚Äî"})`);
    renderAll();
  }

  function buyBiz(id){
    const z = BIZ.find(x=>x.id===id);
    if(!z) return;
    if(S.bizId === id) return;
    if(z.price > 0 && S.cash < z.price){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }
    if(z.price > 0) S.cash -= z.price;
    S.bizId = id;
    log(`–ë–∏–∑–Ω–µ—Å: ${z.name} (${z.price ? money(z.price) : "‚Äî"})`);
    renderAll();
  }

  function buyPerk(id){
    const p = PERKS.find(x=>x.id===id);
    if(!p) return;
    const lvl = perk(id);
    if(lvl >= p.max){
      toast("MAX");
      return;
    }
    const cost = perkCost(p);
    if(S.cash < cost){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }
    S.cash -= cost;
    S.perks[id] = lvl + 1;
    log(`–ü–µ—Ä–∫: ${p.name} —É—Ä. ${S.perks[id]} (${money(cost)})`);
    renderAll();
  }

  function nextMonth(){
    // income
    const inc = incomeMonth();
    if(inc > 0){
      S.cash += inc;
      log(`–î–æ—Ö–æ–¥ –±–∏–∑–Ω–µ—Å–∞: +${money(inc)} (${biz().name})`);
    }

    // heat decay
    const before = S.heat;
    S.heat = clamp(S.heat - (8 + perk("ghosting")*2), 0, 100);
    if(before !== S.heat) log(`Heat: ${Math.round(before)}% ‚Üí ${Math.round(S.heat)}%`);

    // price changes
    for(const it of ITEMS){
      const base = it.base;
      const vol = 0.22 + it.vol*0.05;
      const wave = rnd(-vol, vol);
      const momentum = rnd(-0.08, 0.08);
      const p = S.prices[it.id];
      const target = base * (1 + wave);
      const next = p * (1 + momentum) * 0.55 + target * 0.45;
      S.prices[it.id] = Math.max(120, Math.floor(next));
    }

    S.month += 1;
    log(`–ú–µ—Å—è—Ü #${S.month}: —Ü–µ–Ω—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å`);
    renderAll();
    toast("–ù–æ–≤—ã–π –º–µ—Å—è—Ü");
  }

  // ===== Event modal =====
  const eventBack = $("eventBack");
  const eventTitle = $("eventTitle");
  const eventText = $("eventText");
  const eventRunChance = $("eventRunChance");
  const eventBribeCost = $("eventBribeCost");

  $("eventClose").addEventListener("click", closeEvent);
  eventBack.addEventListener("click", (e)=>{ if(e.target === eventBack) closeEvent(); });

  function openEvent(title, text){
    eventTitle.textContent = title;
    eventText.textContent = text;
    eventRunChance.textContent = `${Math.round(runChance()*100)}%`;
    eventBribeCost.textContent = money(bribeCost());
    eventBack.classList.add("show");
  }
  function closeEvent(){
    eventBack.classList.remove("show");
    pending = null;
  }

  $("actDump").addEventListener("click", ()=>{
    if(!pending) return closeEvent();
    // lose all inventory (game effect)
    let lost = invValue();
    for(const it of ITEMS){
      S.inv[it.id].qty = 0;
      S.inv[it.id].avg = 0;
    }
    S.heat = clamp(S.heat + 6, 0, 100);
    log(`–ì—Ä—É–∑ –≤—ã–±—Ä–æ—à–µ–Ω. –ü–æ—Ç–µ—Ä—è –æ—Ü–µ–Ω–æ—á–Ω–æ: ${money(lost)}`);
    closeEvent();
    renderAll();
  });

  $("actRun").addEventListener("click", ()=>{
    if(!pending) return closeEvent();
    const p = runChance();
    if(chance(p)){
      const add = 6 + randi(0,6);
      S.heat = clamp(S.heat + add, 0, 100);
      log(`–£–π—Ç–∏ —É–¥–∞–ª–æ—Å—å (—à–∞–Ω—Å ${Math.round(p*100)}%). Heat +${add}%`);
      closeEvent();
      renderAll();
      return;
    }

    // fail: confiscate pending qty + fine
    const fine = Math.floor(bribeCost()*0.35 + 2500);
    if(pending.type === "sell"){
      const slot = S.inv[pending.itemId];
      const lost = Math.min(pending.qty, slot.qty);
      slot.qty -= lost;
      if(slot.qty === 0) slot.avg = 0;
      log(`–ù–µ —É—à—ë–ª. –ö–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏–∏ (${lost} —à—Ç). –®—Ç—Ä–∞—Ñ: ${money(fine)}`);
    } else {
      log(`–ù–µ —É—à—ë–ª. –®—Ç—Ä–∞—Ñ: ${money(fine)}`);
    }
    S.cash = Math.max(0, S.cash - fine);
    S.heat = clamp(S.heat + 18, 0, 100);

    closeEvent();
    renderAll();
  });

  $("actBribe").addEventListener("click", ()=>{
    if(!pending) return closeEvent();
    const cost = bribeCost();
    if(S.cash < cost){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
      return;
    }

    // fictional success chance
    const base = 0.62 + perk("negotiator")*0.03 - (S.heat/100)*0.25;
    const ok = chance(clamp(base, 0.20, 0.92));
    S.cash -= cost;

    if(ok){
      S.heat = clamp(S.heat + 4, 0, 100);
      log(`‚Äú–í–∑—è—Ç–∫–∞‚Äù —Å—Ä–∞–±–æ—Ç–∞–ª–∞: -${money(cost)}. –°–¥–µ–ª–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∞.`);
      if(pending.type === "sell") doSell(pending.itemId, pending.qty);
    } else {
      const fine = Math.floor(cost*0.65 + 3500);
      S.cash = Math.max(0, S.cash - fine);
      S.heat = clamp(S.heat + 20, 0, 100);

      if(pending.type === "sell"){
        const slot = S.inv[pending.itemId];
        const lost = Math.min(pending.qty, slot.qty);
        slot.qty -= lost;
        if(slot.qty === 0) slot.avg = 0;
        log(`‚Äú–í–∑—è—Ç–∫–∞‚Äù –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å. –ü–æ—Ç–µ—Ä–∏: ${money(cost)} + —à—Ç—Ä–∞—Ñ ${money(fine)} + –∫–æ–Ω—Ñ–∏—Å–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏–∏ (${lost} —à—Ç).`);
      } else {
        log(`‚Äú–í–∑—è—Ç–∫–∞‚Äù –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å. –ü–æ—Ç–µ—Ä–∏: ${money(cost)} + —à—Ç—Ä–∞—Ñ ${money(fine)}.`);
      }
    }
    closeEvent();
    renderAll();
  });

  // ===== Buttons =====
  $("fabMonth").addEventListener("click", nextMonth);
  $("btnSellAll").addEventListener("click", sellAll);

  $("btnCool").addEventListener("click", ()=>{
    const cost = coolCost();
    if(S.cash < cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
    S.cash -= cost;
    const before = S.heat;
    S.heat = clamp(S.heat - (35 + perk("ghosting")*3), 0, 100);
    log(`–°–Ω–∏–∂–µ–Ω–∏–µ Heat: ${Math.round(before)}% ‚Üí ${Math.round(S.heat)}% (${money(cost)})`);
    renderAll();
  });

  $("btnArmor").addEventListener("click", ()=>{
    const cost = armorCost();
    if(S.cash < cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
    S.cash -= cost;
    S.armor += 1;
    log(`–ó–∞—â–∏—Ç–∞: —É—Ä–æ–≤–µ–Ω—å ${S.armor} (${money(cost)})`);
    renderAll();
  });

  $("btnSave").addEventListener("click", save);
  $("btnReset").addEventListener("click", ()=>{
    if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) reset();
  });

  $("btnClearLog").addEventListener("click", ()=>{
    S.log = [];
    renderLog();
    toast("–û—á–∏—â–µ–Ω–æ");
  });

  // ===== Admin Panel =====
  const adminBack = $("adminBack");
  const adminBody = $("adminBody");
  $("adminClose").addEventListener("click", ()=> adminBack.classList.remove("show"));
  adminBack.addEventListener("click", (e)=>{ if(e.target === adminBack) adminBack.classList.remove("show"); });

  $("btnAdmin").addEventListener("click", ()=>{
    openAdminGate();
  });

  function openAdminGate(){
    adminBody.innerHTML = `
      <div class="help">–í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</div>
      <div class="hr"></div>
      <div class="mGrid">
        <div class="field">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input id="admPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢" />
        </div>
        <div class="field">
          <label>–î–µ–π—Å—Ç–≤–∏–µ</label>
          <button class="btn primary full" id="admEnter">–í–æ–π—Ç–∏</button>
        </div>
      </div>
      <div style="height:8px"></div>
      <div class="help">–ü–∞—Ä–æ–ª—å –≤ –∫–æ–¥–µ: <b>112</b>. –ú–æ–∂–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π <code>ADMIN_PASS</code>.</div>
    `;
    adminBack.classList.add("show");
    $("admEnter").addEventListener("click", ()=>{
      const p = $("admPass").value || "";
      if(p !== ADMIN_PASS){
        toast("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
        return;
      }
      openAdminPanel();
    });
  }

  function openAdminPanel(){
    // Build JSON editor + forms for key data
    const priceInputs = ITEMS.map(it => `
      <div class="field">
        <label>${esc(it.name)} price</label>
        <input type="number" id="adm_price_${it.id}" value="${Number(S.prices[it.id]||0)}" min="1" step="1"/>
      </div>
    `).join("");

    const invInputs = ITEMS.map(it => {
      const slot = S.inv[it.id] || {qty:0, avg:0};
      return `
        <div class="card" style="margin:0; border-radius:20px;">
          <div class="cardIn">
            <div class="cardTitle"><b>${esc(it.name)}</b><span class="tag">vol ${it.vol}</span></div>
            <div class="mGrid">
              <div class="field">
                <label>qty</label>
                <input type="number" id="adm_qty_${it.id}" value="${Number(slot.qty||0)}" min="0" step="1"/>
              </div>
              <div class="field">
                <label>avg</label>
                <input type="number" id="adm_avg_${it.id}" value="${Number(slot.avg||0)}" min="0" step="1"/>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join("");

    const perkInputs = PERKS.map(p => `
      <div class="field">
        <label>${esc(p.name)} (0..${p.max})</label>
        <input type="number" id="adm_perk_${p.id}" value="${Number(S.perks[p.id]||0)}" min="0" max="${p.max}" step="1"/>
      </div>
    `).join("");

    const carOptions = CARS.map(c => `<option value="${c.id}" ${S.carId===c.id?"selected":""}>${esc(c.name)} (${money(c.price)})</option>`).join("");
    const homeOptions = HOMES.map(h => `<option value="${h.id}" ${S.homeId===h.id?"selected":""}>${esc(h.name)} (${money(h.price)})</option>`).join("");
    const bizOptions = BIZ.map(z => `<option value="${z.id}" ${S.bizId===z.id?"selected":""}>${esc(z.name)} (${money(z.price)})</option>`).join("");

    adminBody.innerHTML = `
      <div class="help"><b>–ê–¥–º–∏–Ω–∫–∞:</b> –º–µ–Ω—è–π —á—Ç–æ —É–≥–æ–¥–Ω–æ, –ø–æ—Ç–æ–º –∂–º–∏ ‚Äú–ü—Ä–∏–º–µ–Ω–∏—Ç—å‚Äù.</div>

      <div class="hr"></div>

      <div class="card" style="margin:0; border-radius:20px;">
        <div class="cardIn">
          <div class="cardTitle"><b>–û—Å–Ω–æ–≤–Ω–æ–µ</b><span class="tag">state</span></div>
          <div class="mGrid">
            <div class="field"><label>Month</label><input type="number" id="adm_month" value="${Number(S.month||1)}" min="1" step="1"/></div>
            <div class="field"><label>Cash</label><input type="number" id="adm_cash" value="${Number(S.cash||0)}" step="1"/></div>
            <div class="field"><label>Heat (0..100)</label><input type="number" id="adm_heat" value="${Number(S.heat||0)}" min="0" max="100" step="1"/></div>
            <div class="field"><label>Armor</label><input type="number" id="adm_armor" value="${Number(S.armor||0)}" min="0" step="1"/></div>
            <div class="field"><label>Profit</label><input type="number" id="adm_profit" value="${Number(S.profit||0)}" step="1"/></div>
            <div class="field"><label>Deals</label><input type="number" id="adm_deals" value="${Number(S.deals||0)}" min="0" step="1"/></div>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="margin:0; border-radius:20px;">
        <div class="cardIn">
          <div class="cardTitle"><b>–ê–∫—Ç–∏–≤—ã</b><span class="tag">select</span></div>
          <div class="mGrid">
            <div class="field"><label>Car</label><select id="adm_car">${carOptions}</select></div>
            <div class="field"><label>Home</label><select id="adm_home">${homeOptions}</select></div>
            <div class="field"><label>Business</label><select id="adm_biz">${bizOptions}</select></div>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="margin:0; border-radius:20px;">
        <div class="cardIn">
          <div class="cardTitle"><b>–¶–µ–Ω—ã</b><span class="tag">market</span></div>
          <div class="mGrid">${priceInputs}</div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="margin:0; border-radius:20px;">
        <div class="cardIn">
          <div class="cardTitle"><b>–ü–µ—Ä–∫–∏</b><span class="tag">upgrades</span></div>
          <div class="mGrid">${perkInputs}</div>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card" style="margin:0; border-radius:20px;">
        <div class="cardIn">
          <div class="cardTitle"><b>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</b><span class="tag">inventory</span></div>
          <div style="display:grid; gap:12px">${invInputs}</div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="mGrid">
        <div class="field">
          <label>JSON (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Ü–µ–ª–∏–∫–æ–º state</label>
          <textarea id="adm_json">${esc(JSON.stringify(S, null, 2))}</textarea>
        </div>
        <div class="field">
          <label>–î–µ–π—Å—Ç–≤–∏—è</label>
          <button class="btn primary full" id="adm_apply">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          <div style="height:10px"></div>
          <button class="btn full" id="adm_reload">‚Ü∫ –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ state</button>
          <div style="height:10px"></div>
          <button class="btn danger full" id="adm_wipe">üß® –°—Ç–µ—Ä–µ—Ç—å save –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    `;

    $("adm_apply").addEventListener("click", ()=>{
      applyAdmin();
    });

    $("adm_reload").addEventListener("click", ()=>{
      openAdminPanel();
    });

    $("adm_wipe").addEventListener("click", ()=>{
      if(confirm("–¢–æ—á–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–±—Ä–æ—Å–∏—Ç—å?")){
        reset();
        adminBack.classList.remove("show");
      }
    });
  }

  function applyAdmin(){
    // Priority: if JSON parse ok, use it; otherwise use form fields
    const jsonRaw = ($("adm_json")?.value || "").trim();
    let parsed = null;
    if(jsonRaw){
      try{ parsed = JSON.parse(jsonRaw); }catch{ parsed = null; }
    }

    if(parsed && typeof parsed === "object"){
      S = parsed;
      // minimal sanity clamps
      S.month = Math.max(1, Number(S.month||1));
      S.cash = Number(S.cash||0);
      S.heat = clamp(Number(S.heat||0), 0, 100);
      S.armor = Math.max(0, Number(S.armor||0));
      S.profit = Number(S.profit||0);
      S.deals = Math.max(0, Number(S.deals||0));
      S.log = Array.isArray(S.log) ? S.log : [];
      toast("–ü—Ä–∏–º–µ–Ω–µ–Ω–æ (JSON)");
      save();
      renderAll();
      return;
    }

    // forms
    S.month = Math.max(1, Number($("adm_month").value||1));
    S.cash = Number($("adm_cash").value||0);
    S.heat = clamp(Number($("adm_heat").value||0), 0, 100);
    S.armor = Math.max(0, Number($("adm_armor").value||0));
    S.profit = Number($("adm_profit").value||0);
    S.deals = Math.max(0, Number($("adm_deals").value||0));

    S.carId = $("adm_car").value;
    S.homeId = $("adm_home").value;
    S.bizId = $("adm_biz").value;

    // prices
    ITEMS.forEach(it=>{
      const v = Number($("adm_price_"+it.id).value||S.prices[it.id]||1);
      S.prices[it.id] = Math.max(1, Math.floor(v));
    });

    // perks
    PERKS.forEach(p=>{
      const v = Number($("adm_perk_"+p.id).value||0);
      S.perks[p.id] = clamp(Math.floor(v), 0, p.max);
    });

    // inv
    ITEMS.forEach(it=>{
      const q = Math.max(0, Math.floor(Number($("adm_qty_"+it.id).value||0)));
      const a = Math.max(0, Math.floor(Number($("adm_avg_"+it.id).value||0)));
      S.inv[it.id] = { qty:q, avg:a };
    });

    toast("–ü—Ä–∏–º–µ–Ω–µ–Ω–æ");
    log("–ê–¥–º–∏–Ω–∫–∞: state –∏–∑–º–µ–Ω—ë–Ω.");
    save();
    renderAll();
  }

  // ===== Initial log =====
  if(!S.log || !S.log.length){
    S.log = [];
    log("–°—Ç–∞—Ä—Ç: –ø–æ–∫—É–ø–∞–π –Ω–∞ —Ä—ã–Ω–∫–µ, –ø—Ä–æ–∂–∏–≤–∞–π –º–µ—Å—è—Ü (Ôºã), –ø—Ä–æ–¥–∞–≤–∞–π —Å —Ä–∏—Å–∫–æ–º-—Å–æ–±—ã—Ç–∏–µ–º.");
  }

  // ===== Buttons (save/reset etc) =====
  $("btnSave").addEventListener("click", save);
  $("btnReset").addEventListener("click", ()=>{ if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) reset(); });

  // ===== Quick actions =====
  $("btnSellAll").addEventListener("click", sellAll);
  $("btnCool").addEventListener("click", ()=>{
    const cost = coolCost();
    if(S.cash < cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
    const before = S.heat;
    S.cash -= cost;
    S.heat = clamp(S.heat - (35 + perk("ghosting")*3), 0, 100);
    log(`–°–Ω–∏–∂–µ–Ω–∏–µ Heat: ${Math.round(before)}% ‚Üí ${Math.round(S.heat)}% (${money(cost)})`);
    renderAll();
  });
  $("btnArmor").addEventListener("click", ()=>{
    const cost = armorCost();
    if(S.cash < cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç cash");
    S.cash -= cost;
    S.armor += 1;
    log(`–ó–∞—â–∏—Ç–∞: —É—Ä–æ–≤–µ–Ω—å ${S.armor} (${money(cost)})`);
    renderAll();
  });

  // ===== Month FAB =====
  $("fabMonth").addEventListener("click", nextMonth);

  // ===== Log clear =====
  $("btnClearLog").addEventListener("click", ()=>{
    S.log = [];
    renderLog();
    toast("–û—á–∏—â–µ–Ω–æ");
  });

  // Autosave
  setInterval(()=> {
    try{ localStorage.setItem(SAVE_KEY, JSON.stringify(S)); }catch{}
  }, 5000);

  // Initial render
  renderAll();
  showPage("market");

})();
</script>
</body>
  </html>
