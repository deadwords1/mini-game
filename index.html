<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RAPSTAR Simulator ‚Äî Mini</title>
  <style>
    :root{
      --bg0:#07080c;
      --bg1:#0b0d14;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.60);
      --good:#64f0b0;
      --warn:#ffd36a;
      --bad:#ff6a8a;
      --accent:#a78bfa; /* —Ñ–∏–æ–ª–µ—Ç */
      --accent2:#22d3ee; /* —Ü–∏–∞–Ω */
      --shadow: 0 12px 40px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(167,139,250,.20), transparent 60%),
        radial-gradient(700px 500px at 85% 15%, rgba(34,211,238,.18), transparent 60%),
        radial-gradient(900px 700px at 50% 110%, rgba(255,255,255,.06), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 90px;
    }
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      position:sticky; top:0; z-index:10;
      padding:14px 0 10px;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(7,8,12,.88), rgba(7,8,12,.0));
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background:
        radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.25), transparent 55%),
        linear-gradient(135deg, rgba(167,139,250,.95), rgba(34,211,238,.90));
      box-shadow: 0 10px 30px rgba(34,211,238,.12);
      position:relative;
      overflow:hidden;
    }
    .logo:after{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(60% 60% at 20% 20%, rgba(255,255,255,.35), transparent 55%);
      transform: rotate(18deg);
    }
    .title{
      line-height:1.05;
    }
    .title b{display:block; font-size:14px; letter-spacing:.8px; text-transform:uppercase; opacity:.9}
    .title span{display:block; font-size:12px; color:var(--muted); margin-top:3px}
    .pillbar{
      display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:flex-end;
    }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
      border-radius:999px;
      box-shadow: 0 8px 20px rgba(0,0,0,.20);
      user-select:none;
      white-space:nowrap;
      font-size:12px;
    }
    .pill .k{color:var(--muted)}
    .pill .v{font-weight:700}
    .grid{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:14px;
      margin-top:10px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .wrap{padding-bottom:110px}
    }
    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h3{
      margin:0;
      padding:14px 14px 10px;
      font-size:13px;
      letter-spacing:.6px;
      text-transform:uppercase;
      color:rgba(255,255,255,.84);
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.10);
    }
    .sub{
      font-size:12px; color:var(--muted); text-transform:none; letter-spacing:0;
    }
    .body{padding:12px 14px 14px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      appearance:none; border:none;
      cursor:pointer;
      padding:12px 12px;
      border-radius:14px;
      background: rgba(255,255,255,.07);
      color:var(--text);
      border:1px solid rgba(255,255,255,.10);
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
      font-weight:700;
      font-size:13px;
      display:inline-flex; align-items:center; gap:10px;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.16)}
    .btn:active{transform: translateY(1px) scale(.995)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(167,139,250,.95), rgba(34,211,238,.75));
      border-color: rgba(255,255,255,.16);
    }
    .btn.danger{background: rgba(255,106,138,.14); border-color: rgba(255,106,138,.22)}
    .btn.good{background: rgba(100,240,176,.12); border-color: rgba(100,240,176,.22)}
    .btn.small{padding:9px 10px; border-radius:12px; font-size:12px}
    .btn:disabled{opacity:.45; cursor:not-allowed}
    .tag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      font-size:12px;
      color: rgba(255,255,255,.80);
    }
    .statgrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    .stat{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
    }
    .stat .k{font-size:12px; color:var(--muted)}
    .stat .v{margin-top:6px; font-size:18px; font-weight:900}
    .meter{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      margin-top:10px;
    }
    .meter > i{
      display:block; height:100%;
      width:50%;
      background: linear-gradient(90deg, rgba(167,139,250,.95), rgba(34,211,238,.85));
      border-radius:999px;
    }
    .list{
      display:flex; flex-direction:column; gap:10px;
    }
    .item{
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.05);
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
    }
    .item b{display:block; font-size:13px}
    .item .meta{font-size:12px; color:var(--muted); margin-top:4px; line-height:1.25}
    .item .right{display:flex; flex-direction:column; gap:8px; align-items:flex-end; min-width:120px}
    .muted{color:var(--muted)}
    .hr{height:1px; background:rgba(255,255,255,.08); margin:12px 0}
    .toast{
      position: fixed;
      left:50%;
      bottom: 92px;
      transform: translateX(-50%);
      width: min(720px, calc(100% - 24px));
      z-index: 999;
      display:flex;
      flex-direction:column;
      gap:8px;
      pointer-events:none;
    }
    .toast .t{
      pointer-events:none;
      padding:12px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,12,18,.82);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 40px rgba(0,0,0,.55);
      font-size:13px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      animation: pop .18s ease;
    }
    @keyframes pop{from{transform: translateY(6px); opacity:0}to{transform: translateY(0); opacity:1}}
    .t .left{display:flex; gap:10px; align-items:flex-start}
    .dot{
      width:10px; height:10px; border-radius:99px; margin-top:4px;
      background: var(--accent2);
      box-shadow: 0 0 0 6px rgba(34,211,238,.12);
    }
    .dot.good{background: var(--good); box-shadow:0 0 0 6px rgba(100,240,176,.12)}
    .dot.warn{background: var(--warn); box-shadow:0 0 0 6px rgba(255,211,106,.12)}
    .dot.bad{background: var(--bad); box-shadow:0 0 0 6px rgba(255,106,138,.12)}
    .t .msg b{display:block; margin-bottom:2px}
    .t .msg span{color:var(--muted)}
    /* bottom nav */
    .nav{
      position:fixed; left:0; right:0; bottom:0;
      z-index:20;
      padding:10px 12px 14px;
      background: linear-gradient(180deg, rgba(7,8,12,0), rgba(7,8,12,.92) 30%, rgba(7,8,12,.98));
      backdrop-filter: blur(10px);
    }
    .nav .bar{
      max-width:1100px; margin:0 auto;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 22px;
      padding:8px;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:8px;
      box-shadow: var(--shadow);
    }
    .tab{
      padding:10px 10px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.86);
      font-weight:800;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      transition: background .18s ease, transform .08s ease, border-color .18s ease;
      text-align:center;
    }
    .tab:hover{background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.16)}
    .tab:active{transform: translateY(1px)}
    .tab.active{
      background: linear-gradient(135deg, rgba(167,139,250,.55), rgba(34,211,238,.35));
      border-color: rgba(255,255,255,.18);
    }
    /* sections */
    .section{display:none}
    .section.active{display:block}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: var(--text);
      outline:none;
    }
    label{font-size:12px; color:var(--muted); display:block; margin:10px 0 6px}
    .two{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    @media (max-width: 520px){ .two{grid-template-columns:1fr} }
    .mono{font-variant-numeric: tabular-nums}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo"></div>
        <div class="title">
          <b>RAPSTAR Simulator</b>
          <span class="muted">–ø–æ–¥–Ω–∏–º–∞–π—Å—è —Å –Ω—É–ª—è: —Ç—Ä–µ–∫–∏ ‚Ä¢ —Å–æ—Ü—Å–µ—Ç–∏ ‚Ä¢ –∫–æ–Ω—Ü–µ—Ä—Ç—ã ‚Ä¢ —Ñ–∏—Ç—ã ‚Ä¢ –ø—Ä–æ–∫–∞—á–∫–∏</span>
        </div>
      </div>

      <div class="pillbar">
        <div class="pill"><span class="k">–î–µ–Ω—å</span><span class="v mono" id="day">1</span></div>
        <div class="pill"><span class="k">üí∞</span><span class="v mono" id="money">0</span></div>
        <div class="pill"><span class="k">üë•</span><span class="v mono" id="fans">0</span></div>
        <div class="pill"><span class="k">‚≠ê</span><span class="v mono" id="rep">0</span></div>
      </div>
    </div>

    <div class="grid">
      <!-- Left / Profile -->
      <div class="card">
        <h3>
          –ü—Ä–æ—Ñ–∏–ª—å
          <span class="sub" id="rank">–ù–æ–≤–∏—á–æ–∫</span>
        </h3>
        <div class="body">
          <div class="statgrid">
            <div class="stat">
              <div class="k">–≠–Ω–µ—Ä–≥–∏—è</div>
              <div class="v mono" id="energyText">100/100</div>
              <div class="meter"><i id="energyBar" style="width:100%"></i></div>
            </div>
            <div class="stat">
              <div class="k">–®—É–º –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</div>
              <div class="v mono" id="hypeText">0</div>
              <div class="meter"><i id="hypeBar" style="width:0%"></i></div>
            </div>
            <div class="stat">
              <div class="k">–ù–∞–≤—ã–∫</div>
              <div class="v mono" id="skill">1</div>
              <div class="muted" style="font-size:12px;margin-top:6px">–≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–∫–æ–≤</div>
            </div>
            <div class="stat">
              <div class="k">–°—Ç—É–¥–∏–π–∫–∞</div>
              <div class="v mono" id="studio">–¢–µ–ª–µ—Ñ–æ–Ω</div>
              <div class="muted" style="font-size:12px;margin-top:6px">–∞–ø–≥—Ä–µ–π–¥ –≤ –º–∞–≥–∞–∑–∏–Ω–µ</div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="row">
            <button class="btn good" id="restBtn">üò¥ –û—Ç–¥—ã—Ö (+—ç–Ω–µ—Ä–≥–∏—è)</button>
            <button class="btn" id="nextDayBtn">‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å</button>
            <button class="btn danger" id="resetBtn">üß® –°–±—Ä–æ—Å</button>
          </div>

          <div class="hr"></div>

          <div class="muted" style="font-size:12px;line-height:1.35">
            –ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–µ–ª–∞–π <b>—Å–æ—Ü—Å–µ—Ç–∏</b> ‚Üí –ø–æ–¥–Ω–∏–º–∞–π <b>hype</b> ‚Üí —Ä–µ–ª–∏–∑—å —Ç—Ä–µ–∫ ‚Üí –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è/—Ñ–∏—Ç—ã.
          </div>
        </div>
      </div>

      <!-- Right / Main -->
      <div class="card">
        <h3>
          –¶–µ–Ω—Ç—Ä
          <span class="sub" id="sectionTitle">–°—Ç—É–¥–∏—è</span>
        </h3>

        <div class="body">
          <!-- STUDIO -->
          <div class="section active" id="sec-studio">
            <div class="two">
              <div>
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</label>
                <input id="trackName" placeholder="–ù–∞–ø—Ä. 'deadwords ‚Äî NIGHT DRIVE'" maxlength="32"/>
              </div>
              <div>
                <label>–ñ–∞–Ω—Ä</label>
                <select id="genre">
                  <option value="memphis">Memphis / Phonk</option>
                  <option value="trap">Trap</option>
                  <option value="drill">Drill</option>
                  <option value="lofi">Lo-fi</option>
                  <option value="cloud">Cloud</option>
                </select>
              </div>
            </div>

            <div class="hr"></div>

            <div class="row">
              <button class="btn primary" id="writeBtn">‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å (–¥–µ–º–∫–∞)</button>
              <button class="btn" id="recordBtn">üéôÔ∏è –ó–∞–ø–∏—Å–∞—Ç—å</button>
              <button class="btn good" id="releaseBtn">üöÄ –í—ã–ø—É—Å—Ç–∏—Ç—å</button>
            </div>

            <div class="muted" style="margin-top:10px;font-size:12px;line-height:1.35">
              –ü–∏—à–µ—à—å ‚Üí –ó–∞–ø–∏—Å—ã–≤–∞–µ—à—å ‚Üí –í—ã–ø—É—Å–∫–∞–µ—à—å. –ö–∞—á–µ—Å—Ç–≤–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–≤—ã–∫–∞, —Å—Ç—É–¥–∏–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏.
            </div>

            <div class="hr"></div>
            <div class="list" id="draftsList"></div>
          </div>

          <!-- SOCIAL -->
          <div class="section" id="sec-social">
            <div class="row">
              <button class="btn primary" id="postBtn">üì± –ü–æ—Å—Ç –≤ TikTok/Shorts</button>
              <button class="btn" id="liveBtn">üî¥ –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä</button>
              <button class="btn good" id="teaseBtn">üß™ –¢–∏–∑–µ—Ä —Ç—Ä–µ–∫–∞</button>
            </div>
            <div class="hr"></div>
            <div class="list" id="socialFeed"></div>
          </div>

          <!-- CAREER -->
          <div class="section" id="sec-career">
            <div class="row">
              <button class="btn primary" id="showBtn">üé§ –í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ</button>
              <button class="btn" id="labelBtn">üè∑Ô∏è –ü–∏—Ç—á –ª–µ–π–±–ª—É</button>
              <button class="btn good" id="mvBtn">üé¨ –°–Ω—è—Ç—å –∫–ª–∏–ø</button>
            </div>
            <div class="hr"></div>
            <div class="list" id="careerLog"></div>
          </div>

          <!-- COLLAB -->
          <div class="section" id="sec-collab">
            <div class="row">
              <button class="btn primary" id="findFeatBtn">ü§ù –ù–∞–π—Ç–∏ —Ñ–∏—Ç</button>
              <button class="btn good" id="dropFeatBtn">üî• –î—Ä–æ–ø–Ω—É—Ç—å —Ñ–∏—Ç-—Ç—Ä–µ–∫</button>
            </div>
            <div class="hr"></div>
            <div class="list" id="collabList"></div>
          </div>

          <!-- SHOP -->
          <div class="section" id="sec-shop">
            <div class="list" id="shopList"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toast" id="toasts"></div>

  <!-- Bottom nav -->
  <div class="nav">
    <div class="bar">
      <div class="tab active" data-tab="studio">üéß –°—Ç—É–¥–∏—è</div>
      <div class="tab" data-tab="social">üì£ –°–æ—Ü—Å–µ—Ç–∏</div>
      <div class="tab" data-tab="career">üöÄ –ö–∞—Ä—å–µ—Ä–∞</div>
      <div class="tab" data-tab="collab">ü§ù –§–∏—Ç—ã</div>
      <div class="tab" data-tab="shop">üõí –ú–∞–≥–∞–∑</div>
    </div>
  </div>

<script>
(() => {
  // ---------- helpers
  const $ = (id) => document.getElementById(id);
  const fmt = (n) => Math.floor(n).toLocaleString("ru-RU");
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const rnd = (a, b) => Math.random() * (b - a) + a;
  const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

  function toast(title, text, type="info"){
    const wrap = $("toasts");
    const el = document.createElement("div");
    el.className = "t";
    const dotClass = type === "good" ? "dot good" : type === "warn" ? "dot warn" : type === "bad" ? "dot bad" : "dot";
    el.innerHTML = `
      <div class="left">
        <div class="${dotClass}"></div>
        <div class="msg">
          <b>${title}</b>
          <span>${text}</span>
        </div>
      </div>
      <div class="muted mono">${new Date().toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}</div>
    `;
    wrap.prepend(el);
    setTimeout(() => el.style.opacity = "0", 2800);
    setTimeout(() => el.remove(), 3300);
  }

  // ---------- game state
  const SAVE_KEY = "rapstar_sim_v1";
  const defaultState = () => ({
    day: 1,
    money: 200,
    fans: 0,
    rep: 0,
    energy: 100,
    maxEnergy: 100,
    hype: 0,       // 0..100
    skill: 1,      // 1..‚àû
    studioTier: 0, // 0 phone, 1 mic, 2 home, 3 pro
    drafts: [],    // {id,name,genre,stage:'demo'|'recorded',quality,createdDay}
    released: [],  // {id,name,genre,quality,day,streams,earned}
    feed: [],      // social events
    career: [],    // career log
    collabs: [],   // pending collab offers {id,artist,fee,repReq,day}
    perks: {       // upgrades
      marketing: 0,
      manager: 0,
      stamina: 0,
      ghostwriter: 0,
      producer: 0
    }
  });

  let S = load();

  function load(){
    try{
      const raw = localStorage.getItem(SAVE_KEY);
      if(!raw) return defaultState();
      const parsed = JSON.parse(raw);
      // patch missing fields (for future edits)
      return Object.assign(defaultState(), parsed, {
        perks: Object.assign(defaultState().perks, parsed.perks || {})
      });
    }catch(e){
      return defaultState();
    }
  }
  function save(){
    localStorage.setItem(SAVE_KEY, JSON.stringify(S));
  }

  // ---------- ranks
  function rankName(){
    const f = S.fans;
    if(f < 500) return "–ù–æ–≤–∏—á–æ–∫";
    if(f < 5_000) return "–õ–æ–∫–∞–ª—å–Ω—ã–π –¥–≤–∏–∂";
    if(f < 25_000) return "–ó–∞–ª–µ—Ç–∞–µ—à—å –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏";
    if(f < 150_000) return "–¢–æ–ø –ø–æ —Ä–∞–π–æ–Ω—É";
    if(f < 600_000) return "–ù–∞ —Å–ª—É—Ö—É";
    if(f < 2_000_000) return "–ó–≤–µ–∑–¥–∞";
    return "–õ–µ–≥–µ–Ω–¥–∞";
  }

  function studioName(){
    return ["–¢–µ–ª–µ—Ñ–æ–Ω","–ú–∏–∫—Ä–æ—Ñ–æ–Ω","–î–æ–º–∞—à–Ω—è—è —Å—Ç—É–¥–∏—è","Pro-—Å—Ç—É–¥–∏—è"][S.studioTier] || "???";
  }

  function energyCost(base){
    // –º–µ–Ω–µ–¥–∂–µ—Ä/—Å—Ç–∞–º–∏–Ω–∞ —É–º–µ–Ω—å—à–∞–µ—Ç —Ü–µ–Ω—É –¥–µ–π—Å—Ç–≤–∏–π
    const disc = 1 - (S.perks.stamina * 0.06) - (S.perks.manager * 0.04);
    return Math.max(4, Math.floor(base * clamp(disc, 0.65, 1)));
  }

  // ---------- UI render
  function render(){
    $("day").textContent = fmt(S.day);
    $("money").textContent = fmt(S.money);
    $("fans").textContent = fmt(S.fans);
    $("rep").textContent = fmt(S.rep);

    $("rank").textContent = rankName();
    $("skill").textContent = fmt(S.skill);
    $("studio").textContent = studioName();

    $("energyText").textContent = `${fmt(S.energy)}/${fmt(S.maxEnergy)}`;
    $("energyBar").style.width = `${(S.energy / S.maxEnergy) * 100}%`;

    $("hypeText").textContent = fmt(S.hype);
    $("hypeBar").style.width = `${clamp(S.hype,0,100)}%`;

    // drafts
    const drafts = $("draftsList");
    drafts.innerHTML = "";
    if(S.drafts.length === 0){
      drafts.innerHTML = `<div class="muted" style="font-size:12px">–ü–æ–∫–∞ –Ω–µ—Ç –¥–µ–º–æ–∫. –ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å üòà</div>`;
    } else {
      S.drafts.slice().reverse().forEach(d => {
        const stage = d.stage === "demo" ? "–î–µ–º–∫–∞" : "–ó–∞–ø–∏—Å–∞–Ω–æ";
        const q = Math.round(d.quality);
        drafts.appendChild(cardItem(
          `${d.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"} <span class="tag">${stage}</span>`,
          `–ñ–∞–Ω—Ä: <b>${d.genre}</b> ‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ: <b>${q}</b> ‚Ä¢ –î–µ–Ω—å: ${d.createdDay}`,
          [
            {text:"üßΩ –£–¥–∞–ª–∏—Ç—å", cls:"btn small danger", onClick:()=>removeDraft(d.id)},
          ]
        ));
      });
    }

    // social feed
    const feed = $("socialFeed");
    feed.innerHTML = "";
    if(S.feed.length === 0){
      feed.innerHTML = `<div class="muted" style="font-size:12px">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –¥–≤–∏–∂. –°–¥–µ–ª–∞–π –ø–æ—Å—Ç/—ç—Ñ–∏—Ä/—Ç–∏–∑–µ—Ä.</div>`;
    } else {
      S.feed.slice().reverse().slice(0,12).forEach(e => {
        feed.appendChild(cardItem(
          e.title,
          `${e.text}<div class="muted" style="margin-top:6px">–î–µ–Ω—å ${e.day}</div>`,
          []
        ));
      });
    }

    // career log
    const car = $("careerLog");
    car.innerHTML = "";
    if(S.career.length === 0){
      car.innerHTML = `<div class="muted" style="font-size:12px">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –í—ã—Å—Ç—É–ø–∞–π –∏–ª–∏ –ø–∏—Ç–∞–π –ª–µ–π–±–ª.</div>`;
    } else {
      S.career.slice().reverse().slice(0,12).forEach(e => {
        car.appendChild(cardItem(
          e.title,
          `${e.text}<div class="muted" style="margin-top:6px">–î–µ–Ω—å ${e.day}</div>`,
          []
        ));
      });
    }

    // collabs
    const col = $("collabList");
    col.innerHTML = "";
    if(S.collabs.length === 0){
      col.innerHTML = `<div class="muted" style="font-size:12px">–ù–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π. –ù–∞–∂–º–∏ ‚Äú–ù–∞–π—Ç–∏ —Ñ–∏—Ç‚Äù.</div>`;
    } else {
      S.collabs.slice().reverse().forEach(c => {
        col.appendChild(cardItem(
          `–§–∏—Ç: <b>${c.artist}</b>`,
          `–¢—Ä–µ–±. —Ä–µ–ø: <b>${c.repReq}</b> ‚Ä¢ –í–∑–Ω–æ—Å: <b>‚Ç∏${fmt(c.fee)}</b>`,
          [
            {text:"‚úÖ –ü—Ä–∏–Ω—è—Ç—å", cls:"btn small good", onClick:()=>acceptCollab(c.id)},
            {text:"‚úñÔ∏è –û—Ç–∫–∞–∑", cls:"btn small", onClick:()=>declineCollab(c.id)},
          ]
        ));
      });
    }

    // shop
    renderShop();

    // buttons enabled/disabled
    $("releaseBtn").disabled = !S.drafts.some(d => d.stage === "recorded");
    $("recordBtn").disabled = !S.drafts.some(d => d.stage === "demo");
    $("dropFeatBtn").disabled = S.collabs.length === 0;

    save();
  }

  function cardItem(titleHtml, metaHtml, actions){
    const el = document.createElement("div");
    el.className = "item";
    const left = document.createElement("div");
    left.innerHTML = `<b>${titleHtml}</b><div class="meta">${metaHtml}</div>`;
    const right = document.createElement("div");
    right.className = "right";

    actions.forEach(a=>{
      const b = document.createElement("button");
      b.className = a.cls || "btn small";
      b.textContent = a.text;
      b.onclick = a.onClick;
      right.appendChild(b);
    });

    el.appendChild(left);
    el.appendChild(right);
    return el;
  }

  function renderShop(){
    const list = $("shopList");
    list.innerHTML = "";

    const studioItems = [
      {
        id:"studio1", title:"üéôÔ∏è –ú–∏–∫—Ä–æ—Ñ–æ–Ω", desc:"+–∫–∞—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∏, +—Ä–µ–ø –∑–∞ —Ä–µ–ª–∏–∑—ã",
        price: 2500, cond: () => S.studioTier < 1,
        buy: ()=>{ S.studioTier = 1; toast("–ö—É–ø–ª–µ–Ω–æ","–ú–∏–∫—Ä–æ—Ñ–æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ì–æ–ª–æ—Å —Å—Ç–∞–ª –∂–∏—Ä–Ω–µ–µ üòà","good"); }
      },
      {
        id:"studio2", title:"üè† –î–æ–º–∞—à–Ω—è—è —Å—Ç—É–¥–∏—è", desc:"+—Å–∏–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –º–µ–Ω—å—à–µ —Ä–∞—Å—Ö–æ–¥ —ç–Ω–µ—Ä–≥–∏–∏ –Ω–∞ –∑–∞–ø–∏—Å—å",
        price: 12000, cond: () => S.studioTier < 2,
        buy: ()=>{ S.studioTier = 2; toast("–ê–ø–≥—Ä–µ–π–¥","–î–æ–º–∞—à–Ω—è—è —Å—Ç—É–¥–∏—è –≥–æ—Ç–æ–≤–∞. –ü–æ—Ä–∞ —Ñ–ª–µ–∫—Å–∏—Ç—å.","good"); }
      },
      {
        id:"studio3", title:"üíé Pro-—Å—Ç—É–¥–∏—è", desc:"–º–∞–∫—Å –∫–∞—á–µ—Å—Ç–≤–æ, –±–æ–Ω—É—Å –∫ —Ñ–∞–Ω–∞–º/—Å—Ç—Ä–∏–º–∞–º",
        price: 55000, cond: () => S.studioTier < 3,
        buy: ()=>{ S.studioTier = 3; toast("–õ—é—Ç–æ","Pro-—Å—Ç—É–¥–∏—è. –¢–µ–ø–µ—Ä—å —Ç—ã –æ–ø–∞—Å–µ–Ω.","good"); }
      },
    ];

    const perkItems = [
      {
        id:"marketing", title:"üìà –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥", desc:"—Å–æ—Ü—Å–µ—Ç–∏ —Å–∏–ª—å–Ω–µ–µ –∫–∞—á–∞—é—Ç hype –∏ —Ñ–∞–Ω–∞—Ç–æ–≤",
        price: () => 1800 * (1 + S.perks.marketing),
        level: ()=>S.perks.marketing, max: 10,
        buy: ()=>{ S.perks.marketing++; toast("–ü—Ä–æ–∫–∞—á–∫–∞","–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ —É–ª—É—á—à–µ–Ω.","good"); }
      },
      {
        id:"manager", title:"üßë‚Äçüíº –ú–µ–Ω–µ–¥–∂–µ—Ä", desc:"–¥–µ–π—Å—Ç–≤–∏—è —Ç—Ä–∞—Ç—è—Ç –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏",
        price: () => 2400 * (1 + S.perks.manager),
        level: ()=>S.perks.manager, max: 10,
        buy: ()=>{ S.perks.manager++; toast("–ü—Ä–æ–∫–∞—á–∫–∞","–ú–µ–Ω–µ–¥–∂–µ—Ä –≤ –¥–µ–ª–µ.","good"); }
      },
      {
        id:"stamina", title:"ü´Ä –í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å", desc:"+–º–∞–∫—Å —ç–Ω–µ—Ä–≥–∏—è",
        price: () => 1600 * (1 + S.perks.stamina),
        level: ()=>S.perks.stamina, max: 10,
        buy: ()=>{ S.perks.stamina++; S.maxEnergy += 10; S.energy += 10; toast("–ü—Ä–æ–∫–∞—á–∫–∞","+10 –∫ –º–∞–∫—Å–∏–º—É–º—É —ç–Ω–µ—Ä–≥–∏–∏.","good"); }
      },
      {
        id:"ghostwriter", title:"üìù –ì–æ—Å—Ç—Ä–∞–π—Ç–µ—Ä", desc:"+–∫–∞—á–µ—Å—Ç–≤–æ –¥–µ–º–∫–∏ (–Ω–æ –º–µ–Ω—å—à–µ —Ä–µ–ø–∞ –∑–∞ ‚Äú—Ç—Ä—É—à–Ω–æ—Å—Ç—å‚Äù)",
        price: () => 2200 * (1 + S.perks.ghostwriter),
        level: ()=>S.perks.ghostwriter, max: 10,
        buy: ()=>{ S.perks.ghostwriter++; toast("–ü—Ä–æ–∫–∞—á–∫–∞","–ì–æ—Å—Ç—Ä–∞–π—Ç–µ—Ä –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ —Ç–µ–∫—Å—Ç–∞–º.","warn"); }
      },
      {
        id:"producer", title:"üéõÔ∏è –ü—Ä–æ–¥—é—Å–µ—Ä", desc:"+—Å—Ç—Ä–∏–º—ã/–¥–æ—Ö–æ–¥ –æ—Ç —Ä–µ–ª–∏–∑–æ–≤",
        price: () => 2600 * (1 + S.perks.producer),
        level: ()=>S.perks.producer, max: 10,
        buy: ()=>{ S.perks.producer++; toast("–ü—Ä–æ–∫–∞—á–∫–∞","–ü—Ä–æ–¥—é—Å–µ—Ä –ø–æ–¥–Ω—è–ª –∑–≤—É–∫.","good"); }
      },
    ];

    const blocks = [
      {head:"–°—Ç—É–¥–∏—è", items: studioItems.map(i=>({
        title:i.title,
        desc:i.desc,
        right: () => `‚Ç∏${fmt(i.price)}`,
        disabled: () => S.money < i.price,
        hidden: () => !i.cond(),
        onBuy: () => purchase(i.price, i.buy)
      }))},
      {head:"–ü—Ä–æ–∫–∞—á–∫–∏", items: perkItems.map(i=>({
        title: `${i.title} <span class="tag">—É—Ä. ${i.level()}/${i.max}</span>`,
        desc:i.desc,
        right: () => `‚Ç∏${fmt(i.price())}`,
        disabled: () => S.money < i.price() || i.level() >= i.max,
        hidden: () => i.level() >= i.max,
        onBuy: () => purchase(i.price(), i.buy)
      }))},
      {head:"–°–µ—Ä–≤–∏—Å", items: [
        {
          title:"üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é",
          desc:"–Ω–∞ –≤—Å—è–∫–∏–π ‚Äî —Ä—É–∫–∞–º–∏",
          right: ()=>"OK",
          disabled: ()=>false,
          hidden: ()=>false,
          onBuy: ()=>{ save(); toast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ","–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω.","good"); }
        }
      ]}
    ];

    blocks.forEach(block=>{
      const header = document.createElement("div");
      header.className = "item";
      header.innerHTML = `<div><b>${block.head}</b><div class="meta">–ê–ø–≥—Ä–µ–π–¥—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è</div></div><div class="right"><span class="tag">üõí</span></div>`;
      list.appendChild(header);

      block.items.forEach(it=>{
        if(it.hidden()) return;
        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `
          <div>
            <b>${it.title}</b>
            <div class="meta">${it.desc}</div>
          </div>
          <div class="right">
            <div class="tag mono">${it.right()}</div>
            <button class="btn small ${it.disabled() ? "" : "primary"}" ${it.disabled() ? "disabled":""}>–ö—É–ø–∏—Ç—å</button>
          </div>
        `;
        el.querySelector("button").onclick = it.onBuy;
        list.appendChild(el);
      });
    });
  }

  function purchase(price, fn){
    if(S.money < price){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥", `–ù—É–∂–Ω–æ ‚Ç∏${fmt(price)}.`,"bad");
      return;
    }
    S.money -= price;
    fn();
    render();
  }

  // ---------- mechanics
  function qualityBase(){
    const studioBonus = [0, 8, 18, 30][S.studioTier] || 0;
    const energyBonus = (S.energy / S.maxEnergy) * 18;
    const skillBonus = Math.log2(1 + S.skill) * 14;
    const ghost = S.perks.ghostwriter * 2.0;
    return studioBonus + energyBonus + skillBonus + ghost;
  }

  function genreBoost(genre){
    // –º–∏–∫—Ä–æ-–±–∞–ª–∞–Ω—Å
    const map = {
      memphis: {hype: 10, fans: 1.10},
      trap:    {hype: 8,  fans: 1.06},
      drill:   {hype: 9,  fans: 1.07},
      lofi:    {hype: 5,  fans: 1.03},
      cloud:   {hype: 6,  fans: 1.04},
    };
    return map[genre] || {hype: 6, fans: 1.04};
  }

  function ensureEnergy(cost){
    if(S.energy < cost){
      toast("–ù–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏", "–û—Ç–¥–æ—Ö–Ω–∏ –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.","warn");
      return false;
    }
    S.energy -= cost;
    return true;
  }

  function writeDemo(){
    const name = ($("trackName").value || "").trim();
    const genre = $("genre").value;

    const cost = energyCost(14);
    if(!ensureEnergy(cost)) return;

    const base = qualityBase();
    const g = genreBoost(genre);
    const hypeFactor = (S.hype * 0.22);
    const rng = rnd(-8, 10);

    let quality = clamp(base + hypeFactor + rng, 10, 100);
    // —á–µ—Å—Ç–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç –æ—Ç –≥–æ—Å—Ç—Ä–∞–π—Ç–µ—Ä–∞ => —á—É—Ç—å –º–µ–Ω—å—à–µ —Ä–µ–ø—ã –∑–∞ —Ä–µ–ª–∏–∑—ã
    const id = crypto.randomUUID();

    S.drafts.push({id, name: name || genName(genre), genre, stage:"demo", quality, createdDay:S.day});
    S.skill += 0.25 + (S.perks.producer * 0.02);
    S.hype = clamp(S.hype + g.hype * 0.25, 0, 100);

    toast("–î–µ–º–∫–∞ –≥–æ—Ç–æ–≤–∞", `–ö–∞—á–µ—Å—Ç–≤–æ: ${Math.round(quality)} ‚Ä¢ -${cost} —ç–Ω–µ—Ä–≥–∏–∏`, "good");
    render();
  }

  function recordTrack(){
    const d = S.drafts.find(x => x.stage === "demo");
    if(!d){
      toast("–ù–µ—Ç –¥–µ–º–∫–∏", "–°–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ –¥–µ–º–∫—É.","warn");
      return;
    }
    const cost = energyCost(S.studioTier >= 2 ? 12 : 18);
    if(!ensureEnergy(cost)) return;

    const rng = rnd(-5, 12);
    const studioLift = [0, 6, 12, 18][S.studioTier] || 0;
    d.quality = clamp(d.quality + studioLift * 0.35 + rng, 10, 100);
    d.stage = "recorded";

    S.skill += 0.35 + (S.perks.producer * 0.03);
    toast("–ó–∞–ø–∏—Å–∞–Ω–æ", `–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã–ø—É—Å–∫–∞—Ç—å. –ö–∞—á–µ—Å—Ç–≤–æ: ${Math.round(d.quality)}`,"good");
    render();
  }

  function releaseTrack(){
    const d = S.drafts.find(x => x.stage === "recorded");
    if(!d){
      toast("–ù–µ—á–µ–≥–æ –≤—ã–ø—É—Å–∫–∞—Ç—å", "–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—à–∏ —Ç—Ä–µ–∫.","warn");
      return;
    }
    const cost = energyCost(10);
    if(!ensureEnergy(cost)) return;

    const g = genreBoost(d.genre);
    const q = d.quality;

    // —Å—Ç—Ä–∏–º—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞, —Ö–∞–π–ø–∞, —Ñ–∞–Ω–±–∞–∑—ã, –ø—Ä–æ–∫–∞—á–µ–∫
    const baseStreams = (q*q) * 6;
    const hypeMult = 1 + (S.hype / 100) * 1.2;
    const fanMult = 1 + Math.log10(1 + S.fans) * 0.35;
    const prodMult = 1 + (S.perks.producer * 0.06);
    const streams = Math.floor(baseStreams * hypeMult * fanMult * prodMult * rnd(0.75, 1.25));

    // –¥–æ—Ö–æ–¥ (—É—Å–ª–æ–≤–Ω–æ)
    const moneyEarned = Math.floor(streams * rnd(0.0012, 0.0022));
    S.money += moneyEarned;

    // —Ä–æ—Å—Ç —Ñ–∞–Ω–∞—Ç–æ–≤
    const gainedFans = Math.floor((streams / 120) * g.fans * (1 + S.perks.marketing * 0.06));
    S.fans += gainedFans;

    // —Ä–µ–ø—É—Ç–∞—Ü–∏—è
    const ghostPenalty = S.perks.ghostwriter > 0 ? (S.perks.ghostwriter * 0.4) : 0;
    const repGain = Math.max(0, Math.floor((q / 8) + (S.hype / 18) - ghostPenalty + rnd(-1, 3)));
    S.rep += repGain;

    // —Ö–∞–π–ø —á—É—Ç—å –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ —Ä–µ–ª–∏–∑–∞
    S.hype = clamp(S.hype - (10 + rnd(0, 8)), 0, 100);

    S.released.push({
      id: d.id, name: d.name, genre: d.genre, quality: q,
      day: S.day, streams, earned: moneyEarned
    });
    // remove draft
    S.drafts = S.drafts.filter(x => x.id !== d.id);

    toast("–†–µ–ª–∏–∑ –∑–∞–ª–µ—Ç–µ–ª", `+${fmt(gainedFans)} —Ñ–∞–Ω–∞—Ç–æ–≤ ‚Ä¢ +‚Ç∏${fmt(moneyEarned)} ‚Ä¢ +${repGain} —Ä–µ–ø`, "good");
    S.career.push({
      day:S.day,
      title:`üöÄ –†–µ–ª–∏–∑: ${d.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}`,
      text:`–°—Ç—Ä–∏–º—ã: <b>${fmt(streams)}</b> ‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ: <b>${Math.round(q)}</b> ‚Ä¢ –î–æ—Ö–æ–¥: <b>‚Ç∏${fmt(moneyEarned)}</b>`
    });
    render();
  }

  function postSocial(kind){
    const cost = energyCost(kind === "live" ? 14 : 10);
    if(!ensureEnergy(cost)) return;

    const m = 1 + (S.perks.marketing * 0.10);
    let hypeGain = 0, fansGain = 0, repGain = 0;

    if(kind === "post"){
      hypeGain = rnd(6, 14) * m;
      fansGain = rnd(5, 18) * m * (1 + Math.log10(1+S.fans)*0.08);
      repGain = rnd(0, 2);
      S.feed.push({day:S.day, title:"üì± –ü–æ—Å—Ç –≤ —Å–æ—Ü—Å–µ—Ç–∏", text:`–ó–∞–ª–∏–ª —à–æ—Ä—Ç—Å. –•–∞–π–ø —Ä–∞—Å—Ç—ë—Ç.`});
    }
    if(kind === "live"){
      hypeGain = rnd(8, 20) * m;
      fansGain = rnd(10, 32) * m * (1 + Math.log10(1+S.fans)*0.12);
      repGain = rnd(0, 3);
      S.feed.push({day:S.day, title:"üî¥ –ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä", text:`–ü–æ–±–æ–ª—Ç–∞–ª —Å –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π, –ø–æ–∫–∞–∑–∞–ª –∫—É—Å–æ–∫ —Ç—Ä–µ–∫–∞.`});
    }
    if(kind === "tease"){
      hypeGain = rnd(10, 24) * m;
      fansGain = rnd(8, 26) * m * (1 + Math.log10(1+S.fans)*0.10);
      repGain = rnd(0, 2);
      S.feed.push({day:S.day, title:"üß™ –¢–∏–∑–µ—Ä", text:`–¢–∏–∑–µ—Ä –ø–æ–¥ –±–∏—Ç. –õ—é–¥–∏ –∂–¥—É—Ç —Ä–µ–ª–∏–∑.`});
    }

    S.hype = clamp(S.hype + hypeGain, 0, 100);
    S.fans += Math.floor(fansGain);
    S.rep += Math.floor(repGain);

    toast("–°–æ—Ü—Å–µ—Ç–∏", `+${Math.floor(hypeGain)} hype ‚Ä¢ +${Math.floor(fansGain)} —Ñ–∞–Ω–∞—Ç–æ–≤`, "good");
    render();
  }

  function show(){
    const cost = energyCost(18);
    if(!ensureEnergy(cost)) return;

    const ticketBase = 80 + (S.rep * 6) + (Math.log10(1+S.fans)*120);
    const crowd = Math.floor(ticketBase * rnd(0.6, 1.4));
    const fee = Math.floor(crowd * rnd(6, 14));
    const fansGain = Math.floor(crowd * rnd(0.05, 0.14));
    const repGain = Math.floor(rnd(1, 5) + Math.log2(1+S.skill));

    S.money += fee;
    S.fans += fansGain;
    S.rep += repGain;
    S.hype = clamp(S.hype + rnd(4, 12), 0, 100);

    S.career.push({
      day:S.day,
      title:"üé§ –í—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ",
      text:`–¢–æ–ª–ø–∞: <b>${fmt(crowd)}</b> ‚Ä¢ –ì–æ–Ω–æ—Ä–∞—Ä: <b>‚Ç∏${fmt(fee)}</b> ‚Ä¢ +${fmt(fansGain)} —Ñ–∞–Ω–∞—Ç–æ–≤ ‚Ä¢ +${repGain} —Ä–µ–ø`
    });

    toast("–ö–æ–Ω—Ü–µ—Ä—Ç", `‚Ç∏+${fmt(fee)} ‚Ä¢ —Ñ–∞–Ω–∞—Ç—ã +${fmt(fansGain)}`, "good");
    render();
  }

  function musicVideo(){
    const cost = energyCost(16);
    if(!ensureEnergy(cost)) return;

    const price = Math.floor(3000 + (S.rep * 80) + (S.fans * 0.02));
    if(S.money < price){
      toast("–ö–ª–∏–ø –¥–æ—Ä–æ–≥–æ–π", `–ù—É–∂–Ω–æ ‚Ç∏${fmt(price)}. –ü–æ–¥–∑–∞—Ä–∞–±–æ—Ç–∞–π –Ω–∞ —Ä–µ–ª–∏–∑–∞—Ö/–≤—ã—Å—Ç—É–ø–∞—Ö.`, "bad");
      // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ–±–∏–¥–Ω–æ
      S.energy = clamp(S.energy + Math.floor(cost*0.5), 0, S.maxEnergy);
      render();
      return;
    }
    S.money -= price;

    const m = 1 + S.perks.marketing * 0.10;
    const hypeGain = rnd(18, 35) * m;
    const fansGain = Math.floor(rnd(60, 140) * m * (1 + Math.log10(1+S.fans)*0.12));
    const repGain = Math.floor(rnd(2, 6));

    S.hype = clamp(S.hype + hypeGain, 0, 100);
    S.fans += fansGain;
    S.rep += repGain;

    S.career.push({
      day:S.day,
      title:"üé¨ –ö–ª–∏–ø",
      text:`–ë—é–¥–∂–µ—Ç: <b>‚Ç∏${fmt(price)}</b> ‚Ä¢ +${Math.floor(hypeGain)} hype ‚Ä¢ +${fmt(fansGain)} —Ñ–∞–Ω–∞—Ç–æ–≤ ‚Ä¢ +${repGain} —Ä–µ–ø`
    });

    toast("–ö–ª–∏–ø –≤—ã—à–µ–ª", `-‚Ç∏${fmt(price)} ‚Ä¢ hype +${Math.floor(hypeGain)}`, "good");
    render();
  }

  function pitchLabel(){
    const cost = energyCost(12);
    if(!ensureEnergy(cost)) return;

    const chance = clamp(0.10 + (S.rep/200) + (S.fans/200000) + (S.hype/220), 0.12, 0.75);
    const ok = Math.random() < chance;

    if(ok){
      const advance = Math.floor(8000 + S.rep*120 + Math.log10(1+S.fans)*9000);
      S.money += advance;
      S.rep += 4;
      S.hype = clamp(S.hype + 14, 0, 100);
      S.career.push({day:S.day, title:"üè∑Ô∏è –õ–µ–π–±–ª –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–ª—Å—è", text:`–ê–≤–∞–Ω—Å: <b>‚Ç∏${fmt(advance)}</b> ‚Ä¢ +4 —Ä–µ–ø ‚Ä¢ hype +14`});
      toast("–õ–µ–π–±–ª", `–ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ—á—Ç–∏ –≤ –∫–∞—Ä–º–∞–Ω–µ. –ê–≤–∞–Ω—Å ‚Ç∏${fmt(advance)}!`, "good");
    } else {
      S.rep = Math.max(0, S.rep - 1);
      S.career.push({day:S.day, title:"üè∑Ô∏è –õ–µ–π–±–ª –æ—Ç–∫–∞–∑–∞–ª", text:`–°–∫–∞–∑–∞–ª–∏: ‚Äú–ø–æ—Ä–∞–±–æ—Ç–∞–π –Ω–∞–¥ —Å—Ç–∏–ª–µ–º‚Äù. –†–µ–ø -1.`});
      toast("–õ–µ–π–±–ª", "–û—Ç–∫–∞–∑. –ù–æ —ç—Ç–æ –º–æ—Ç–∏–≤–∞—Ü–∏—è. –î–µ–ª–∞–π —Ä–µ–ª–∏–∑—ã + —Å–æ—Ü—Å–µ—Ç–∏.", "warn");
    }
    render();
  }

  function findFeat(){
    const cost = energyCost(10);
    if(!ensureEnergy(cost)) return;

    const pool = [
      "KID NOVA","Sxve Prince","Night 13","VOIDWAVE","LUXE BOY","DARKMODE","CTRL.GHOST","MIRAGE","AKIMBO","NEON TONE"
    ];
    const artist = pick(pool) + (Math.random()<0.25 ? " (—Ö–∞–π–ø–æ–≤—ã–π)" : "");
    const repReq = Math.floor(6 + rnd(0, 10) + Math.log10(1+S.fans)*4);
    const fee = Math.floor(1200 + repReq*160 + rnd(0, 800));

    S.collabs.push({id: crypto.randomUUID(), artist, repReq, fee, day:S.day});
    toast("–§–∏—Ç –Ω–∞–π–¥–µ–Ω", `${artist} –≥–æ—Ç–æ–≤. –¢—Ä–µ–±: —Ä–µ–ø ${repReq}, –≤–∑–Ω–æ—Å ‚Ç∏${fmt(fee)}`, "good");
    render();
  }

  function acceptCollab(id){
    const c = S.collabs.find(x => x.id === id);
    if(!c) return;

    if(S.rep < c.repReq){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ä–µ–ø—É—Ç–∞—Ü–∏–∏", `–ù—É–∂–Ω–æ ${c.repReq} —Ä–µ–ø. –°–µ–π—á–∞—Å: ${S.rep}.`, "bad");
      return;
    }
    if(S.money < c.fee){
      toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥", `–ù—É–∂–Ω–æ ‚Ç∏${fmt(c.fee)}. –°–µ–π—á–∞—Å: ‚Ç∏${fmt(S.money)}.`, "bad");
      return;
    }
    S.money -= c.fee;

    // accepted = temporary buff on next release
    S.hype = clamp(S.hype + 16, 0, 100);
    S.rep += 2;

    S.feed.push({day:S.day, title:"ü§ù –§–∏—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω", text:`–° ${c.artist}. –ê—É–¥–∏—Ç–æ—Ä–∏—è –∂–¥—ë—Ç üî•`});
    toast("–§–∏—Ç", `–°–¥–µ–ª–∫–∞ —Å ${c.artist}. hype +16 ‚Ä¢ —Ä–µ–ø +2`, "good");

    // mark collab as "ready"
    c.ready = true;
    render();
  }

  function declineCollab(id){
    S.collabs = S.collabs.filter(x => x.id !== id);
    toast("–û–∫", "–û—Ç–∫–∞–∑–∞–ª –æ—Ç —Ñ–∏—Ç–∞.", "warn");
    render();
  }

  function dropFeat(){
    // needs at least one ready collab OR any collab to ‚Äú–ø—Ä–æ–¥–∞–≤–∏—Ç—å‚Äù
    const c = S.collabs.find(x => x.ready) || S.collabs[0];
    if(!c){
      toast("–ù–µ—Ç —Ñ–∏—Ç–∞", "–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏/–ø—Ä–∏–º–∏ —Ñ–∏—Ç.","warn");
      return;
    }
    const cost = energyCost(14);
    if(!ensureEnergy(cost)) return;

    // create a special release effect
    const baseQ = clamp(qualityBase() + rnd(6, 18), 15, 100);
    const hypeBuff = 1 + (S.hype/100)*1.4;
    const repBuff = 1 + (S.rep/80);
    const streams = Math.floor((baseQ*baseQ*7) * hypeBuff * repBuff * (1 + S.perks.producer*0.06) * rnd(0.8,1.25));
    const moneyEarned = Math.floor(streams * rnd(0.0015, 0.0026));
    const fansGain = Math.floor((streams / 90) * (1 + S.perks.marketing*0.06));

    S.money += moneyEarned;
    S.fans += fansGain;
    S.rep += 3;
    S.hype = clamp(S.hype - 12, 0, 100);

    S.career.push({
      day:S.day,
      title:`üî• –§–∏—Ç-—Ä–µ–ª–∏–∑ —Å ${c.artist}`,
      text:`–°—Ç—Ä–∏–º—ã: <b>${fmt(streams)}</b> ‚Ä¢ –î–æ—Ö–æ–¥: <b>‚Ç∏${fmt(moneyEarned)}</b> ‚Ä¢ +${fmt(fansGain)} —Ñ–∞–Ω–∞—Ç–æ–≤ ‚Ä¢ +3 —Ä–µ–ø`
    });

    // remove that collab
    S.collabs = S.collabs.filter(x => x.id !== c.id);

    toast("–§–∏—Ç –¥—Ä–æ–ø–Ω—É–ª—Å—è", `–°—Ç—Ä–∏–º—ã ${fmt(streams)} ‚Ä¢ ‚Ç∏+${fmt(moneyEarned)}`, "good");
    render();
  }

  function removeDraft(id){
    S.drafts = S.drafts.filter(x => x.id !== id);
    toast("–£–¥–∞–ª–µ–Ω–æ", "–î–µ–º–∫–∞ —É–¥–∞–ª–µ–Ω–∞.", "warn");
    render();
  }

  function rest(){
    const gain = Math.floor(24 + rnd(0, 16) + S.perks.stamina*2);
    S.energy = clamp(S.energy + gain, 0, S.maxEnergy);
    S.hype = clamp(S.hype - rnd(2, 6), 0, 100);
    toast("–û—Ç–¥—ã—Ö", `–≠–Ω–µ—Ä–≥–∏—è +${gain}`, "good");
    render();
  }

  function nextDay(){
    S.day += 1;

    // –ø–∞—Å—Å–∏–≤: —Ö–∞–π–ø —Å–ª–µ–≥–∫–∞ —Ç—É—Ö–Ω–µ—Ç
    S.hype = clamp(S.hype - rnd(4, 10), 0, 100);

    // –ø–∞—Å—Å–∏–≤–Ω—ã–µ –¥–µ–Ω—å–≥–∏ –æ—Ç –∫–∞—Ç–∞–ª–æ–≥–∞/—Å—Ç—Ä–∏–º–æ–≤
    let passive = 0;
    for(const r of S.released.slice(-10)){
      const decay = Math.max(0.25, 1 - (S.day - r.day) * 0.08);
      const daily = Math.floor((r.streams * 0.002) * decay * rnd(0.65, 1.2) * (1 + S.perks.producer*0.05));
      passive += daily;
    }
    if(passive > 0){
      S.money += passive;
      toast("–ö–∞—Ç–∞–ª–æ–≥", `–ü–∞—Å—Å–∏–≤ —Å–æ —Å—Ç—Ä–∏–º–æ–≤: ‚Ç∏+${fmt(passive)}`, "good");
    }

    // —ç–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
    const regen = Math.floor(34 + rnd(0, 20) + S.perks.stamina*3);
    S.energy = clamp(S.energy + regen, 0, S.maxEnergy);

    // —Ä–∞–Ω–¥–æ–º –∏–≤–µ–Ω—Ç
    randomEvent();

    render();
  }

  function randomEvent(){
    const roll = Math.random();
    if(roll < 0.18){
      // trend
      const gain = Math.floor(rnd(8, 20) * (1 + S.perks.marketing*0.10));
      S.hype = clamp(S.hype + gain, 0, 100);
      S.feed.push({day:S.day, title:"üìà –¢—Ä–µ–Ω–¥", text:`–ó–≤—É–∫ –∑–∞–ª–µ—Ç–µ–ª –≤ —Ç—Ä–µ–Ω–¥. hype +${gain}`});
      toast("–¢—Ä–µ–Ω–¥", `hype +${gain}`, "good");
      return;
    }
    if(roll < 0.30){
      // hate
      const loss = Math.floor(rnd(1, 4));
      S.rep = Math.max(0, S.rep - loss);
      S.feed.push({day:S.day, title:"üí¨ –•–µ–π—Ç", text:`–ö–æ–º–º–µ–Ω—Ç—ã —Ç–æ–∫—Å–∏—á–Ω—ã–µ. –†–µ–ø -${loss}`});
      toast("–•–µ–π—Ç", `—Ä–µ–ø -${loss}`, "warn");
      return;
    }
    if(roll < 0.38){
      // sponsor
      const money = Math.floor(rnd(1200, 5200) + S.fans*0.01);
      S.money += money;
      S.feed.push({day:S.day, title:"ü§ù –†–µ–∫–ª–∞–º–∞", text:`–ù–µ–±–æ–ª—å—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è. ‚Ç∏+${fmt(money)}`});
      toast("–†–µ–∫–ª–∞–º–∞", `‚Ç∏+${fmt(money)}`, "good");
      return;
    }
  }

  function genName(genre){
    const a = ["NIGHT","VOID","DARK","NEON","SILENCE","SHADOW","BLAST","RAGE","ICE","DREAM"];
    const b = ["MODE","TAPE","FLOW","WAVE","ROOM","DRIVE","KICK","BASS","SZN","CITY"];
    const g = {memphis:"PHONK", trap:"TRAP", drill:"DRILL", lofi:"LOFI", cloud:"CLOUD"}[genre] || "TRACK";
    return `${pick(a)} ${pick(b)} (${g})`;
  }

  function reset(){
    localStorage.removeItem(SAVE_KEY);
    S = defaultState();
    toast("–°–±—Ä–æ—Å", "–ü—Ä–æ–≥—Ä–µ—Å—Å –æ—á–∏—â–µ–Ω.", "warn");
    render();
  }

  // ---------- tabs
  const tabs = document.querySelectorAll(".tab");
  const sections = {
    studio: $("sec-studio"),
    social: $("sec-social"),
    career: $("sec-career"),
    collab: $("sec-collab"),
    shop: $("sec-shop"),
  };
  const titles = {
    studio: "–°—Ç—É–¥–∏—è",
    social: "–°–æ—Ü—Å–µ—Ç–∏",
    career: "–ö–∞—Ä—å–µ—Ä–∞",
    collab: "–§–∏—Ç—ã",
    shop: "–ú–∞–≥–∞–∑",
  };

  function setTab(name){
    tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === name));
    Object.entries(sections).forEach(([k,el]) => el.classList.toggle("active", k === name));
    $("sectionTitle").textContent = titles[name] || "–¶–µ–Ω—Ç—Ä";
  }
  tabs.forEach(t => t.addEventListener("click", () => setTab(t.dataset.tab)));

  // ---------- wire buttons
  $("writeBtn").onclick = writeDemo;
  $("recordBtn").onclick = recordTrack;
  $("releaseBtn").onclick = releaseTrack;

  $("postBtn").onclick = () => postSocial("post");
  $("liveBtn").onclick = () => postSocial("live");
  $("teaseBtn").onclick = () => postSocial("tease");

  $("showBtn").onclick = show;
  $("mvBtn").onclick = musicVideo;
  $("labelBtn").onclick = pitchLabel;

  $("findFeatBtn").onclick = findFeat;
  $("dropFeatBtn").onclick = dropFeat;

  $("restBtn").onclick = rest;
  $("nextDayBtn").onclick = nextDay;
  $("resetBtn").onclick = reset;

  // ---------- initial hints
  if(S.day === 1 && S.fans === 0 && S.rep === 0){
    toast("–°—Ç–∞—Ä—Ç", "–°–¥–µ–ª–∞–π –ø–æ—Å—Ç –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö ‚Üí –Ω–∞–ø–∏—à–∏ –¥–µ–º–∫—É ‚Üí –∑–∞–ø–∏—à–∏ ‚Üí –≤—ã–ø—É—Å—Ç–∏.", "good");
  }

  render();
})();
</script>
</body>
        </html>
