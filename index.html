<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DarkSurvival ‚Äî –†—É–ª–µ—Ç–∫–∞</title>
  <style>
    :root{
      --bg0:#070812;
      --bg1:#0B0F22;
      --text:#EAF0FF;
      --muted: rgba(234,240,255,.72);
      --accent:#A855F7;
      --accent2:#22D3EE;
      --border: rgba(255,255,255,.10);
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 18px;
      --bad:#EF4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 15% 15%, rgba(168,85,247,.25), transparent 60%),
        radial-gradient(900px 700px at 85% 20%, rgba(34,211,238,.18), transparent 60%),
        radial-gradient(900px 800px at 70% 90%, rgba(168,85,247,.18), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height: 100vh;
      overflow-x:hidden;
    }

    .glow{
      position: fixed; inset:-120px; pointer-events:none;
      background:
        radial-gradient(500px 300px at 20% 30%, rgba(34,211,238,.08), transparent 60%),
        radial-gradient(520px 320px at 70% 60%, rgba(168,85,247,.10), transparent 60%);
      filter: blur(24px);
      animation: floatGlow 8s ease-in-out infinite alternate;
      opacity:.9;
    }
    @keyframes floatGlow{
      from { transform: translate3d(-10px,-8px,0) scale(1); }
      to   { transform: translate3d(12px,10px,0) scale(1.02); }
    }

    /* ===== Topbar (simple) ===== */
    .topbar{
      height: 56px;
      display:flex;
      align-items:center;
      padding: 0 14px;
      position: sticky;
      top:0;
      z-index: 20;
      backdrop-filter: blur(14px);
      background: rgba(10,12,22,.62);
      border-bottom: 1px solid rgba(255,255,255,.08);
      gap: 10px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      font-weight: 1000;
      color: rgba(234,240,255,.92);
      white-space: nowrap;
    }
    .chip i{
      width:10px;height:10px;border-radius:99px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(168,85,247,.5);
      display:inline-block;
    }

    /* ===== Floating spin badge (always fits) ===== */
    .spinFloat{
      position: fixed;
      top: calc(10px + env(safe-area-inset-top));
      right: calc(10px + env(safe-area-inset-right));
      z-index: 30;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(10,12,22,.72);
      backdrop-filter: blur(12px);
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      font-weight: 1000;
      max-width: calc(100vw - 20px);
    }
    .spinFloat b{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      letter-spacing: .3px;
      font-size: 16px;
      white-space: nowrap;
    }
    .spinFloat .mini{
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.92);
      font-weight: 1000;
      cursor:pointer;
      white-space: nowrap;
    }
    .spinFloat .mini:active{transform: translateY(1px); filter: brightness(.98);}

    .wrap{max-width:1040px;margin:0 auto;padding:14px 14px 26px;}
    .hero{padding:12px 2px 10px;display:flex;flex-direction:column;gap:8px;align-items:flex-start;}
    .hero h1{margin:0;font-size:30px;line-height:1.05;font-weight:1000;letter-spacing:.2px;}
    .hero p{margin:0;color:var(--muted);font-weight:800;line-height:1.35;font-size:13px;max-width:72ch;}
    @media (min-width: 900px){ .hero h1{font-size:34px;} }

    .grid{display:grid;grid-template-columns:1fr;gap:12px;align-items:start;}
    @media (min-width: 900px){ .grid{grid-template-columns: 1.15fr .85fr; gap:14px;} }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;
      position: relative;
    }
    .card::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(600px 260px at 20% 10%, rgba(168,85,247,.18), transparent 60%),
        radial-gradient(520px 260px at 80% 40%, rgba(34,211,238,.14), transparent 60%);
      filter: blur(18px);
      opacity:.55;
      pointer-events:none;
    }
    .cardInner{position:relative;padding:12px;}

    .wheelZone{display:grid;place-items:center;padding:8px 0 12px;gap:10px;}
    .wheelShell{
      width: min(88vw, 440px);
      aspect-ratio: 1/1;
      position: relative;
      display:grid;
      place-items:center;
    }
    canvas#wheel{
      width:100%;
      height:100%;
      border-radius:999px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow:
        0 18px 60px rgba(0,0,0,.55),
        0 0 0 10px rgba(168,85,247,.06),
        0 0 0 18px rgba(34,211,238,.04);
    }
    .pointer{
      position:absolute; top:-6px;
      width:0;height:0;
      border-left:16px solid transparent;
      border-right:16px solid transparent;
      border-top:28px solid rgba(234,240,255,.92);
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.55));
    }
    .pointer::after{
      content:"";
      position:absolute; left:-16px; top:-28px;
      width:32px;height:32px;border-radius:999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      transform: translateY(-18px);
      box-shadow: 0 0 26px rgba(168,85,247,.55);
      opacity:.95;
    }

    .btn{
      width: min(88vw, 440px);
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(168,85,247,.95), rgba(34,211,238,.85));
      color: #071021;
      font-weight:1000;
      letter-spacing:.3px;
      cursor:pointer;
      box-shadow: 0 18px 60px rgba(0,0,0,.55), 0 0 26px rgba(168,85,247,.25);
      transition: transform .12s ease, filter .12s ease;
      position:relative;
      overflow:hidden;
    }
    .btn::before{
      content:"";
      position:absolute; inset:-120px;
      background: radial-gradient(220px 140px at 30% 40%, rgba(255,255,255,.55), transparent 60%);
      transform: translateX(-40%);
      opacity:.25;
      animation: sheen 2.6s linear infinite;
      pointer-events:none;
    }
    @keyframes sheen{ from { transform: translateX(-50%);} to { transform: translateX(40%);} }
    .btn:active{transform: translateY(1px) scale(.995); filter: brightness(.98);}
    .btn:disabled{opacity:.55; cursor:not-allowed; box-shadow:none}

    .miniRow{display:flex;gap:10px;width:min(88vw,440px);}
    .btnGhost{
      flex:1;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.92);
      font-weight: 1000;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    .btnGhost:active{transform: translateY(1px); filter: brightness(.97);}

    .stack{display:flex;flex-direction:column;gap:12px;}
    .field{
      display:flex;flex-direction:column;gap:8px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
    }
    .field label{font-weight:1000;letter-spacing:.2px;color: rgba(234,240,255,.95);}
    .input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: rgba(234,240,255,.95);
      font-weight: 900;
      outline:none;
    }
    .helper{color: rgba(234,240,255,.70);font-weight:800;font-size:12px;line-height:1.35;}

    .shake{
      animation: shake .35s ease;
      border-color: rgba(239,68,68,.55) !important;
      box-shadow: 0 0 0 3px rgba(239,68,68,.12);
    }
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(-6px)}
      50%{transform:translateX(6px)}
      75%{transform:translateX(-4px)}
      100%{transform:translateX(0)}
    }

    /* Modal */
    .overlay{
      position: fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
      backdrop-filter: blur(8px);
    }
    .overlay.show{display:flex}
    .modal{
      width: min(560px, 96vw);
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      box-shadow: 0 24px 80px rgba(0,0,0,.7);
      position: relative;
    }
    .modal::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(650px 240px at 20% 10%, rgba(168,85,247,.25), transparent 60%),
        radial-gradient(650px 240px at 80% 30%, rgba(34,211,238,.18), transparent 60%);
      filter: blur(20px);
      opacity:.7;
      pointer-events:none;
    }
    .modalHead{
      position:relative;
      display:flex;align-items:center;justify-content:space-between;
      padding: 14px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .modalHead h3{margin:0;font-size:16px;font-weight:1000;letter-spacing:.2px;}
    .closeX{
      width:40px;height:40px;border-radius:14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.92);
      font-weight:1000;
      cursor:pointer;
    }
    .modalBody{position:relative;padding:14px;}
    .winTitle{
      font-size: 24px;
      font-weight:1000;
      margin: 2px 0 8px;
      letter-spacing:.2px;
      text-align:center;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }
    .winDesc{
      text-align:center;
      color: rgba(234,240,255,.86);
      font-weight:800;
      line-height:1.35;
      margin: 0 0 10px;
      font-size: 13px;
    }
    .codeBox{
      text-align:center;
      font-weight:1000;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      padding: 10px 12px;
      margin: 12px 0 12px;
      word-break: break-word;
      color: rgba(234,240,255,.92);
    }
    .modalActions{
      position:relative;
      display:flex;
      gap:10px;
      justify-content:center;
      padding: 12px 14px 16px;
      border-top: 1px solid rgba(255,255,255,.10);
      flex-wrap: wrap;
    }
    .actionBtn{
      min-width: 190px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      padding: 12px 14px;
      font-weight:1000;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    .actionBtn:active{transform: translateY(1px); filter: brightness(.98);}
    .actionBtn.gray{background: rgba(255,255,255,.06); color: rgba(234,240,255,.92);}
    .actionBtn.orange{
      background: linear-gradient(135deg, rgba(168,85,247,.95), rgba(34,211,238,.85));
      color: #071021;
    }

    /* Confetti */
    #confetti{position:fixed; inset:0; pointer-events:none; z-index:60; display:none;}
    #confetti.show{display:block;}
  </style>
</head>

<body>
  <div class="glow"></div>

  <div class="topbar">
    <span class="chip"><i></i> DarkSurvival</span>
    <span class="chip">üé° –†—É–ª–µ—Ç–∫–∞</span>
  </div>

  <!-- always visible -->
  <div class="spinFloat" title="–ë–∞–ª–∞–Ω—Å —Å–ø–∏–Ω–æ–≤">
    üéüÔ∏è <span>–°–ø–∏–Ω—ã:</span> <b id="spinBalance">0</b>
    <button class="mini" id="addTestBtn" title="–¢–µ—Å—Ç: +10 —Å–ø–∏–Ω–æ–≤">+10</button>
  </div>

  <div class="wrap">
    <div class="hero">
      <h1>–†—É–ª–µ—Ç–∫–∞ –ø—Ä–∏–∑–æ–≤</h1>
      <p>
        –ê–∫—Ç–∏–≤–∏—Ä—É–π –ø—Ä–æ–º–æ–∫–æ–¥ ‚Äî –æ–Ω –¥–æ–±–∞–≤–∏—Ç <b>–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–∏–Ω–æ–≤</b>. –ü–æ—Ç–æ–º –∫—Ä—É—Ç–∏.
        –ï—Å–ª–∏ –≤—ã–ø–∞–¥–µ—Ç <b>+1 —Å–ø–∏–Ω</b> ‚Äî –æ–Ω –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ –±–∞–ª–∞–Ω—Å –≤—Å–µ–≥–¥–∞.
      </p>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="cardInner">
          <div class="wheelZone">
            <div class="wheelShell">
              <div class="pointer"></div>
              <canvas id="wheel" width="520" height="520"></canvas>
            </div>

            <button class="btn" id="spinBtn">–ù–µ—Ç —Å–ø–∏–Ω–æ–≤</button>

            <div class="miniRow">
              <button class="btnGhost" id="howBtn">–ö–∞–∫ –∑–∞–±—Ä–∞—Ç—å</button>
              <button class="btnGhost" id="resetBtn">–°–±—Ä–æ—Å (—Ç–µ—Å—Ç)</button>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="stack">
        <div class="field" id="promoField">
          <label for="promo">–ü—Ä–æ–º–æ–∫–æ–¥ (–¥–∞—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–∏–Ω–æ–≤)</label>
          <input class="input" id="promo" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: DS-4J6ZT" autocomplete="off" />
          <button class="btnGhost" id="activateBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
          <div class="helper" id="promoHelp">–û–¥–∏–Ω –ø—Ä–æ–º–æ–∫–æ–¥ –º–æ–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 1 —Ä–∞–∑ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ö–æ–¥ ‚Äú1‚Äù = —Ç–µ—Å—Ç.</div>
        </div>

        <div class="field" id="nickField">
          <label for="nick">–ù–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</label>
          <input class="input" id="nick" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: spxce_mxn" autocomplete="off" />
          <div class="helper">–ù—É–∂–µ–Ω –¥–ª—è –∫–Ω–æ–ø–∫–∏ ¬´–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑¬ª.</div>
        </div>

        <div class="field">
          <div class="helper">
            –í –ø—Ä–∏–∑–∞—Ö –µ—Å—Ç—å –≤—Å—ë: <b>–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏</b>, <b>–Ω–∞–±–æ—Ä—ã</b>, <b>—Å–∫–∏–¥–∫–∏</b>, <b>–∫–µ–π—Å—ã</b>,
            <b>–ø—Ä–µ–¥–º–µ—Ç—ã</b>, <b>–∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞</b>, <b>–ø–æ–∏–Ω—Ç—ã</b> –∏ <b>+1 —Å–ø–∏–Ω</b>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <canvas id="confetti"></canvas>

  <div class="overlay" id="overlay">
    <div class="modal">
      <div class="modalHead">
        <h3>üéâ –ü–æ–±–µ–¥–∞!</h3>
        <button class="closeX" id="closeModal">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="winTitle" id="winTitle">‚Äî</div>
        <div class="winDesc" id="winDesc">‚Äî</div>
        <div class="codeBox" id="claimBox">Claim ID: ‚Äî</div>
        <div class="helper" style="text-align:center;">
          –ù–∞–∂–º–∏ ¬´–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑¬ª ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —á–∞—Ç —Å @SalesManagerX. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤–µ—Ä–∏—Ç Claim ID.
        </div>
      </div>
      <div class="modalActions">
        <button class="actionBtn gray" id="copyBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Claim ID</button>
        <button class="actionBtn orange" id="claimBtn">–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑</button>
      </div>
    </div>
  </div>

<script>
  // ===== SETTINGS =====
  const SALES_USERNAME = "SalesManagerX";

  // –ü—Ä–æ–º–æ–∫–æ–¥—ã -> —Å–∫–æ–ª—å–∫–æ —Å–ø–∏–Ω–æ–≤ –¥–æ–±–∞–≤–ª—è—é—Ç (–ø—Ä–∏–º–µ—Ä)
  const PROMO_SPINS = {
    "DS-7F2K9": 1,
    "DS-A3M8Q": 2,
    "DS-V9P1X": 3,
    "DS-4J6ZT": 5,
    "DS-N2W5L": 2,
    "DS-8C0RD": 1,
    "DS-K1H7B": 4,
    "DS-Q6T2Y": 2,
    "DS-5U9SN": 3,
    "DS-X3D4G": 5,
    "1": 99
  };

  // ===== PRIZES (–í–°–Å, —á—Ç–æ —Ç—ã –≥–æ–≤–æ—Ä–∏–ª) =====
  // –í–µ—Å–∞: —á–µ–º –º–µ–Ω—å—à–µ ‚Äî —Ç–µ–º —Ä–µ–∂–µ.
  const PRIZES = [
    // –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏
    { id:"rank_vip",      label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è VIP",      type:"rank", value:"VIP",      weight:6.5,  emoji:"üëë", desc:"–í—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ VIP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ." },
    { id:"rank_plat",     label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è PLATINUM", type:"rank", value:"PLATINUM", weight:3.3,  emoji:"üëë", desc:"–í—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ PLATINUM –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ." },
    { id:"rank_luxe",     label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è LUXE",     type:"rank", value:"LUXE",     weight:1.1,  emoji:"üëë", desc:"–í—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ LUXE (—Ä–µ–¥–∫–æ)." },
    { id:"rank_void",     label:"–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è VOID",     type:"rank", value:"VOID",     weight:0.35, emoji:"üëë", desc:"–í—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ VOID (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ)." },

    // –ù–∞–±–æ—Ä—ã
    { id:"set_vip",       label:"–ù–∞–±–æ—Ä VIP",      type:"bundle", value:"VIP_SET",      weight:5.0,  emoji:"üì¶", desc:"–í—ã–¥–∞—á–∞ –Ω–∞–±–æ—Ä–∞ VIP." },
    { id:"set_platinum",  label:"–ù–∞–±–æ—Ä PLATINUM", type:"bundle", value:"PLAT_SET",     weight:2.3,  emoji:"üì¶", desc:"–í—ã–¥–∞—á–∞ –Ω–∞–±–æ—Ä–∞ PLATINUM." },
    { id:"set_luxe",      label:"–ù–∞–±–æ—Ä LUXE",     type:"bundle", value:"LUXE_SET",     weight:0.85, emoji:"üì¶", desc:"–í—ã–¥–∞—á–∞ –Ω–∞–±–æ—Ä–∞ LUXE (—Ä–µ–¥–∫–æ)." },
    { id:"set_void",      label:"–ù–∞–±–æ—Ä VOID",     type:"bundle", value:"VOID_SET",     weight:0.25, emoji:"üì¶", desc:"–í—ã–¥–∞—á–∞ –Ω–∞–±–æ—Ä–∞ VOID (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ)." },
    { id:"set_dark",      label:"–ù–∞–±–æ—Ä DARK",     type:"bundle", value:"DARK_SET",     weight:0.30, emoji:"üì¶", desc:"–í—ã–¥–∞—á–∞ –Ω–∞–±–æ—Ä–∞ DARK (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ)." },

    // –°–∫–∏–¥–∫–∏
    { id:"disc_70", label:"–°–∫–∏–¥–∫–∞ 70% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é", type:"discount", value:70, weight:0.9, emoji:"üè∑Ô∏è", desc:"–°–∫–∏–¥–∫–∞ 70% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é." },
    { id:"disc_50", label:"–°–∫–∏–¥–∫–∞ 50% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é", type:"discount", value:50, weight:2.0, emoji:"üè∑Ô∏è", desc:"–°–∫–∏–¥–∫–∞ 50% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é." },
    { id:"disc_20", label:"–°–∫–∏–¥–∫–∞ 20% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é", type:"discount", value:20, weight:5.0, emoji:"üè∑Ô∏è", desc:"–°–∫–∏–¥–∫–∞ 20% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é." },
    { id:"disc_10", label:"–°–∫–∏–¥–∫–∞ 10% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é", type:"discount", value:10, weight:8.0, emoji:"üè∑Ô∏è", desc:"–°–∫–∏–¥–∫–∞ 10% –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é." },

    // –ö–µ–π—Å—ã
    { id:"case_money", label:"–ö–µ–π—Å —Å –¥–µ–Ω—å–≥–∞–º–∏",     type:"case", value:"MONEY_CASE", weight:8.5, emoji:"üéÅ", desc:"–ö–µ–π—Å —Å –¥–µ–Ω–µ–∂–Ω—ã–º–∏ –ø—Ä–∏–∑–∞–º–∏." },
    { id:"case_priv",  label:"–ö–µ–π—Å —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏", type:"case", value:"PRIV_CASE",  weight:6.0, emoji:"üéÅ", desc:"–ö–µ–π—Å —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏/–Ω–∞–±–æ—Ä–∞–º–∏." },

    // –ü—Ä–µ–¥–º–µ—Ç—ã
    { id:"item_livalka", label:"–ü—Ä–µ–¥–º–µ—Ç: –õ–ò–í–ê–õ–ö–ê",           type:"item", value:"LIVALKA", weight:7.0, emoji:"üß±", desc:"–í—ã–¥–∞—á–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ ¬´–õ–ò–í–ê–õ–ö–ê¬ª." },
    { id:"item_wand",    label:"–ü—Ä–µ–¥–º–µ—Ç: –í–û–õ–®–ï–ë–ù–ê–Ø –ü–ê–õ–û–ß–ö–ê", type:"item", value:"WAND",    weight:7.0, emoji:"ü™Ñ", desc:"–í—ã–¥–∞—á–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ ¬´–í–û–õ–®–ï–ë–ù–ê–Ø –ü–ê–õ–û–ß–ö–ê¬ª." },

    // –ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ (—Ç–æ, —á—Ç–æ —Ç—ã –æ—Ä–∞–ª –≥–¥–µ –æ–Ω–∞)
    { id:"gc_1000",   label:"–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ 1000",   type:"game_currency", value:1000,   weight:10.0, emoji:"ü™ô", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã: 1000." },
    { id:"gc_5000",   label:"–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ 5000",   type:"game_currency", value:5000,   weight:7.5,  emoji:"ü™ô", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã: 5000." },
    { id:"gc_10000",  label:"–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ 10000",  type:"game_currency", value:10000,  weight:4.0,  emoji:"ü™ô", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã: 10000." },
    { id:"gc_50000",  label:"–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ 50000",  type:"game_currency", value:50000,  weight:1.0,  emoji:"ü™ô", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π –≤–∞–ª—é—Ç—ã: 50000 (—Ä–µ–¥–∫–æ)." },

    // –ü–æ–∏–Ω—Ç—ã
    { id:"pt_5",   label:"–ü–æ–∏–Ω—Ç—ã +5",   type:"points", value:5,  weight:10.0, emoji:"‚≠ê", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∏–Ω—Ç–æ–≤: +5." },
    { id:"pt_10",  label:"–ü–æ–∏–Ω—Ç—ã +10",  type:"points", value:10, weight:7.0,  emoji:"‚≠ê", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∏–Ω—Ç–æ–≤: +10." },
    { id:"pt_20",  label:"–ü–æ–∏–Ω—Ç—ã +20",  type:"points", value:20, weight:4.0,  emoji:"‚≠ê", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∏–Ω—Ç–æ–≤: +20." },
    { id:"pt_30",  label:"–ü–æ–∏–Ω—Ç—ã +30",  type:"points", value:30, weight:2.0,  emoji:"‚≠ê", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∏–Ω—Ç–æ–≤: +30." },
    { id:"pt_50",  label:"–ü–æ–∏–Ω—Ç—ã +50",  type:"points", value:50, weight:1.0,  emoji:"‚≠ê", desc:"–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∏–Ω—Ç–æ–≤: +50 (—Ä–µ–¥–∫–æ)." },

    // +1 —Å–ø–∏–Ω
    { id:"spin_plus_1",  label:"+1 —Å–ø–∏–Ω", type:"spin", value:1, weight:6.0, emoji:"‚ûï", desc:"–î–æ–±–∞–≤–ª—è–µ—Ç +1 —Å–ø–∏–Ω –≤ –±–∞–ª–∞–Ω—Å (–≤—Å–µ–≥–¥–∞)." },
  ];

  // ===== DOM =====
  const $ = (id)=>document.getElementById(id);
  const canvas = $("wheel");
  const ctx = canvas.getContext("2d");
  const spinBtn = $("spinBtn");
  const promoInput = $("promo");
  const nickInput = $("nick");
  const promoField = $("promoField");
  const nickField = $("nickField");
  const activateBtn = $("activateBtn");
  const promoHelp = $("promoHelp");
  const overlay = $("overlay");
  const winTitle = $("winTitle");
  const winDesc = $("winDesc");
  const claimBox = $("claimBox");
  const confettiCanvas = $("confetti");
  const cctx = confettiCanvas.getContext("2d");
  const spinBalanceEl = $("spinBalance");

  // ===== Storage =====
  const BAL_KEY = "ds_spin_balance";
  const USED_PROMO_PREFIX = "ds_promo_redeemed_";

  function getBalance(){ return Number(localStorage.getItem(BAL_KEY) || "0"); }
  function setBalance(n){
    const v = Math.max(0, Math.floor(n));
    localStorage.setItem(BAL_KEY, String(v));
    spinBalanceEl.textContent = v;
    spinBtn.disabled = spinning || (v <= 0);
    spinBtn.textContent = (v > 0) ? "–ö—Ä—É—Ç–∏—Ç—å (‚àí1 —Å–ø–∏–Ω)" : "–ù–µ—Ç —Å–ø–∏–Ω–æ–≤";
  }
  function addBalance(n){ setBalance(getBalance() + n); }
  function consumeSpin(){
    const b = getBalance();
    if(b <= 0) return false;
    setBalance(b - 1);
    return true;
  }

  function promoKey(code){ return USED_PROMO_PREFIX + code; }
  function isRedeemed(code){ return localStorage.getItem(promoKey(code)) === "1"; }
  function markRedeemed(code){ localStorage.setItem(promoKey(code), "1"); }

  function shake(el){
    el.classList.add("shake");
    setTimeout(()=>el.classList.remove("shake"), 380);
  }

  function redeemPromo(codeRaw){
    const code = (codeRaw || "").trim();
    if(!code){
      promoHelp.textContent = "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥.";
      shake(promoField);
      return;
    }

    const spins = PROMO_SPINS[code];
    if(!spins){
      promoHelp.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥.";
      shake(promoField);
      return;
    }

    if(code !== "1" && isRedeemed(code)){
      promoHelp.textContent = "–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.";
      shake(promoField);
      return;
    }

    if(code !== "1") markRedeemed(code);
    addBalance(spins);
    promoHelp.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: +${spins} —Å–ø–∏–Ω(–æ–≤) ‚úÖ`;
  }

  activateBtn.addEventListener("click", ()=>redeemPromo(promoInput.value));
  promoInput.addEventListener("keydown", (e)=>{ if(e.key==="Enter") redeemPromo(promoInput.value); });

  // ===== Weighted pick =====
  function sumWeights(){ return PRIZES.reduce((a,p)=>a+p.weight,0); }
  function pickWeighted(){
    let r = Math.random() * sumWeights();
    for(const p of PRIZES){
      r -= p.weight;
      if(r <= 0) return p;
    }
    return PRIZES[PRIZES.length-1];
  }

  // ===== Claim + Telegram =====
  function genClaimId(){
    const arr = new Uint32Array(3);
    crypto.getRandomValues(arr);
    const base = Array.from(arr).map(x=>x.toString(36)).join("-").toUpperCase();
    const t = Date.now().toString(36).toUpperCase();
    return `DS-${t}-${base}`;
  }
  function openTelegram(username, text){
    const url = `https://t.me/${encodeURIComponent(username)}?text=${encodeURIComponent(text)}`;
    window.open(url, "_blank");
  }
  function buildTelegramText(win){
    const nick = (nickInput.value||"").trim();
    const promo = (promoInput.value||"").trim();
    return [
      "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –•–æ—á—É –∑–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑ –∏–∑ —Ä—É–ª–µ—Ç–∫–∏ DarkSurvival.",
      "",
      "–ù–∏–∫: " + nick,
      "–ü—Ä–æ–º–æ–∫–æ–¥ (–µ—Å–ª–∏ –±—ã–ª): " + (promo || "‚Äî"),
      "–ü—Ä–∏–∑: " + win.prize.label,
      "Claim ID: " + win.claimId,
      "–í—Ä–µ–º—è: " + new Date(win.ts).toLocaleString("ru-RU"),
      "",
      "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Claim ID."
    ].join("\n");
  }

  // ===== Wheel =====
  let currentRotation = 0;
  let spinning = false;
  let lastWin = null;

  function fitCanvas(){
    const shell = document.querySelector(".wheelShell");
    const rect = shell.getBoundingClientRect();
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    const size = Math.floor(Math.min(rect.width, rect.height) * dpr);
    canvas.width = size;
    canvas.height = size;
    drawWheel(currentRotation);
  }
  window.addEventListener("resize", fitCanvas);

  function shortLabel(txt){
    return txt
      .replace("–ü—Ä–∏–≤–∏–ª–µ–≥–∏—è ", "")
      .replace("–ü—Ä–µ–¥–º–µ—Ç: ", "")
      .replace("–°–∫–∏–¥–∫–∞ ", "")
      .replace(" –Ω–∞ –ª—é–±—É—é –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é", "")
      .replace("–ö–µ–π—Å —Å ", "–ö–µ–π—Å ")
      .replace("–ò–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ ", "–í–∞–ª—é—Ç–∞ ")
      .replace("–ü–æ–∏–Ω—Ç—ã ", "+");
  }
  function hsl(h,s,l,a=1){ return `hsla(${h} ${s}% ${l}% / ${a})`; }

  function drawWheel(rot){
    const w = canvas.width, h = canvas.height;
    const cx = w/2, cy = h/2;
    const radius = Math.min(cx,cy) - 10;

    ctx.clearRect(0,0,w,h);

    ctx.save();
    ctx.translate(cx,cy);

    // glow ring
    ctx.beginPath();
    ctx.arc(0,0,radius,0,Math.PI*2);
    ctx.shadowColor = "rgba(168,85,247,.35)";
    ctx.shadowBlur = 28;
    ctx.strokeStyle = "rgba(255,255,255,.08)";
    ctx.lineWidth = 6;
    ctx.stroke();

    ctx.rotate(rot);

    const n = PRIZES.length;
    const arc = (Math.PI*2)/n;

    for(let i=0;i<n;i++){
      const p = PRIZES[i];
      const start = i*arc;
      const end = start + arc;

      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,radius,start,end);
      ctx.closePath();

      const hue = (i * (360/n) + 280) % 360;
      const grad = ctx.createLinearGradient(
        Math.cos(start)*radius, Math.sin(start)*radius,
        Math.cos(end)*radius, Math.sin(end)*radius
      );
      grad.addColorStop(0, hsl(hue, 85, 55, 0.30));
      grad.addColorStop(1, hsl((hue+40)%360, 85, 55, 0.18));
      ctx.fillStyle = grad;
      ctx.fill();

      ctx.strokeStyle = "rgba(255,255,255,.12)";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.save();
      ctx.rotate(start + arc/2);
      ctx.textAlign = "right";
      ctx.fillStyle = "rgba(234,240,255,.95)";
      ctx.font = `900 ${Math.max(10, Math.floor(radius*0.048))}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
      const label = `${p.emoji} ${shortLabel(p.label)}`;
      ctx.fillText(label, radius - 14, 6);
      ctx.restore();
    }

    // center
    ctx.setTransform(1,0,0,1,0,0);
    ctx.save();
    ctx.translate(cx,cy);
    ctx.beginPath();
    ctx.arc(0,0,Math.max(42, radius*0.18),0,Math.PI*2);
    ctx.fillStyle = "rgba(0,0,0,.22)";
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = "rgba(255,255,255,.14)";
    ctx.stroke();

    ctx.fillStyle = "rgba(234,240,255,.95)";
    ctx.font = `1000 ${Math.max(14, Math.floor(radius*0.08))}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;
    ctx.textAlign = "center";
    ctx.fillText("SPIN", 0, 7);
    ctx.restore();

    ctx.restore();
  }

  function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

  async function spinToPrize(prize){
    const n = PRIZES.length;
    const arc = (Math.PI*2)/n;
    const idx = PRIZES.findIndex(x=>x.id===prize.id);

    const pointerAngle = -Math.PI/2;
    const sliceCenter = idx*arc + arc/2;
    const baseTarget = pointerAngle - sliceCenter;

    const extraTurns = 7 + Math.floor(Math.random()*4);
    const targetRotation = baseTarget + extraTurns * Math.PI*2;

    const start = currentRotation;
    const delta = targetRotation - start;
    const duration = 4200 + Math.random()*700;
    const t0 = performance.now();

    return new Promise(resolve=>{
      function frame(now){
        const t = Math.min(1,(now-t0)/duration);
        const k = easeOutCubic(t);
        currentRotation = start + delta*k;
        drawWheel(currentRotation);
        if(t<1) requestAnimationFrame(frame);
        else resolve();
      }
      requestAnimationFrame(frame);
    });
  }

  // ===== Confetti =====
  let confetti = [];
  let confettiRAF = null;

  function resizeConfetti(){
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    confettiCanvas.width = Math.floor(window.innerWidth * dpr);
    confettiCanvas.height = Math.floor(window.innerHeight * dpr);
    confettiCanvas.style.width = window.innerWidth + "px";
    confettiCanvas.style.height = window.innerHeight + "px";
    cctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener("resize", resizeConfetti);

  function launchConfetti(){
    resizeConfetti();
    confettiCanvas.classList.add("show");

    const W = window.innerWidth, H = window.innerHeight;
    const originX = W*0.5;
    const originY = Math.min(H*0.45, 380);

    confetti = [];
    const count = 220;
    for(let i=0;i<count;i++){
      const angle = Math.random()*Math.PI*2;
      const speed = 2.5 + Math.random()*5.5;
      confetti.push({
        x: originX, y: originY,
        vx: Math.cos(angle)*speed,
        vy: Math.sin(angle)*speed - (2.5 + Math.random()*2),
        g: 0.08 + Math.random()*0.08,
        s: 3 + Math.random()*4,
        r: Math.random()*Math.PI,
        vr: (-0.2 + Math.random()*0.4),
        a: 1,
        color: `hsl(${(280 + Math.random()*140) % 360} 90% 60%)`
      });
    }

    let t = 0;
    cancelAnimationFrame(confettiRAF);
    function step(){
      t++;
      cctx.clearRect(0,0,window.innerWidth, window.innerHeight);

      for(const p of confetti){
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.r += p.vr;
        p.a *= 0.992;

        cctx.save();
        cctx.globalAlpha = Math.max(0, p.a);
        cctx.translate(p.x, p.y);
        cctx.rotate(p.r);
        cctx.fillStyle = p.color;
        cctx.fillRect(-p.s/2, -p.s/2, p.s, p.s*1.4);
        cctx.restore();
      }

      confetti = confetti.filter(p=>p.a>0.06 && p.y < window.innerHeight+60);

      if(t < 170 && confetti.length){
        confettiRAF = requestAnimationFrame(step);
      }else{
        cctx.clearRect(0,0,window.innerWidth, window.innerHeight);
        confettiCanvas.classList.remove("show");
      }
    }
    step();
  }

  // ===== Modal =====
  function openModal(){ overlay.classList.add("show"); }
  function closeModal(){ overlay.classList.remove("show"); }
  $("closeModal").addEventListener("click", closeModal);
  overlay.addEventListener("click",(e)=>{ if(e.target===overlay) closeModal(); });

  $("copyBtn").addEventListener("click", async ()=>{
    if(!lastWin) return;
    try{
      await navigator.clipboard.writeText(lastWin.claimId);
      alert("Claim ID —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω ‚úÖ");
    }catch{
      alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. Claim ID: " + lastWin.claimId);
    }
  });

  $("claimBtn").addEventListener("click", ()=>{
    if(!lastWin) return;
    const nick = (nickInput.value||"").trim();
    if(!nick){ shake(nickField); return; }
    openTelegram(SALES_USERNAME, buildTelegramText(lastWin));
  });

  // ===== UI buttons =====
  $("howBtn").addEventListener("click", ()=>{
    alert("1) –ê–∫—Ç–∏–≤–∏—Ä—É–π –ø—Ä–æ–º–æ–∫–æ–¥ (–¥–æ–±–∞–≤–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–∏–Ω–æ–≤)\n2) –ö—Ä—É—Ç–∏ (‚àí1 —Å–ø–∏–Ω)\n3) –ü–æ–±–µ–¥–∞ ‚Üí Claim ID\n4) ¬´–ó–∞–±—Ä–∞—Ç—å –ø—Ä–∏–∑¬ª –æ—Ç–∫—Ä–æ–µ—Ç Telegram –¥–ª—è @SalesManagerX");
  });

  $("resetBtn").addEventListener("click", ()=>{
    localStorage.removeItem(BAL_KEY);
    Object.keys(PROMO_SPINS).forEach(code => localStorage.removeItem(promoKey(code)));
    promoHelp.textContent = "–°–±—Ä–æ—à–µ–Ω–æ ‚úÖ (—Ç–µ—Å—Ç)";
    setBalance(0);
  });

  $("addTestBtn").addEventListener("click", ()=>addBalance(10));

  // ===== Main spin =====
  spinBtn.addEventListener("click", async ()=>{
    if(spinning) return;
    if(getBalance() <= 0){ shake(spinBtn); return; }

    consumeSpin();

    spinning = true;
    setBalance(getBalance());
    spinBtn.textContent = "–ö—Ä—É—Ç–∏–º‚Ä¶";

    const prize = pickWeighted();
    const claimId = genClaimId();
    const ts = Date.now();

    await spinToPrize(prize);

    if(prize.type === "spin" && Number(prize.value) > 0){
      addBalance(Number(prize.value));
    } else {
      setBalance(getBalance());
    }

    lastWin = { prize, claimId, ts };

    winTitle.textContent = prize.label;
    winDesc.textContent = prize.desc;
    claimBox.textContent = "Claim ID: " + claimId;

    launchConfetti();
    openModal();

    spinning = false;
    setBalance(getBalance());
  });

  // ===== Init =====
  setBalance(getBalance());
  fitCanvas();
  drawWheel(currentRotation);
</script>
</body>
  </html>
